

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyequib &mdash; pyEQUIB 0.4.2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> pyEQUIB
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/readme.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/reference.html">References</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/pyequib.main.html">pyequib.main package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pyEQUIB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>pyequib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyequib</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains functions for Plasma Diagnostics and Abundance Analysis</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># A. Danehkar</span>
<span class="c1">#</span>
<span class="c1"># Version 0.2.0, 01/10/2020</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#import pandas as pd</span>
<span class="kn">import</span> <span class="nn">atomneb</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>

<span class="n">__all__</span> <span class="o">=</span>  <span class="p">[</span><span class="s2">&quot;calc_temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_density&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_populations&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_crit_density&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_emissivity&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_abundance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;print_ionic&quot;</span><span class="p">,</span> <span class="s2">&quot;get_omij_temp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_emiss_h_beta&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_emiss_he_i_rl&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_emiss_he_ii_rl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_emiss_c_ii_rl&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_emiss_c_iii_rl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_emiss_n_ii_rl&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_emiss_n_iii_rl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_emiss_o_ii_rl&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_emiss_ne_ii_rl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_abund_he_i_rl&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_abund_he_ii_rl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_abund_c_ii_rl&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_abund_c_iii_rl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_abund_n_ii_rl&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_abund_n_iii_rl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;calc_abund_o_ii_rl&quot;</span><span class="p">,</span> <span class="s2">&quot;calc_abund_ne_ii_rl&quot;</span><span class="p">,</span>
            <span class="s2">&quot;redlaw&quot;</span><span class="p">,</span> <span class="s2">&quot;redlaw_gal&quot;</span><span class="p">,</span> <span class="s2">&quot;redlaw_gal2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;redlaw_ccm&quot;</span><span class="p">,</span> <span class="s2">&quot;redlaw_jbk&quot;</span><span class="p">,</span> <span class="s2">&quot;redlaw_fm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;redlaw_smc&quot;</span><span class="p">,</span> <span class="s2">&quot;redlaw_lmc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;deredden_flux&quot;</span><span class="p">,</span> <span class="s2">&quot;deredden_relflux&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="calc_temperature"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_temperature">[docs]</a><span class="k">def</span> <span class="nf">calc_temperature</span><span class="p">(</span><span class="n">line_flux_ratio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">upper_levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lower_levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">elj_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">low_temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">num_temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_density</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines electron temperature from given</span>
<span class="sd">        flux intensity ratio for specified ion with upper level(s)</span>
<span class="sd">        lower level(s) by solving atomic level populations and</span>
<span class="sd">        line emissivities in statistical equilibrium</span>
<span class="sd">        for given electron density.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the electron temperature.</span>

<span class="sd">    :Keywords:</span>
<span class="sd">        line_flux_ratio  :     in, required, type=float</span>
<span class="sd">                               flux intensity ratio</span>
<span class="sd">        density          :     in, required, type=float</span>
<span class="sd">                               electron density</span>
<span class="sd">        upper_levels     :     in, required, type=string,</span>
<span class="sd">                               upper atomic level(s) e.g &#39;1,2/&#39;, &#39;1,2,1,3/&#39;</span>
<span class="sd">        lower_levels     :     in, required, type=string</span>
<span class="sd">                               lower atomic level(s) e.g &#39;1,2/&#39;, &#39;1,2,1,3/&#39;</span>
<span class="sd">        elj_data         :     in, required, type=array/object</span>
<span class="sd">                               energy levels (Ej) data</span>
<span class="sd">        omij_data        :     in, required, type=array/object</span>
<span class="sd">                               collision strengths (omega_ij) data</span>
<span class="sd">        aij_data         :     in, required, type=array/object</span>
<span class="sd">                               transition probabilities (Aij) data</span>
<span class="sd">        low_temperature  :     in, optional, type=float</span>
<span class="sd">                               lower temperature range</span>
<span class="sd">        high_temperature  :     in, optional, type=float</span>
<span class="sd">                               upper temperature range</span>
<span class="sd">        num_temperature  :     in, optional, type=integer</span>
<span class="sd">                               number of the iteration step</span>
<span class="sd">        min_density      :     in, optional, type=float</span>
<span class="sd">                               lower density range</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_dir = os.path.join(&#39;atomic-data&#39;, &#39;chianti70&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_elj_file = os.path.join(base_dir,data_dir, &#39;AtomElj.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_omij_file = os.path.join(base_dir,data_dir, &#39;AtomOmij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_aij_file = os.path.join(base_dir,data_dir, &#39;AtomAij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;s&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39;</span>
<span class="sd">        &gt;&gt;&gt; s_ii_elj=atomneb.read_elj(atom_elj_file, atom, ion, level_num=5) # read Energy Levels (Ej)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_omij=atomneb.read_omij(atom_omij_file, atom, ion) # read Collision Strengths (Omegaij)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_aij=atomneb.read_aij(atom_aij_file, atom, ion) # read Transition Probabilities (Aij)</span>
<span class="sd">        &gt;&gt;&gt; upper_levels=&#39;1,2,1,3/&#39;</span>
<span class="sd">        &gt;&gt;&gt; lower_levels=&#39;1,5/&#39;</span>
<span class="sd">        &gt;&gt;&gt; density = np.float64(2550)</span>
<span class="sd">        &gt;&gt;&gt; line_flux_ratio=np.float64(10.753)</span>
<span class="sd">        &gt;&gt;&gt; temperature=pyequib.calc_temperature(line_flux_ratio=line_flux_ratio, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                              upper_levels=upper_levels, lower_levels=lower_levels,</span>
<span class="sd">        &gt;&gt;&gt;                              elj_data=s_ii_elj, omij_data=s_ii_omij,</span>
<span class="sd">        &gt;&gt;&gt;                              aij_data=s_ii_aij)</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;Electron Temperature:&quot;, temperature)</span>
<span class="sd">           Electron Temperature:       7920.2865</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Plasma Diagnostics, Collisionally Excited Lines</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        15/09/2013, A. Danehkar, Translated from FORTRAN to IDL code.</span>

<span class="sd">        20/10/2016, A. Danehkar, Replaced str2int with strnumber.</span>

<span class="sd">        20/10/2016, A. Danehkar, Replaced CFY, SPLMAT, and CFD with</span>
<span class="sd">             IDL function INTERPOL( /SPLINE).</span>

<span class="sd">        20/10/2016, A. Danehkar, Replaced LUSLV with IDL LAPACK function</span>
<span class="sd">                          LA_LINEAR_EQUATION.</span>

<span class="sd">        15/11/2016, A. Danehkar, Replaced LA_LINEAR_EQUATION (not work in GDL)</span>
<span class="sd">              with IDL function LUDC &amp; LUSOL.</span>

<span class="sd">        19/11/2016, A. Danehkar, Replaced INTERPOL (not accurate) with</span>
<span class="sd">                       SPL_INIT &amp; SPL_INTERP.</span>

<span class="sd">        20/11/2016, A. Danehkar, Made a new function calc_populations()</span>
<span class="sd">          for solving atomic level populations and separated it from</span>
<span class="sd">          calc_abundance(), calc_density() and calc_temperature().</span>

<span class="sd">        10/03/2017, A. Danehkar, Integration with AtomNeb, now uses atomic data</span>
<span class="sd">                         input elj_data, omij_data, aij_data.</span>

<span class="sd">        12/06/2017, A. Danehkar, Cleaning the function, and remove unused varibales</span>
<span class="sd">                           from calc_temperature().</span>

<span class="sd">        27/02/2019, A. Danehkar, Fix a bug in the atomic level assumption, and</span>
<span class="sd">                           use the simplified calc_populations() routine.</span>

<span class="sd">        04/03/2019, A. Danehkar, Use the get_omij_temp() routine.</span>

<span class="sd">        24/05/2019, A. Danehkar, Add the optional temperature range.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>

<span class="sd">    FORTRAN HISTORY:</span>

<span class="sd">        03/05/1981, I.D.Howarth,  Version 1.</span>

<span class="sd">        05/05/1981, I.D.Howarth,  Minibug fixed!</span>

<span class="sd">        07/05/1981, I.D.Howarth,  Now takes collision rates or strengths.</span>

<span class="sd">        03/08/1981, S.Adams,      Interpolates collision strengths.</span>

<span class="sd">        07/08/1981, S.Adams,      Input method changed.</span>

<span class="sd">        19/11/1984, R.E.S.Clegg,  SA files entombed in scratch disk. Logical</span>
<span class="sd">                                  filenames given to SA&#39;s data files.</span>

<span class="sd">        08/1995, D.P.Ruffle, Changed input file format. Increased matrices.</span>

<span class="sd">        02/1996, X.W.Liu,   Tidy up. SUBROUTINES SPLMAT, HGEN, CFY and CFD</span>
<span class="sd">                            modified such that matrix sizes (i.e. maximum</span>
<span class="sd">                            of Te and maximum no of levels) can now be cha</span>
<span class="sd">                            by modifying the parameters NDIM1, NDIM2 and N</span>
<span class="sd">                            in the Main program. EASY!</span>
<span class="sd">                            Now takes collision rates as well.</span>
<span class="sd">                            All variables are declared explicitly</span>
<span class="sd">                            Generate two extra files (ionpop.lis and ionra</span>
<span class="sd">                            of plain stream format for plotting.</span>

<span class="sd">        06/1996, C.J.Pritchet, Changed input data format for cases IBIG=1,2.</span>
<span class="sd">                            Fixed readin bug for IBIG=2 case.</span>
<span class="sd">                            Now reads reformatted upsilons (easier to see</span>
<span class="sd">                            and the 0 0 0 data end is excluded for these c</span>
<span class="sd">                            The A values have a different format for IBIG=.</span>

<span class="sd">        2006, B.Ercolano,   Converted to F90.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1">#common share1, Atomic_Data_Path</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flux intensity ratio is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy Levels data (elj_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">omij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Collision Strengths (omij_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">aij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transition Probabilities (aij_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">upper_levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Upper levels (upper_levels) are not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">lower_levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lower levels (lower_levels) are not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">):</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">low_temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">temp_min</span> <span class="o">=</span> <span class="n">low_temperature</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">temp_min</span> <span class="o">=</span> <span class="mf">5000.0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">high_temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">temp_max</span> <span class="o">=</span> <span class="n">high_temperature</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">temp_max</span> <span class="o">=</span> <span class="mf">20000.0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">num_temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">temp_num</span> <span class="o">=</span> <span class="n">num_temperature</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">temp_num</span> <span class="o">=</span> <span class="mi">4</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">min_density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">dens_min</span> <span class="o">=</span> <span class="n">min_density</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">dens_min</span> <span class="o">=</span> <span class="mf">1.0</span>
   
   <span class="n">iteration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   
   <span class="n">level_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">int1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   
   <span class="n">tempi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">tinc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">densi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">dinc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">eji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">emis_sum_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">emis_sum_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">qx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">frat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">dee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ltext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="c1">#</span>
   
   <span class="n">result1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   
   <span class="n">level_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elj_data</span><span class="p">)</span>
   <span class="n">t_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">omij_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">)</span>
   
   <span class="n">wava</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">level_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">wavb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">level_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">omij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">level_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">,</span> <span class="n">t_num</span><span class="p">))</span>
   <span class="n">check_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
   
   <span class="n">label1</span> <span class="o">=</span> <span class="p">(</span><span class="n">level_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
   
   <span class="n">upper_levels_str</span> <span class="o">=</span> <span class="n">do_strsplit</span><span class="p">(</span><span class="n">upper_levels</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">escapech</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
   <span class="n">lower_levels_str</span> <span class="o">=</span> <span class="n">do_strsplit</span><span class="p">(</span><span class="n">lower_levels</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">escapech</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
   
   <span class="n">upper_levels_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">upper_levels_str</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
   <span class="n">lower_levels_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lower_levels_str</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
   
   <span class="n">itrana</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">upper_levels_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
   <span class="n">itranb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lower_levels_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

   <span class="n">itrana</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">itranb</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="n">upper_levels_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_levels_num</span><span class="p">):</span>
      <span class="n">itrana</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">upper_levels_str</span><span class="p">[</span><span class="n">upper_levels_i</span><span class="p">])</span>
      <span class="n">itrana</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">upper_levels_str</span><span class="p">[</span><span class="n">upper_levels_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
      <span class="n">upper_levels_i</span> <span class="o">=</span> <span class="n">upper_levels_i</span> <span class="o">+</span> <span class="mi">2</span>
      <span class="c1">#if upper_levels_i &gt;= upper_levels_num:</span>
      <span class="c1">#   break</span>

   <span class="n">lower_levels_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lower_levels_num</span><span class="p">):</span>
      <span class="n">itranb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">lower_levels_str</span><span class="p">[</span><span class="n">lower_levels_i</span><span class="p">])</span>
      <span class="n">itranb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">lower_levels_str</span><span class="p">[</span><span class="n">lower_levels_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
      <span class="n">lower_levels_i</span> <span class="o">=</span> <span class="n">lower_levels_i</span> <span class="o">+</span> <span class="mi">2</span>
      <span class="c1">#if lower_levels_i &gt;= lower_levels_num:</span>
      <span class="c1">#   break</span>

   <span class="n">irats</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="c1">#level_max=max([max(ITRANA),max(ITRANB)]) ! mistake</span>
   <span class="n">level_max</span> <span class="o">=</span> <span class="n">level_num</span>
   <span class="n">aij</span> <span class="o">=</span> <span class="n">aij_data</span><span class="p">[</span><span class="s1">&#39;aij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">aij</span><span class="o">=</span><span class="n">aij</span><span class="o">.</span><span class="n">T</span>
   <span class="n">elj</span> <span class="o">=</span> <span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;ej&#39;</span><span class="p">]</span>
   <span class="c1"># set temperature iterations</span>
   <span class="c1"># start of iterations</span>
   <span class="c1"># ****************************</span>
   <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>   
         <span class="n">tempi</span> <span class="o">=</span> <span class="n">temp_min</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="n">tempi</span> <span class="o">=</span> <span class="n">check_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">int1</span> <span class="o">=</span> <span class="n">temp_num</span>
      <span class="n">tinc</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_max</span> <span class="o">-</span> <span class="n">temp_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">iteration</span><span class="p">))</span>
      <span class="c1">#int1=8</span>
      <span class="c1">#TINC=(55000.0)/((int1-1)^(iteration))</span>
      <span class="n">densi</span> <span class="o">=</span> <span class="n">density</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">densi</span> <span class="o">&lt;=</span> <span class="n">dens_min</span><span class="p">):</span>   
         <span class="n">densi</span> <span class="o">=</span> <span class="n">dens_min</span>
      <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">int1</span><span class="p">))</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tempi</span> <span class="o">&lt;</span> <span class="n">temp_min</span><span class="p">):</span>   
         <span class="n">tempi</span> <span class="o">=</span> <span class="n">temp_min</span> <span class="c1"># add</span>
      <span class="c1"># Start of temperature iteration</span>
      <span class="k">for</span> <span class="n">jt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">int1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">temperature</span> <span class="o">=</span> <span class="n">tempi</span> <span class="o">+</span> <span class="p">(</span><span class="n">jt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tinc</span>
         <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
         <span class="k">if</span> <span class="n">level_max</span> <span class="o">&gt;</span> <span class="n">level_num</span><span class="p">:</span>   
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error outside level range&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
         <span class="n">omij_t</span> <span class="o">=</span> <span class="n">get_omij_temp</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="n">level_max</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="n">irats</span><span class="p">)</span>
         <span class="n">nlj</span> <span class="o">=</span> <span class="n">calc_populations</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">densi</span><span class="p">,</span> <span class="n">elj_data</span><span class="o">=</span><span class="n">elj_data</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="n">aij_data</span><span class="p">,</span> <span class="n">eff_omij</span><span class="o">=</span><span class="n">omij_t</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="n">level_max</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="n">irats</span><span class="p">)</span>
         <span class="c1"># Search ITRANA, ITRANB for transitions &amp; sum up</span>
         <span class="n">emis_sum_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="n">emis_sum_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">ikt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">upper_levels_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itrana</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itrana</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
            <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.e0</span><span class="p">):</span>
               <span class="n">eji</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
               <span class="n">wav</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">eji</span>
               <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">nlj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">wav</span>
               <span class="n">emis_sum_a</span> <span class="o">=</span> <span class="n">emis_sum_a</span> <span class="o">+</span> <span class="n">emissivity_line</span>
         <span class="k">for</span> <span class="n">ikt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">lower_levels_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
            <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.e0</span><span class="p">):</span>
               <span class="n">eji</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
               <span class="n">wav</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">eji</span>
               <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">nlj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">wav</span>
               <span class="n">emis_sum_b</span> <span class="o">=</span> <span class="n">emis_sum_b</span> <span class="o">+</span> <span class="n">emissivity_line</span>
         <span class="n">frat</span> <span class="o">=</span> <span class="n">emis_sum_a</span> <span class="o">/</span> <span class="n">emis_sum_b</span>
         <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">jt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
         <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">jt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">frat</span> <span class="o">-</span> <span class="n">line_flux_ratio</span>
         
         <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_levels_num</span><span class="p">):</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itrana</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ia</span><span class="p">])</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itrana</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ia</span><span class="p">])</span>
            <span class="n">dee</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">i2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">wava</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">dee</span>
         <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lower_levels_num</span><span class="p">):</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ib</span><span class="p">])</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ib</span><span class="p">])</span>
            <span class="n">dee</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">i2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">wavb</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">dee</span>
         <span class="c1"># End of the temperature iteration</span>
      <span class="c1"># iteration and detect the sign change.</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">int1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">check_sign</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="c1">#if this condition, the values have a different sign</span>
            <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># the value before the sign change returned</span>
            <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">break</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)):</span>    <span class="c1"># check if there is any change of sign,</span>
         <span class="c1">#and checks if it should be upper or lower limit</span>
         <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])):</span>
            <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])):</span>
               <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_value is wrong&#39;</span><span class="p">)</span>
               <span class="k">return</span> <span class="mi">0</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)):</span>    <span class="c1">#check if no change of sign,</span>
            <span class="c1">#and checks if it should be upper or lower limit</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])):</span>
               <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])):</span>
                  <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_value is wrong&#39;</span><span class="p">)</span>
                  <span class="k">return</span> <span class="mi">0</span>
   <span class="c1"># end of iterations</span>
   <span class="c1">#****************************</span>
   <span class="n">result1</span> <span class="o">=</span> <span class="n">check_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="k">return</span> <span class="n">result1</span></div>

<div class="viewcode-block" id="calc_density"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_density">[docs]</a><span class="k">def</span> <span class="nf">calc_density</span><span class="p">(</span><span class="n">line_flux_ratio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">upper_levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lower_levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">elj_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">low_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">high_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">num_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines electron density from given</span>
<span class="sd">        flux intensity ratio for specified ion with upper level(s)</span>
<span class="sd">        lower level(s) by solving atomic level populations and</span>
<span class="sd">        line emissivities in statistical equilibrium</span>
<span class="sd">        for given electron temperature.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the electron density.</span>

<span class="sd">    :Keywords:</span>
<span class="sd">        line_flux_ratio  :     in, required, type=float</span>
<span class="sd">                               flux intensity ratio</span>
<span class="sd">        temperature      :     in, required, type=float</span>
<span class="sd">                               electron temperature</span>
<span class="sd">        upper_levels     :     in, required, type=string</span>
<span class="sd">                               upper atomic level(s) e.g &#39;1,2/&#39;, &#39;1,2,1,3/&#39;</span>
<span class="sd">        lower_levels     :     in, required, type=string</span>
<span class="sd">                               lower atomic level(s) e.g &#39;1,2/&#39;, &#39;1,2,1,3/&#39;</span>
<span class="sd">        elj_data         :     in, required, type=array/object</span>
<span class="sd">                               energy levels (Ej) data</span>
<span class="sd">        omij_data        :     in, required, type=array/object</span>
<span class="sd">                               collision strengths (omega_ij) data</span>
<span class="sd">        aij_data         :     in, required, type=array/object</span>
<span class="sd">                               transition probabilities (Aij) data</span>
<span class="sd">        low_density      :     in, optional, type=float</span>
<span class="sd">                               lower density range</span>
<span class="sd">        high_density      :     in, optional, type=float</span>
<span class="sd">                               upper density range</span>
<span class="sd">        num_density      :     in, optional, type=integer</span>
<span class="sd">                               number of the iteration step</span>
<span class="sd">        min_temperature  :     in, optional, type=float</span>
<span class="sd">                               minimum temperature</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_dir = os.path.join(&#39;atomic-data&#39;, &#39;chianti70&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_elj_file = os.path.join(base_dir,data_dir, &#39;AtomElj.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_omij_file = os.path.join(base_dir,data_dir, &#39;AtomOmij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_aij_file = os.path.join(base_dir,data_dir, &#39;AtomAij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;s&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39;</span>
<span class="sd">        &gt;&gt;&gt; s_ii_elj=atomneb.read_elj(atom_elj_file, atom, ion, level_num=5) # read Energy Levels (Ej)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_omij=atomneb.read_omij(atom_omij_file, atom, ion) # read Collision Strengths (Omegaij)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_aij=atomneb.read_aij(atom_aij_file, atom, ion) # read Transition Probabilities (Aij)\</span>
<span class="sd">        &gt;&gt;&gt; upper_levels=&#39;1,2/&#39;</span>
<span class="sd">        &gt;&gt;&gt; lower_levels=&#39;1,3/&#39;</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(7000.0)#</span>
<span class="sd">        &gt;&gt;&gt; line_flux_ratio=np.float64(1.506)#</span>
<span class="sd">        &gt;&gt;&gt; density=pyequib.calc_density(line_flux_ratio=line_flux_ratio, temperature=temperature,</span>
<span class="sd">        &gt;&gt;&gt;                      upper_levels=upper_levels, lower_levels=lower_levels,</span>
<span class="sd">        &gt;&gt;&gt;                      elj_data=s_ii_elj, omij_data=s_ii_omij,</span>
<span class="sd">        &gt;&gt;&gt;                      aij_data=s_ii_aij)</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;Electron Density:&quot;, density)</span>
<span class="sd">           Electron Density:       2312.6395</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Plasma Diagnostics, Collisionally Excited Lines</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        15/09/2013, A. Danehkar, Translated from FORTRAN to IDL code.</span>

<span class="sd">        20/10/2016, A. Danehkar, Replaced str2int with strnumber.</span>

<span class="sd">        20/10/2016, A. Danehkar, Replaced CFY, SPLMAT, and CFD with</span>
<span class="sd">             IDL function INTERPOL( /SPLINE).</span>

<span class="sd">        20/10/2016, A. Danehkar, Replaced LUSLV with IDL LAPACK function</span>
<span class="sd">                          LA_LINEAR_EQUATION.</span>

<span class="sd">        15/11/2016, A. Danehkar, Replaced LA_LINEAR_EQUATION (not work in GDL)</span>
<span class="sd">              with IDL function LUDC &amp; LUSOL.</span>

<span class="sd">        19/11/2016, A. Danehkar, Replaced INTERPOL (not accurate) with</span>
<span class="sd">                       SPL_INIT &amp; SPL_INTERP.</span>

<span class="sd">        20/11/2016, A. Danehkar, Made a new function calc_populations()</span>
<span class="sd">          for solving atomic level populations and separated it from</span>
<span class="sd">          calc_abundance(), calc_density() and calc_temperature().</span>

<span class="sd">        10/03/2017, A. Danehkar, Integration with AtomNeb, now uses atomic data</span>
<span class="sd">                         input elj_data, omij_data, aij_data.</span>

<span class="sd">        12/06/2017, A. Danehkar, Cleaning the function, and remove unused varibales</span>
<span class="sd">                           from calc_density().</span>

<span class="sd">        27/02/2019, A. Danehkar, Fix a bug in the atomic level assumption, and</span>
<span class="sd">                           use the simplified calc_populations() routine.</span>

<span class="sd">        04/03/2019, A. Danehkar, Use the get_omij_temp() routine.</span>

<span class="sd">        24/05/2019, A. Danehkar, Add the optional density range.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>

<span class="sd">    FORTRAN HISTORY:</span>

<span class="sd">        03/05/1981, I.D.Howarth,  Version 1.</span>

<span class="sd">        05/05/1981, I.D.Howarth,  Minibug fixed!</span>

<span class="sd">        07/05/1981, I.D.Howarth,  Now takes collision rates or strengths.</span>

<span class="sd">        03/08/1981, S.Adams,      Interpolates collision strengths.</span>

<span class="sd">        07/08/1981, S.Adams,      Input method changed.</span>

<span class="sd">        19/11/1984, R.E.S.Clegg,  SA files entombed in scratch disk. Logical</span>
<span class="sd">                                  filenames given to SA&#39;s data files.</span>

<span class="sd">        08/1995, D.P.Ruffle, Changed input file format. Increased matrices.</span>

<span class="sd">        02/1996, X.W.Liu,   Tidy up. SUBROUTINES SPLMAT, HGEN, CFY and CFD</span>
<span class="sd">                            modified such that matrix sizes (i.e. maximum</span>
<span class="sd">                            of Te and maximum no of levels) can now be cha</span>
<span class="sd">                            by modifying the parameters NDIM1, NDIM2 and N</span>
<span class="sd">                            in the Main program. EASY!</span>
<span class="sd">                            Now takes collision rates as well.</span>
<span class="sd">                            All variables are declared explicitly</span>
<span class="sd">                            Generate two extra files (ionpop.lis and ionra</span>
<span class="sd">                            of plain stream format for plotting.</span>

<span class="sd">        06/1996, C.J.Pritchet, Changed input data format for cases IBIG=1,2.</span>
<span class="sd">                            Fixed readin bug for IBIG=2 case.</span>
<span class="sd">                            Now reads reformatted upsilons (easier to see</span>
<span class="sd">                            and the 0 0 0 data end is excluded for these c</span>
<span class="sd">                            The A values have a different format for IBIG=.</span>

<span class="sd">        2006, B.Ercolano,   Converted to F90.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># common share1, Atomic_Data_Path</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flux intensity ratio is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy Levels data (elj_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">omij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Collision Strengths (omij_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">aij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transition Probabilities (aij_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">upper_levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Upper levels (upper_levels) are not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">lower_levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lower levels (lower_levels) are not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">low_density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="n">dens_min</span> <span class="o">=</span> <span class="n">low_density</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">dens_min</span> <span class="o">=</span> <span class="mf">1.0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">high_density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="n">dens_max</span> <span class="o">=</span> <span class="n">high_density</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">dens_max</span> <span class="o">=</span> <span class="mf">100000.0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">num_density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="n">dens_num</span> <span class="o">=</span> <span class="n">num_density</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">dens_num</span> <span class="o">=</span> <span class="mi">4</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">min_temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
      <span class="n">temp_min</span> <span class="o">=</span> <span class="n">min_temperature</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">temp_min</span> <span class="o">=</span> <span class="mf">5000.0</span>

   <span class="n">iteration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

   <span class="n">level_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">int1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

   <span class="n">tempi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">densi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">dinc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">eji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">emis_sum_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">emis_sum_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">qx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">frat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">dee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ltext</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="c1">#</span>

   <span class="n">result1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

   <span class="n">level_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elj_data</span><span class="p">)</span>
   <span class="n">t_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">omij_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">)</span>

   <span class="n">wava</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">level_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">wavb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">level_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">omij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">level_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">,</span> <span class="n">t_num</span><span class="p">))</span>
   <span class="n">check_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

   <span class="n">label1</span> <span class="o">=</span> <span class="p">(</span><span class="n">level_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

   <span class="n">upper_levels_str</span> <span class="o">=</span> <span class="n">do_strsplit</span><span class="p">(</span><span class="n">upper_levels</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">escapech</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
   <span class="n">lower_levels_str</span> <span class="o">=</span> <span class="n">do_strsplit</span><span class="p">(</span><span class="n">lower_levels</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">escapech</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

   <span class="n">upper_levels_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">upper_levels_str</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
   <span class="n">lower_levels_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lower_levels_str</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

   <span class="n">itrana</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">upper_levels_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
   <span class="n">itranb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lower_levels_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

   <span class="n">itrana</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">itranb</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="n">upper_levels_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_levels_num</span> <span class="p">):</span>
      <span class="n">itrana</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">upper_levels_str</span><span class="p">[</span><span class="n">upper_levels_i</span><span class="p">])</span>
      <span class="n">itrana</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">upper_levels_str</span><span class="p">[</span><span class="n">upper_levels_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
      <span class="n">upper_levels_i</span> <span class="o">=</span> <span class="n">upper_levels_i</span> <span class="o">+</span> <span class="mi">2</span>
      <span class="c1">#if upper_levels_i &gt;= upper_levels_num:</span>
      <span class="c1">#   break</span>

   <span class="n">lower_levels_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lower_levels_num</span><span class="p">):</span>
      <span class="n">itranb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">lower_levels_str</span><span class="p">[</span><span class="n">lower_levels_i</span><span class="p">])</span>
      <span class="n">itranb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">lower_levels_str</span><span class="p">[</span><span class="n">lower_levels_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
      <span class="n">lower_levels_i</span> <span class="o">=</span> <span class="n">lower_levels_i</span> <span class="o">+</span> <span class="mi">2</span>
      <span class="c1">#if lower_levels_i &gt;= lower_levels_num:</span>
      <span class="c1">#   break</span>

   <span class="n">irats</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="c1">#level_max=max([max(ITRANA),max(ITRANB)]) ! mistake</span>
   <span class="n">level_max</span> <span class="o">=</span> <span class="n">level_num</span>
   <span class="n">aij</span> <span class="o">=</span> <span class="n">aij_data</span><span class="p">[</span><span class="s1">&#39;aij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">aij</span> <span class="o">=</span> <span class="n">aij</span><span class="o">.</span><span class="n">T</span>
   <span class="n">elj</span> <span class="o">=</span> <span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;ej&#39;</span><span class="p">]</span>
   <span class="n">tempi</span> <span class="o">=</span> <span class="n">temperature</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">tempi</span> <span class="o">&lt;</span> <span class="n">temp_min</span><span class="p">):</span>
      <span class="n">tempi</span> <span class="o">=</span> <span class="n">temp_min</span> <span class="c1"># add</span>

   <span class="n">omij_t</span> <span class="o">=</span> <span class="n">get_omij_temp</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">tempi</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="n">level_num</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="n">irats</span><span class="p">)</span>
   <span class="c1"># set density iterations</span>
   <span class="c1"># start of iterations</span>
   <span class="c1"># ****************************</span>
   <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
         <span class="n">densi</span> <span class="o">=</span> <span class="n">dens_min</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">densi</span> <span class="o">=</span> <span class="n">check_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">ind</span> <span class="o">=</span> <span class="n">dens_num</span>
      <span class="n">dinc</span> <span class="o">=</span> <span class="p">(</span><span class="n">dens_max</span> <span class="o">-</span> <span class="n">dens_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">iteration</span><span class="p">))</span>
      <span class="c1">#IND=8</span>
      <span class="c1">#DINC=(1000000.0)/((IND-1)^(iteration))</span>
      <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">ind</span><span class="p">))</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">densi</span> <span class="o">&lt;=</span> <span class="n">dens_min</span><span class="p">):</span>
         <span class="n">densi</span> <span class="o">=</span> <span class="n">dens_min</span>
      <span class="c1"># Start of density iteration</span>
      <span class="k">for</span> <span class="n">jjd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">density</span> <span class="o">=</span> <span class="n">densi</span> <span class="o">+</span> <span class="p">(</span><span class="n">jjd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dinc</span>
         <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
         <span class="k">if</span> <span class="n">level_max</span> <span class="o">&gt;</span> <span class="n">level_num</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error outside level range&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
         <span class="n">nlj</span> <span class="o">=</span> <span class="n">calc_populations</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">elj_data</span><span class="o">=</span><span class="n">elj_data</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="n">aij_data</span><span class="p">,</span> <span class="n">eff_omij</span><span class="o">=</span><span class="n">omij_t</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="n">level_max</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="n">irats</span><span class="p">)</span>
         <span class="c1"># Search ITRANA, ITRANB for transitions &amp; sum up</span>
         <span class="n">emis_sum_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="n">emis_sum_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">ikt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper_levels_num</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itrana</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itrana</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
            <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.e0</span><span class="p">):</span>
               <span class="n">eji</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
               <span class="n">wav</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">eji</span>
               <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">nlj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">wav</span>
               <span class="n">emis_sum_a</span> <span class="o">=</span> <span class="n">emis_sum_a</span> <span class="o">+</span> <span class="n">emissivity_line</span>
         <span class="k">for</span> <span class="n">ikt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lower_levels_num</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
            <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.e0</span><span class="p">):</span>
               <span class="n">eji</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
               <span class="n">wav</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">eji</span>
               <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">nlj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">wav</span>
               <span class="n">emis_sum_b</span> <span class="o">=</span> <span class="n">emis_sum_b</span> <span class="o">+</span> <span class="n">emissivity_line</span>
         <span class="n">frat</span> <span class="o">=</span> <span class="n">emis_sum_a</span> <span class="o">/</span> <span class="n">emis_sum_b</span>
         <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">jjd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">density</span>
         <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">jjd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">frat</span> <span class="o">-</span> <span class="n">line_flux_ratio</span>
      <span class="c1"># End of the denity iteration</span>
      <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">upper_levels_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itrana</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
         <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itrana</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
         <span class="n">dee</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">i2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
         <span class="n">wava</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">dee</span>
      <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">lower_levels_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranb</span><span class="p">[</span><span class="n">ib</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
         <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranb</span><span class="p">[</span><span class="n">ib</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
         <span class="n">dee</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">i2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
         <span class="n">wavb</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">dee</span>
      <span class="n">int1</span> <span class="o">=</span> <span class="n">ind</span>
      <span class="c1"># iteration and detect the sign change.</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">int1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">check_sign</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="c1">#if this condition, the values have a different sign</span>
            <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># the value before the sign change returned</span>
            <span class="n">check</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">break</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">)):</span>    <span class="c1"># check if there is any change of sign,</span>
         <span class="c1">#and checks if it should be upper or lower limit</span>
         <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])):</span>
            <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])):</span>
               <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_value is wrong&#39;</span><span class="p">)</span>
               <span class="k">return</span> <span class="mi">0</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">if</span> <span class="p">((</span><span class="n">check</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)):</span>    <span class="c1">#check if no change of sign,</span>
            <span class="c1">#and checks if it should be upper or lower limit</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])):</span>
               <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])):</span>
                  <span class="n">check_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span> <span class="n">int1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
               <span class="k">else</span><span class="p">:</span>
                  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check_value is wrong&#39;</span><span class="p">)</span>
                  <span class="k">return</span> <span class="mi">0</span>
   <span class="c1"># end of iterations</span>
   <span class="c1">#****************************</span>
   <span class="n">result1</span> <span class="o">=</span> <span class="n">check_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="k">return</span> <span class="n">result1</span></div>

<div class="viewcode-block" id="calc_populations"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_populations">[docs]</a><span class="k">def</span> <span class="nf">calc_populations</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">elj_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">eff_omij</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function solves atomic level populations in statistical equilibrium</span>
<span class="sd">        for given electron temperature and density.</span>
<span class="sd">   </span>
<span class="sd">    :Returns:</span>
<span class="sd">       type=array/object. This function returns the atomic level populations.</span>
<span class="sd">   </span>
<span class="sd">    :Keywords:</span>
<span class="sd">        temperature :   in, required, type=float</span>
<span class="sd">                        electron temperature</span>
<span class="sd">        density     :   in, required, type=float</span>
<span class="sd">                        electron density</span>
<span class="sd">        elj_data    :   in, required, type=array/object</span>
<span class="sd">                               energy levels (Ej) data</span>
<span class="sd">        omij_data   :   in, required, type=array/object</span>
<span class="sd">                               collision strengths (omega_ij) data</span>
<span class="sd">        aij_data    :   in, required, type=array/object</span>
<span class="sd">                               transition probabilities (Aij) data</span>
<span class="sd">        eff_Omij    :   in, type=array/object</span>
<span class="sd">                        effective collision strengths (Omij_T) at given temperature</span>
<span class="sd">        level_num   :   in, type=int</span>
<span class="sd">                        Number of levels</span>
<span class="sd">        irats       :   in, type=int</span>
<span class="sd">                        Else Coll. rates = tabulated values * 10 ** irats</span>
<span class="sd">   </span>
<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>
<span class="sd">   </span>
<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_dir = os.path.join(&#39;atomic-data&#39;, &#39;chianti70&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_elj_file = os.path.join(base_dir,data_dir, &#39;AtomElj.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_omij_file = os.path.join(base_dir,data_dir, &#39;AtomOmij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_aij_file = os.path.join(base_dir,data_dir, &#39;AtomAij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;s&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39;</span>
<span class="sd">        &gt;&gt;&gt; s_ii_elj=atomneb.read_elj(atom_elj_file, atom, ion, level_num=5) # read Energy Levels (Ej)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_omij=atomneb.read_omij(atom_omij_file, atom, ion) # read Collision Strengths (Omegaij)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_aij=atomneb.read_aij(atom_aij_file, atom, ion) # read Transition Probabilities (Aij)\</span>
<span class="sd">        &gt;&gt;&gt; density = np.float64(1000)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)#</span>
<span class="sd">        &gt;&gt;&gt; nlj=pyequib.calc_populations(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                      elj_data=s_ii_elj, omij_data=s_ii_omij,</span>
<span class="sd">        &gt;&gt;&gt;                      aij_data=s_ii_aij)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Atomic Level Populations:&#39;, nlj)</span>
<span class="sd">           Atomic Level Populations:    0.96992832    0.0070036315     0.023062261   2.6593671e-06   3.1277019e-06</span>
<span class="sd">   </span>
<span class="sd">    :Categories:</span>
<span class="sd">      Plasma Diagnostics, Abundance Analysis, Collisionally Excited Lines</span>
<span class="sd">   </span>
<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Subroutines</span>
<span class="sd">   </span>
<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>
<span class="sd">   </span>
<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>
<span class="sd">   </span>
<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>
<span class="sd">   </span>
<span class="sd">    :History:</span>
<span class="sd">        15/09/2013, A. Danehkar, Translated from FORTRAN to IDL code.</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced str2int with strnumber.</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced CFY, SPLMAT, and CFD with</span>
<span class="sd">             IDL function INTERPOL( /SPLINE).</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced LUSLV with IDL LAPACK function</span>
<span class="sd">                          LA_LINEAR_EQUATION.</span>
<span class="sd">   </span>
<span class="sd">        15/11/2016, A. Danehkar, Replaced LA_LINEAR_EQUATION (not work in GDL)</span>
<span class="sd">              with IDL function LUDC &amp; LUSOL.</span>
<span class="sd">   </span>
<span class="sd">        19/11/2016, A. Danehkar, Replaced INTERPOL (not accurate) with</span>
<span class="sd">                       SPL_INIT &amp; SPL_INTERP.</span>
<span class="sd">   </span>
<span class="sd">        20/11/2016, A. Danehkar, Made a new function calc_populations()</span>
<span class="sd">          for solving atomic level populations and separated it from</span>
<span class="sd">          calc_abundance(), calc_density() and calc_temperature().</span>
<span class="sd">   </span>
<span class="sd">        10/03/2017, A. Danehkar, Integration with AtomNeb, now uses atomic data</span>
<span class="sd">                         input elj_data, omij_data, aij_data.</span>
<span class="sd">   </span>
<span class="sd">        12/06/2017, A. Danehkar, Cleaning the function, and remove unused varibales</span>
<span class="sd">                           from calc_populations().</span>
<span class="sd">   </span>
<span class="sd">        27/02/2019, A. Danehkar, Simplify the calc_populations() routine</span>
<span class="sd">                           for external usage.</span>
<span class="sd">   </span>
<span class="sd">        04/03/2019, A. Danehkar, Use the get_omij_temp() routine.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>

<span class="sd">    FORTRAN HISTORY:</span>
<span class="sd">   </span>
<span class="sd">        03/05/1981, I.D.Howarth,  Version 1.</span>
<span class="sd">   </span>
<span class="sd">        05/05/1981, I.D.Howarth,  Minibug fixed!</span>
<span class="sd">   </span>
<span class="sd">        07/05/1981, I.D.Howarth,  Now takes collision rates or strengths.</span>
<span class="sd">   </span>
<span class="sd">        03/08/1981, S.Adams,      Interpolates collision strengths.</span>
<span class="sd">   </span>
<span class="sd">        07/08/1981, S.Adams,      Input method changed.</span>
<span class="sd">   </span>
<span class="sd">        19/11/1984, R.E.S.Clegg,  SA files entombed in scratch disk. Logical</span>
<span class="sd">                                  filenames given to SA&#39;s data files.</span>
<span class="sd">   </span>
<span class="sd">        08/1995, D.P.Ruffle, Changed input file format. Increased matrices.</span>
<span class="sd">   </span>
<span class="sd">        02/1996, X.W.Liu,   Tidy up. SUBROUTINES SPLMAT, HGEN, CFY and CFD</span>
<span class="sd">                            modified such that matrix sizes (i.e. maximum</span>
<span class="sd">                            of Te and maximum no of levels) can now be cha</span>
<span class="sd">                            by modifying the parameters NDIM1, NDIM2 and N</span>
<span class="sd">                            in the Main program. EASY!</span>
<span class="sd">                            Now takes collision rates as well.</span>
<span class="sd">                            All variables are declared explicitly</span>
<span class="sd">                            Generate two extra files (ionpop.lis and ionra</span>
<span class="sd">                            of plain stream format for plotting.</span>
<span class="sd">   </span>
<span class="sd">        06/1996, C.J.Pritchet, Changed input data format for cases IBIG=1,2.</span>
<span class="sd">                            Fixed readin bug for IBIG=2 case.</span>
<span class="sd">                            Now reads reformatted upsilons (easier to see</span>
<span class="sd">                            and the 0 0 0 data end is excluded for these c</span>
<span class="sd">                            The A values have a different format for IBIG=.</span>
<span class="sd">   </span>
<span class="sd">        2006, B.Ercolano,   Converted to F90.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">4.13566766225e-15</span> <span class="c1"># eV.s #6.62606957e-27 # erg.s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s</span>
   <span class="n">k_b</span> <span class="o">=</span> <span class="mf">8.617330350e-5</span> <span class="c1"># eV/K # 1.3806485279e-16 # erg/K</span>
   
   <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.1415926535897931e0</span>
   <span class="n">h_bar_planck</span> <span class="o">=</span> <span class="mf">1.054571800e-27</span> <span class="c1">#erg.s</span>
   <span class="n">me</span> <span class="o">=</span> <span class="mf">9.10938356e-28</span> <span class="c1"># gram</span>
   <span class="n">k_b_erg</span> <span class="o">=</span> <span class="mf">1.38064852e-16</span> <span class="c1"># erg/K</span>
   <span class="n">beta1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">h_bar_planck</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_b_erg</span> <span class="o">*</span> <span class="n">me</span><span class="p">))</span> <span class="o">/</span> <span class="n">me</span><span class="p">)</span> <span class="c1"># 8.629D-06</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;elj_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">omij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;omij_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">aij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;aij_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">level_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">level_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elj_data</span><span class="p">)</span>
   <span class="n">t_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Number of temperature intervals</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">irats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">irats</span> <span class="o">=</span> <span class="mi">0</span>
   
   <span class="n">t_lin_list</span> <span class="o">=</span> <span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">t_log_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t_lin_list</span><span class="p">)</span> <span class="c1"># temperature intervals (array)</span>
   
   <span class="n">aij</span> <span class="o">=</span><span class="n">aij_data</span><span class="p">[</span><span class="s1">&#39;aij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Transition Probabilities (A_ij)</span>
   <span class="n">aij</span><span class="o">=</span><span class="n">aij</span><span class="o">.</span><span class="n">T</span>
   <span class="n">ej</span> <span class="o">=</span> <span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;ej&#39;</span><span class="p">]</span> <span class="c1"># Energy Levels (E_j) in cm-1</span>
   <span class="n">gj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;j_v&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="c1"># Ground Levels (G_j)</span>
   
   <span class="n">qj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t_num</span><span class="p">)</span>
   <span class="n">qij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">level_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">))</span>
   <span class="n">equilib_eqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">level_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">))</span>
   <span class="n">nlj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">level_num</span><span class="p">)</span>
   
   <span class="n">qij</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">equilib_eqs</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">nlj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   
   <span class="n">t_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">t_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coll. strengths available for 1 Te only - assuming const&#39;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="k">if</span> <span class="p">(</span><span class="n">t_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coll. strengths available for 2 Te only - linear interp&#39;</span><span class="p">)</span>
   <span class="c1"># Derive the interpolated effective collision strengths (Omij_T) from collision strengths data (Omij)</span>
   <span class="c1"># Obtain collisional de-excitation and excitation rates (Qij) from the effective collision strengths (Omij_T)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">eff_omij</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">omij_t</span> <span class="o">=</span> <span class="n">get_omij_temp</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="n">level_num</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="n">irats</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">omij_t</span> <span class="o">=</span> <span class="n">eff_omij</span>
   <span class="n">omij_t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">omij_t</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">level_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">level_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
         <span class="n">d_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ej</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ej</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="c1"># delta Energy in eV# convert from cm-1 to eV</span>
         <span class="c1"># Calculate the Boltzmann factor</span>
         <span class="n">exp_de_kt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d_e</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_b</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">)))</span> <span class="c1"># Maxwell-Boltzmann distribution</span>
         <span class="c1"># Obtain collisional de-excitation and excitation rates from the effective collision strengths Omij_T</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">irats</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">qij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">omij_t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp_de_kt</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">gj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span> <span class="c1"># collisional excitation rates</span>
            <span class="n">qij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">omij_t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">gj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span> <span class="c1"># collisional de-excitation rates</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="n">qij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">omij_t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp_de_kt</span> <span class="o">*</span> <span class="mf">10.</span> <span class="o">**</span> <span class="n">irats</span> <span class="c1"># collisional excitation rates</span>
            <span class="n">qij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">gj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">qij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">exp_de_kt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">gj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="c1"># collisional de-excitation rates</span>
   <span class="c1"># Calculate the critical densities</span>
   <span class="c1"># N_crit_i = Sum_{j} (Aij) / Sum_{j} (Qij)</span>
   <span class="c1">#A_i_sum = TOTAL(Aij, 2) # Sum each of the columns in Aij</span>
   <span class="c1">#Q_i_sum = TOTAL(Qij, 2) # Sum each of the columns in Qij</span>
   <span class="c1">#N_crit=A_i_tot/Q_i_tot # critical densities</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">level_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">level_num</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">):</span>   
            <span class="c1"># the equations for the equilibrium level populations:</span>
            <span class="c1"># collisional de-excitation eqs -  collisional excitation eqs = 0</span>
            <span class="c1"># Sum_{j ne i} (Ne * Nj * Qji) + Sum_{j &gt; i} (Nj Aji)</span>
            <span class="c1">#    - (Sum_{j ne i} (Ne * Ni * Qij) + Sum_{j &lt; i} (Ni Aij)) = 0</span>
            <span class="n">equilib_eqs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">equilib_eqs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">density</span> <span class="o">*</span> <span class="n">qij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># collisional de-excitation</span>
            <span class="n">equilib_eqs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">equilib_eqs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">density</span> <span class="o">*</span> <span class="n">qij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># collisional excitation</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">):</span>   
               <span class="n">equilib_eqs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">equilib_eqs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># collisional de-excitation</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">equilib_eqs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">equilib_eqs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">aij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># collisional excitation</span>
   <span class="n">b0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="o">-</span><span class="n">equilib_eqs</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">equilib_eqs</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">equilib_eqs</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
   <span class="n">a0</span> <span class="o">=</span> <span class="p">(</span><span class="n">equilib_eqs</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
   <span class="c1"># Solve the equations for the equilibrium level populations</span>
   <span class="c1"># A.X = B</span>
   <span class="c1"># A: Matrix for the equilibrium level populations equations (i,j), Equilib_Eqs[*,*]</span>
   <span class="c1"># B: Vector for the equilibrium level populations equations (i,j=0), Equilib_Eqs[*,0]</span>
   <span class="c1"># X: Ionic population density (j), Nj</span>
   <span class="c1"># X=la_linear_equation(A0, B0[0:level_num-2])# this function does not work in GDL!</span>
   <span class="c1"># ludc(a0, index0)  # Decompose A0# supported by GDL</span>
   <span class="c1"># obtain the ionic population densities (j)</span>
   <span class="c1"># x0 = lusol(a0, index0, b0[0:(level_num - 2)+1]) # Compute the solution X# supported by GDL</span>
   <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
   <span class="c1"># Calculate the atomic level populations (Nlj) from the ionic population densities (Nj)</span>
   <span class="n">nlj</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
   <span class="n">nlj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.e0</span>
   <span class="n">n_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">nlj</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
   <span class="n">nlj</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nlj</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">level_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_tot</span>
   <span class="k">return</span> <span class="n">nlj</span></div>

<div class="viewcode-block" id="calc_crit_density"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_crit_density">[docs]</a><span class="k">def</span> <span class="nf">calc_crit_density</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">elj_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">level_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates critical densities in statistical equilibrium</span>
<span class="sd">        for given electron temperature.</span>
<span class="sd">   </span>
<span class="sd">    :Returns:</span>
<span class="sd">       type=array/object. This function returns the critical densities.</span>
<span class="sd">   </span>
<span class="sd">    :Keywords:</span>
<span class="sd">        temperature :   in, required, type=float</span>
<span class="sd">                        electron temperature</span>
<span class="sd">        elj_data    :   in, required, type=array/object</span>
<span class="sd">                               energy levels (Ej) data</span>
<span class="sd">        omij_data   :   in, required, type=array/object</span>
<span class="sd">                               collision strengths (omega_ij) data</span>
<span class="sd">        aij_data    :   in, required, type=array/object</span>
<span class="sd">                               transition probabilities (Aij) data</span>
<span class="sd">        level_num   :   in, type=int</span>
<span class="sd">                        Number of levels</span>
<span class="sd">        irats       :   in, type=int</span>
<span class="sd">                        Else Coll. rates = tabulated values * 10 ** irats</span>
<span class="sd">   </span>
<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>
<span class="sd">   </span>
<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_dir = os.path.join(&#39;atomic-data&#39;, &#39;chianti70&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_elj_file = os.path.join(base_dir,data_dir, &#39;AtomElj.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_omij_file = os.path.join(base_dir,data_dir, &#39;AtomOmij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_aij_file = os.path.join(base_dir,data_dir, &#39;AtomAij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;s&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39;</span>
<span class="sd">        &gt;&gt;&gt; s_ii_elj=atomneb.read_elj(atom_elj_file, atom, ion, level_num=5) # read Energy Levels (Ej)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_omij=atomneb.read_omij(atom_omij_file, atom, ion) # read Collision Strengths (Omegaij)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_aij=atomneb.read_aij(atom_aij_file, atom, ion) # read Transition Probabilities (Aij)\</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; n_crit=pyequib.calc_crit_density(temperature=temperature,</span>
<span class="sd">        &gt;&gt;&gt;                          elj_data=s_ii_elj, omij_data=s_ii_omij,</span>
<span class="sd">        &gt;&gt;&gt;                          aij_data=s_ii_aij)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Critical Densities:&#39;, n_crit)</span>
<span class="sd">           Critical Densities:       0.0000000       5007.8396       1732.8414       1072685.0       2220758.1</span>
<span class="sd">   </span>
<span class="sd">    :Categories:</span>
<span class="sd">      Plasma Diagnostics, Abundance Analysis, Collisionally Excited Lines</span>
<span class="sd">   </span>
<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>
<span class="sd">   </span>
<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>
<span class="sd">   </span>
<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>
<span class="sd">   </span>
<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>
<span class="sd">   </span>
<span class="sd">    :History:</span>
<span class="sd">        15/09/2013, A. Danehkar, Translated from FORTRAN to IDL code.</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced str2int with strnumber.</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced CFY, SPLMAT, and CFD with</span>
<span class="sd">             IDL function INTERPOL( /SPLINE).</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced LUSLV with IDL LAPACK function</span>
<span class="sd">                          LA_LINEAR_EQUATION.</span>
<span class="sd">   </span>
<span class="sd">        15/11/2016, A. Danehkar, Replaced LA_LINEAR_EQUATION (not work in GDL)</span>
<span class="sd">              with IDL function LUDC &amp; LUSOL.</span>
<span class="sd">   </span>
<span class="sd">        19/11/2016, A. Danehkar, Replaced INTERPOL (not accurate) with</span>
<span class="sd">                       SPL_INIT &amp; SPL_INTERP.</span>
<span class="sd">   </span>
<span class="sd">        20/11/2016, A. Danehkar, Made a new function calc_populations()</span>
<span class="sd">          for solving atomic level populations and separated it from</span>
<span class="sd">          calc_abundance(), calc_density() and calc_temperature().</span>
<span class="sd">   </span>
<span class="sd">        10/03/2017, A. Danehkar, Integration with AtomNeb, now uses atomic data</span>
<span class="sd">                         input elj_data, omij_data, aij_data.</span>
<span class="sd">   </span>
<span class="sd">        12/06/2017, A. Danehkar, Cleaning the function, and remove unused varibales</span>
<span class="sd">                           from calc_populations().</span>
<span class="sd">   </span>
<span class="sd">        27/02/2019, A. Danehkar, Simplify the calc_populations() routine</span>
<span class="sd">                           for external usage.</span>
<span class="sd">   </span>
<span class="sd">        01/03/2019, A. Danehkar, Create the calc_crit_density() routine</span>
<span class="sd">                           from the calc_populations() routine.</span>
<span class="sd">   </span>
<span class="sd">        04/03/2019, A. Danehkar, Use the get_omij_temp() routine.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>

<span class="sd">    FORTRAN HISTORY:</span>
<span class="sd">   </span>
<span class="sd">        03/05/1981, I.D.Howarth,  Version 1.</span>
<span class="sd">   </span>
<span class="sd">        05/05/1981, I.D.Howarth,  Minibug fixed!</span>
<span class="sd">   </span>
<span class="sd">        07/05/1981, I.D.Howarth,  Now takes collision rates or strengths.</span>
<span class="sd">   </span>
<span class="sd">        03/08/1981, S.Adams,      Interpolates collision strengths.</span>
<span class="sd">   </span>
<span class="sd">        07/08/1981, S.Adams,      Input method changed.</span>
<span class="sd">   </span>
<span class="sd">        19/11/1984, R.E.S.Clegg,  SA files entombed in scratch disk. Logical</span>
<span class="sd">                                  filenames given to SA&#39;s data files.</span>
<span class="sd">   </span>
<span class="sd">        08/1995, D.P.Ruffle, Changed input file format. Increased matrices.</span>
<span class="sd">   </span>
<span class="sd">        02/1996, X.W.Liu,   Tidy up. SUBROUTINES SPLMAT, HGEN, CFY and CFD</span>
<span class="sd">                            modified such that matrix sizes (i.e. maximum</span>
<span class="sd">                            of Te and maximum no of levels) can now be cha</span>
<span class="sd">                            by modifying the parameters NDIM1, NDIM2 and N</span>
<span class="sd">                            in the Main program. EASY!</span>
<span class="sd">                            Now takes collision rates as well.</span>
<span class="sd">                            All variables are declared explicitly</span>
<span class="sd">                            Generate two extra files (ionpop.lis and ionra</span>
<span class="sd">                            of plain stream format for plotting.</span>
<span class="sd">   </span>
<span class="sd">        06/1996, C.J.Pritchet, Changed input data format for cases IBIG=1,2.</span>
<span class="sd">                            Fixed readin bug for IBIG=2 case.</span>
<span class="sd">                            Now reads reformatted upsilons (easier to see</span>
<span class="sd">                            and the 0 0 0 data end is excluded for these c</span>
<span class="sd">                            The A values have a different format for IBIG=.</span>
<span class="sd">   </span>
<span class="sd">        2006, B.Ercolano,   Converted to F90.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">4.13566766225e-15</span> <span class="c1"># eV.s #6.62606957e-27 # erg.s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s</span>
   <span class="n">k_b</span> <span class="o">=</span> <span class="mf">8.617330350e-5</span> <span class="c1"># eV/K # 1.3806485279e-16 # erg/K</span>
   
   <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.1415926535897931e0</span>
   <span class="n">h_bar_planck</span> <span class="o">=</span> <span class="mf">1.054571800e-27</span> <span class="c1">#erg.s</span>
   <span class="n">me</span> <span class="o">=</span> <span class="mf">9.10938356e-28</span> <span class="c1"># gram</span>
   <span class="n">k_b_erg</span> <span class="o">=</span> <span class="mf">1.38064852e-16</span> <span class="c1"># erg/K</span>
   <span class="n">beta1</span> <span class="o">=</span> <span class="n">h_bar_planck</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_b_erg</span> <span class="o">*</span> <span class="n">me</span><span class="p">))</span> <span class="o">/</span> <span class="n">me</span> <span class="c1"># 8.629D-06</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;elj_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">omij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;omij_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">aij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;aij_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">level_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">level_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elj_data</span><span class="p">)</span>
   <span class="n">t_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Number of temperature intervals</span>
   <span class="n">omij_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">)</span>
   <span class="n">omij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">t_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">))</span>
   <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">omij_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;level1&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
      <span class="n">j</span> <span class="o">=</span> <span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;level2&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="n">level_num</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">level_num</span><span class="p">):</span>
         <span class="n">omij</span><span class="p">[</span><span class="mi">0</span><span class="p">:(</span><span class="n">t_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">irats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">irats</span> <span class="o">=</span> <span class="mi">0</span>
   
   <span class="n">t_lin_list</span> <span class="o">=</span> <span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">t_log_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t_lin_list</span><span class="p">)</span> <span class="c1"># temperature intervals (array)</span>

   <span class="n">aij</span> <span class="o">=</span> <span class="n">aij_data</span><span class="p">[</span><span class="s1">&#39;aij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Transition Probabilities (A_ij)</span>
   <span class="n">aij</span><span class="o">=</span><span class="n">aij</span><span class="o">.</span><span class="n">T</span>
   <span class="n">ej</span> <span class="o">=</span> <span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;ej&#39;</span><span class="p">]</span> <span class="c1"># Energy Levels (E_j) in cm-1</span>
   <span class="n">gj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;j_v&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>  <span class="c1"># Ground Levels (G_j)</span>
   
   <span class="n">qj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t_num</span><span class="p">)</span>
   <span class="n">qij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">level_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">))</span>
   <span class="n">equilib_eqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">level_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">))</span>
   <span class="n">nlj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">level_num</span><span class="p">)</span>
   
   <span class="n">qij</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">equilib_eqs</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">nlj</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   
   <span class="n">t_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">t_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coll. strengths available for 1 Te only - assuming const&#39;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="k">if</span> <span class="p">(</span><span class="n">t_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coll. strengths available for 2 Te only - linear interp&#39;</span><span class="p">)</span>
   <span class="c1"># Derive the interpolated effective collision strengths (Omij_T) from collision strengths data (Omij)</span>
   <span class="c1"># Obtain collisional de-excitation and excitation rates (Qij) from the effective collision strengths (Omij_T)</span>
   <span class="n">omij_t</span> <span class="o">=</span> <span class="n">get_omij_temp</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="n">level_num</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="n">irats</span><span class="p">)</span>
   <span class="n">omij_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">omij_t</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">level_num</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">level_num</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">d_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ej</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ej</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="c1"># delta Energy in eV# convert from cm-1 to eV</span>
         <span class="c1"># Calculate the Boltzmann factor</span>
         <span class="n">exp_de_kt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d_e</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_b</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">))</span> <span class="c1"># Maxwell-Boltzmann distribution</span>
         <span class="c1"># Obtain collisional de-excitation and excitation rates from the effective collision strengths Omij_T</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">irats</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>   
            <span class="n">qij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">omij_t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp_de_kt</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">gj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span> <span class="c1"># collisional excitation rates</span>
            <span class="n">qij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta1</span> <span class="o">*</span> <span class="n">omij_t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">gj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span> <span class="c1"># collisional de-excitation rates</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="n">qij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">omij_t</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp_de_kt</span> <span class="o">*</span> <span class="mf">10.</span> <span class="o">**</span> <span class="n">irats</span> <span class="c1"># collisional excitation rates</span>
            <span class="n">qij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">gj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">qij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">exp_de_kt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">gj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="c1"># collisional de-excitation rates</span>
   <span class="c1"># Calculate the critical densities</span>
   <span class="c1"># N_crit_i = Sum_{j} (Aij) / Sum_{j} (Qij)</span>
   <span class="n">a_i_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">aij</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Sum each of the columns in Aij</span>
   <span class="n">q_i_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">qij</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Sum each of the columns in Qij</span>
   <span class="n">len1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">a_i_sum</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">q_i_sum</span><span class="p">)])</span>
   <span class="n">n_crit</span> <span class="o">=</span> <span class="n">a_i_sum</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">len1</span><span class="p">]</span> <span class="o">/</span> <span class="n">q_i_sum</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">len1</span><span class="p">]</span> <span class="c1"># critical densities</span>
   <span class="k">return</span> <span class="n">n_crit</span></div>

<div class="viewcode-block" id="calc_emissivity"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emissivity">[docs]</a><span class="k">def</span> <span class="nf">calc_emissivity</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">atomic_levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">elj_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates line emissivities for specified ion with level(s) by</span>
<span class="sd">        solving atomic level populations and in statistical equilibrium</span>
<span class="sd">        for given electron density and temperature.</span>
<span class="sd">   </span>
<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the line emissivity.</span>
<span class="sd">   </span>
<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :     in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density       :     in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        atomic_levels :     In, required, type=string</span>
<span class="sd">                            level(s) e.g &#39;1,2/&#39;, &#39;1,2,1,3/&#39;</span>
<span class="sd">        elj_data      :     in, required, type=array/object</span>
<span class="sd">                            energy levels (Ej) data</span>
<span class="sd">        omij_data     :     in, required, type=array/object</span>
<span class="sd">                            collision strengths (omega_ij) data</span>
<span class="sd">        aij_data      :     in, required, type=array/object</span>
<span class="sd">                            transition probabilities (Aij) data</span>
<span class="sd">   </span>
<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>
<span class="sd">   </span>
<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_dir = os.path.join(&#39;atomic-data&#39;, &#39;chianti70&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_elj_file = os.path.join(base_dir,data_dir, &#39;AtomElj.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_omij_file = os.path.join(base_dir,data_dir, &#39;AtomOmij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_aij_file = os.path.join(base_dir,data_dir, &#39;AtomAij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;o&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39;</span>
<span class="sd">        &gt;&gt;&gt; o_iii_elj=atomneb.read_elj(atom_elj_file, atom, ion, level_num=5) # read Energy Levels (Ej)</span>
<span class="sd">        &gt;&gt;&gt; o_iii_omij=atomneb.read_omij(atom_omij_file, atom, ion) # read Collision Strengths (Omegaij)</span>
<span class="sd">        &gt;&gt;&gt; o_iii_aij=atomneb.read_aij(atom_aij_file, atom, ion) # read Transition Probabilities (Aij)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; atomic_levels=&#39;3,4/&#39;</span>
<span class="sd">        &gt;&gt;&gt; emiss5007=np.float64(0.0)</span>
<span class="sd">        &gt;&gt;&gt; emiss5007=pyequib.calc_emissivity(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                           atomic_levels=atomic_levels,</span>
<span class="sd">        &gt;&gt;&gt;                           elj_data=o_iii_elj, omij_data=o_iii_omij,</span>
<span class="sd">        &gt;&gt;&gt;                           aij_data=o_iii_aij</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Emissivity(O III 5007):&#39;, emiss5007)</span>
<span class="sd">           Emissivity(O III 5007):   3.6041012e-21</span>
<span class="sd">   </span>
<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Collisionally Excited Lines, Emissivity</span>
<span class="sd">   </span>
<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>
<span class="sd">   </span>
<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>
<span class="sd">   </span>
<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>
<span class="sd">   </span>
<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>
<span class="sd">   </span>
<span class="sd">    :History:</span>
<span class="sd">        15/09/2013, A. Danehkar, Translated from FORTRAN to IDL code.</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced str2int with strnumber.</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced CFY, SPLMAT, and CFD with</span>
<span class="sd">             IDL function INTERPOL( /SPLINE).</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced LUSLV with IDL LAPACK function</span>
<span class="sd">                          LA_LINEAR_EQUATION.</span>
<span class="sd">   </span>
<span class="sd">        15/11/2016, A. Danehkar, Replaced LA_LINEAR_EQUATION (not work in GDL)</span>
<span class="sd">              with IDL function LUDC &amp; LUSOL.</span>
<span class="sd">   </span>
<span class="sd">        19/11/2016, A. Danehkar, Replaced INTERPOL (not accurate) with</span>
<span class="sd">                       SPL_INIT &amp; SPL_INTERP.</span>
<span class="sd">   </span>
<span class="sd">        20/11/2016, A. Danehkar, Made a new function calc_populations()</span>
<span class="sd">          for solving atomic level populations and separated it from</span>
<span class="sd">          calc_abundance(), calc_density() and calc_temperature().</span>
<span class="sd">   </span>
<span class="sd">        21/11/2016, A. Danehkar, Made a new function calc_emissivity()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abundance().</span>
<span class="sd">   </span>
<span class="sd">        10/03/2017, A. Danehkar, Integration with AtomNeb, now uses atomic data</span>
<span class="sd">                         input elj_data, omij_data, aij_data.</span>
<span class="sd">   </span>
<span class="sd">        12/06/2017, A. Danehkar, Cleaning the function, and remove unused varibales</span>
<span class="sd">                           from calc_emissivity().</span>
<span class="sd">   </span>
<span class="sd">        27/06/2019, A. Danehkar, Use the simplified calc_populations() routine.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>

<span class="sd">    FORTRAN HISTORY:</span>
<span class="sd">   </span>
<span class="sd">        03/05/1981, I.D.Howarth,  Version 1.</span>
<span class="sd">   </span>
<span class="sd">        05/05/1981, I.D.Howarth,  Minibug fixed!</span>
<span class="sd">   </span>
<span class="sd">        07/05/1981, I.D.Howarth,  Now takes collision rates or strengths.</span>
<span class="sd">   </span>
<span class="sd">        03/08/1981, S.Adams,      Interpolates collision strengths.</span>
<span class="sd">   </span>
<span class="sd">        07/08/1981, S.Adams,      Input method changed.</span>
<span class="sd">   </span>
<span class="sd">        19/11/1984, R.E.S.Clegg,  SA files entombed in scratch disk. Logical</span>
<span class="sd">                                  filenames given to SA&#39;s data files.</span>
<span class="sd">   </span>
<span class="sd">        08/1995, D.P.Ruffle, Changed input file format. Increased matrices.</span>
<span class="sd">   </span>
<span class="sd">        02/1996, X.W.Liu,   Tidy up. SUBROUTINES SPLMAT, HGEN, CFY and CFD</span>
<span class="sd">                            modified such that matrix sizes (i.e. maximum</span>
<span class="sd">                            of Te and maximum no of levels) can now be cha</span>
<span class="sd">                            by modifying the parameters NDIM1, NDIM2 and N</span>
<span class="sd">                            in the Main program. EASY!</span>
<span class="sd">                            Now takes collision rates as well.</span>
<span class="sd">                            All variables are declared explicitly</span>
<span class="sd">                            Generate two extra files (ionpop.lis and ionra</span>
<span class="sd">                            of plain stream format for plotting.</span>
<span class="sd">   </span>
<span class="sd">        06/1996, C.J.Pritchet, Changed input data format for cases IBIG=1,2.</span>
<span class="sd">                            Fixed readin bug for IBIG=2 case.</span>
<span class="sd">                            Now reads reformatted upsilons (easier to see</span>
<span class="sd">                            and the 0 0 0 data end is excluded for these c</span>
<span class="sd">                            The A values have a different format for IBIG=.</span>
<span class="sd">   </span>
<span class="sd">        2006, B.Ercolano,   Converted to F90.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1">#global atomic_data_path</span>
   
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s                    </span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy Levels data (elj_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">omij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Collision Strengths (omij_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">aij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transition Probabilities (aij_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">atomic_levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Atomic levels (atomic_levels) are not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">irats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">itemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ikt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   
   <span class="n">eji</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

   <span class="n">levels_str</span> <span class="o">=</span> <span class="n">do_strsplit</span><span class="p">(</span><span class="n">atomic_levels</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">escapech</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
   <span class="n">levels_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">levels_str</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
   <span class="n">itranc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">levels_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
   <span class="n">itranc</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">levels_i</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="n">levels_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">levels_num</span><span class="p">):</span>
       <span class="n">itranc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">levels_str</span><span class="p">[</span><span class="n">levels_i</span><span class="p">])</span>
       <span class="n">itranc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_str2int</span><span class="p">(</span><span class="n">levels_str</span><span class="p">[</span><span class="n">levels_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
       <span class="n">levels_i</span> <span class="o">=</span> <span class="n">levels_i</span> <span class="o">+</span> <span class="mi">2</span>
       <span class="c1"># if levels_i &gt;= levels_num:</span>
       <span class="c1">#   break</span>
   <span class="n">irats</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">aij</span> <span class="o">=</span> <span class="n">aij_data</span><span class="p">[</span><span class="s1">&#39;aij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">aij</span><span class="o">=</span><span class="n">aij</span><span class="o">.</span><span class="n">T</span>
   <span class="n">elj</span> <span class="o">=</span> <span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;ej&#39;</span><span class="p">]</span>
   
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">nlj</span> <span class="o">=</span> <span class="n">calc_populations</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">elj_data</span><span class="o">=</span><span class="n">elj_data</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="n">aij_data</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="n">irats</span><span class="p">)</span>
   
   <span class="n">emissivity_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">ikt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">levels_num</span><span class="p">):</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
      <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">itranc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">ikt</span><span class="p">])</span>
      <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.e0</span><span class="p">):</span>
         <span class="n">eji</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
         <span class="n">wav</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">eji</span>
         <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">nlj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aij</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="p">(</span><span class="n">wav</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
         <span class="n">emissivity_all</span> <span class="o">=</span> <span class="n">emissivity_all</span> <span class="o">+</span> <span class="n">emissivity_line</span>
   <span class="k">return</span> <span class="n">emissivity_all</span></div>

<div class="viewcode-block" id="calc_abundance"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abundance">[docs]</a><span class="k">def</span> <span class="nf">calc_abundance</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atomic_levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">elj_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines the ionic abundance from the observed</span>
<span class="sd">        flux intensity for specified ion with level(s)</span>
<span class="sd">        by solving atomic level populations and</span>
<span class="sd">        line emissivities in statistical equilibrium</span>
<span class="sd">        for given electron density and temperature.</span>
<span class="sd">   </span>
<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the ionic abundanc.</span>
<span class="sd">   </span>
<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :     in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density       :     in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        line_flux     :     in, required, type=float</span>
<span class="sd">                            line flux intensity</span>
<span class="sd">        atomic_levels :     in, required, type=string</span>
<span class="sd">                            level(s) e.g &#39;1,2/&#39;, &#39;1,2,1,3/&#39;</span>
<span class="sd">        elj_data      :     in, required, type=array/object</span>
<span class="sd">                            energy levels (Ej) data</span>
<span class="sd">        omij_data     :     in, required, type=array/object</span>
<span class="sd">                            collision strengths (omega_ij) data</span>
<span class="sd">        aij_data      :     in, required, type=array/object</span>
<span class="sd">                            transition probabilities (Aij) data</span>
<span class="sd">        h_i_aeff_data :     in, required, type=array/object</span>
<span class="sd">                            H I recombination coefficients</span>
<span class="sd">   </span>
<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>
<span class="sd">   </span>
<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_dir = os.path.join(&#39;atomic-data&#39;, &#39;chianti70&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_elj_file = os.path.join(base_dir,data_dir, &#39;AtomElj.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_omij_file = os.path.join(base_dir,data_dir, &#39;AtomOmij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_aij_file = os.path.join(base_dir,data_dir, &#39;AtomAij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;o&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39;</span>
<span class="sd">        &gt;&gt;&gt; o_iii_elj=atomneb.read_elj(atom_elj_file, atom, ion, level_num=5) # read Energy Levels (Ej)</span>
<span class="sd">        &gt;&gt;&gt; o_iii_omij=atomneb.read_omij(atom_omij_file, atom, ion) # read Collision Strengths (Omegaij)</span>
<span class="sd">        &gt;&gt;&gt; o_iii_aij=atomneb.read_aij(atom_aij_file, atom, ion) # read Transition Probabilities (Aij)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">        &gt;&gt;&gt; hi_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; h_i_aeff_data=hi_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; atomic_levels=&#39;3,4/&#39;</span>
<span class="sd">        &gt;&gt;&gt; iobs5007=np.float64(1200.0)</span>
<span class="sd">        &gt;&gt;&gt; abb5007=np.float64(0.0)</span>
<span class="sd">        &gt;&gt;&gt; abb5007=pyequib.calc_abundance(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                        line_flux=iobs5007, atomic_levels=atomic_levels,</span>
<span class="sd">        &gt;&gt;&gt;                        elj_data=o_iii_elj, omij_data=o_iii_omij,</span>
<span class="sd">        &gt;&gt;&gt;                        aij_data=o_iii_aij, h_i_aeff_data=hi_rc_data[&#39;aeff&#39;][0])</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;N(O^2+)/N(H+):&#39;, abb5007)</span>
<span class="sd">           N(O^2+)/N(H+):   0.00041256231</span>
<span class="sd">   </span>
<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Collisionally Excited Lines</span>
<span class="sd">   </span>
<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>
<span class="sd">   </span>
<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>
<span class="sd">   </span>
<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>
<span class="sd">   </span>
<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>
<span class="sd">   </span>
<span class="sd">    :History:</span>
<span class="sd">        15/09/2013, A. Danehkar, Translated from FORTRAN to IDL code.</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced str2int with strnumber.</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced CFY, SPLMAT, and CFD with</span>
<span class="sd">             IDL function INTERPOL( /SPLINE).</span>
<span class="sd">   </span>
<span class="sd">        20/10/2016, A. Danehkar, Replaced LUSLV with IDL LAPACK function</span>
<span class="sd">                          LA_LINEAR_EQUATION.</span>
<span class="sd">   </span>
<span class="sd">        15/11/2016, A. Danehkar, Replaced LA_LINEAR_EQUATION (not work in GDL)</span>
<span class="sd">              with IDL function LUDC &amp; LUSOL.</span>
<span class="sd">   </span>
<span class="sd">        19/11/2016, A. Danehkar, Replaced INTERPOL (not accurate) with</span>
<span class="sd">                       SPL_INIT &amp; SPL_INTERP.</span>
<span class="sd">   </span>
<span class="sd">        20/11/2016, A. Danehkar, Made a new function calc_populations()</span>
<span class="sd">          for solving atomic level populations and separated it from</span>
<span class="sd">          calc_abundance(), calc_density() and calc_temperature().</span>
<span class="sd">   </span>
<span class="sd">        21/11/2016, A. Danehkar, Made a new function calc_emissivity()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abundance().</span>
<span class="sd">   </span>
<span class="sd">        10/03/2017, A. Danehkar, Integration with AtomNeb, now uses atomic data</span>
<span class="sd">                         input elj_data, omij_data, aij_data.</span>
<span class="sd">   </span>
<span class="sd">        12/06/2017, A. Danehkar, Cleaning the function, and remove unused varibales</span>
<span class="sd">                           from calc_abundance().</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>

<span class="sd">    FORTRAN HISTORY:</span>
<span class="sd">   </span>
<span class="sd">        03/05/1981, I.D.Howarth,  Version 1.</span>
<span class="sd">   </span>
<span class="sd">        05/05/1981, I.D.Howarth,  Minibug fixed!</span>
<span class="sd">   </span>
<span class="sd">        07/05/1981, I.D.Howarth,  Now takes collision rates or strengths.</span>
<span class="sd">   </span>
<span class="sd">        03/08/1981, S.Adams,      Interpolates collision strengths.</span>
<span class="sd">   </span>
<span class="sd">        07/08/1981, S.Adams,      Input method changed.</span>
<span class="sd">   </span>
<span class="sd">        19/11/1984, R.E.S.Clegg,  SA files entombed in scratch disk. Logical</span>
<span class="sd">                                  filenames given to SA&#39;s data files.</span>
<span class="sd">   </span>
<span class="sd">        08/1995, D.P.Ruffle, Changed input file format. Increased matrices.</span>
<span class="sd">   </span>
<span class="sd">        02/1996, X.W.Liu,   Tidy up. SUBROUTINES SPLMAT, HGEN, CFY and CFD</span>
<span class="sd">                            modified such that matrix sizes (i.e. maximum</span>
<span class="sd">                            of Te and maximum no of levels) can now be cha</span>
<span class="sd">                            by modifying the parameters NDIM1, NDIM2 and N</span>
<span class="sd">                            in the Main program. EASY!</span>
<span class="sd">                            Now takes collision rates as well.</span>
<span class="sd">                            All variables are declared explicitly</span>
<span class="sd">                            Generate two extra files (ionpop.lis and ionra</span>
<span class="sd">                            of plain stream format for plotting.</span>
<span class="sd">   </span>
<span class="sd">        06/1996, C.J.Pritchet, Changed input data format for cases IBIG=1,2.</span>
<span class="sd">                            Fixed readin bug for IBIG=2 case.</span>
<span class="sd">                            Now reads reformatted upsilons (easier to see</span>
<span class="sd">                            and the 0 0 0 data end is excluded for these c</span>
<span class="sd">                            The A values have a different format for IBIG=.</span>
<span class="sd">   </span>
<span class="sd">        2006, B.Ercolano,   Converted to F90.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">ahb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg.s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s </span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy Levels data (elj_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">omij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Collision Strengths (omij_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">aij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Transition Probabilities (aij_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">atomic_levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Atomic levels (atomic_levels) are not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="c1">#  T4=temperature*1.0D-4</span>
   <span class="c1">#  AHB=3.036D-14*T4^(-0.87D0) ; Brocklehurt 1971; Aller (1984), Physics of Thermal Gaseous Nebulae, p. 76</span>
   <span class="c1">#  WAVHB=4861.33D ;4861.D0</span>
   <span class="c1">#  emissivity_Hbeta=AHB*h_Planck*c_Speed*1.e8/WAVHB ; N(H+) * N(e-) (erg/s)</span>
   <span class="c1"># emissivity_Hbeta=1.387D-25*T4^(-0.983D0)* 10.D0^(-0.0424D0/T4) ;  Brocklehurst (1971); Aller (1984)</span>
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   <span class="n">emissivity_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">emissivity_all</span> <span class="o">=</span> <span class="n">calc_emissivity</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">atomic_levels</span><span class="o">=</span><span class="n">atomic_levels</span><span class="p">,</span> <span class="n">elj_data</span><span class="o">=</span><span class="n">elj_data</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="n">aij_data</span><span class="p">)</span>
   
   <span class="k">if</span> <span class="n">emissivity_all</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cannot calculate emissivity&quot;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity_all</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="print_ionic"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.print_ionic">[docs]</a><span class="k">def</span> <span class="nf">print_ionic</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">elj_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">printemissivity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printpopulations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">printcritdensity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       This function prints the atom&#39;s transitions information,</span>
<span class="sd">       atomic level populations, critical densities, and emissivities</span>
<span class="sd">       for given temperature and density.</span>
<span class="sd">   </span>
<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :   in, required, type=float</span>
<span class="sd">                          electron temperature</span>
<span class="sd">        density       :   in, required, type=float</span>
<span class="sd">                          electron density</span>
<span class="sd">        elj_data      :   in, required, type=array/object</span>
<span class="sd">                          energy levels (Ej) data</span>
<span class="sd">        omij_data     :   in, required, type=array/object</span>
<span class="sd">                          collision strengths (omega_ij) data</span>
<span class="sd">        aij_data      :   in, required, type=array/object</span>
<span class="sd">                          transition probabilities (Aij) data</span>
<span class="sd">        h_i_aeff_data :   in, type=array/object</span>
<span class="sd">                          H I recombination coefficients</span>
<span class="sd">        printEmissivity  :   in, type=boolean</span>
<span class="sd">                             Set for printing Emissivities</span>
<span class="sd">        printPopulations :   in, type=boolean</span>
<span class="sd">                             Set for printing Populations</span>
<span class="sd">        printCritDensity  :  in, type=boolean</span>
<span class="sd">                             Set for printing Critical Densities</span>
<span class="sd">   </span>
<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>
<span class="sd">   </span>
<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_dir = os.path.join(&#39;atomic-data&#39;, &#39;chianti70&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_elj_file = os.path.join(base_dir,data_dir, &#39;AtomElj.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_omij_file = os.path.join(base_dir,data_dir, &#39;AtomOmij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_aij_file = os.path.join(base_dir,data_dir, &#39;AtomAij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;o&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39;</span>
<span class="sd">        &gt;&gt;&gt; o_iii_elj=atomneb.read_elj(atom_elj_file, atom, ion, level_num=5) # read Energy Levels (Ej)</span>
<span class="sd">        &gt;&gt;&gt; o_iii_omij=atomneb.read_omij(atom_omij_file, atom, ion) # read Collision Strengths (Omegaij)</span>
<span class="sd">        &gt;&gt;&gt; o_iii_aij=atomneb.read_aij(atom_aij_file, atom, ion) # read Transition Probabilities (Aij)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">        &gt;&gt;&gt; hi_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)#</span>
<span class="sd">        &gt;&gt;&gt; density = np.float64(1000.)</span>
<span class="sd">        &gt;&gt;&gt; pyequib.print_ionic, temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;              elj_data=o_iii_elj, omij_data=o_iii_omij,</span>
<span class="sd">        &gt;&gt;&gt;              aij_data=o_iii_aij, h_i_aeff_data=hi_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">           Temperature =   10000.0 K</span>
<span class="sd">           Density =    1000.0 cm-3</span>
<span class="sd">   </span>
<span class="sd">           Level    Populations   Critical Densities</span>
<span class="sd">           Level 1:   3.063E-01   0.000E+00</span>
<span class="sd">           Level 2:   4.896E-01   4.908E+02</span>
<span class="sd">           Level 3:   2.041E-01   3.419E+03</span>
<span class="sd">           Level 4:   4.427E-05   6.853E+05</span>
<span class="sd">           Level 5:   2.985E-09   2.547E+07</span>
<span class="sd">   </span>
<span class="sd">            2.597E-05</span>
<span class="sd">                88.34um</span>
<span class="sd">               (2--&gt;1)</span>
<span class="sd">            2.859E-22</span>
<span class="sd">   </span>
<span class="sd">            0.000E+00   9.632E-05</span>
<span class="sd">                32.66um      51.81um</span>
<span class="sd">               (3--&gt;1)     (3--&gt;2)</span>
<span class="sd">            0.000E+00   7.536E-22</span>
<span class="sd">   </span>
<span class="sd">            2.322E-06   6.791E-03   2.046E-02</span>
<span class="sd">              4932.60A    4960.29A    5008.24A</span>
<span class="sd">               (4--&gt;1)     (4--&gt;2)     (4--&gt;3)</span>
<span class="sd">            4.140E-25   1.204E-21   3.593E-21</span>
<span class="sd">   </span>
<span class="sd">            0.000E+00   2.255E-01   6.998E-04   1.685E+00</span>
<span class="sd">              2315.58A    2321.67A    2332.12A    4364.45A</span>
<span class="sd">               (5--&gt;1)     (5--&gt;2)     (5--&gt;3)     (5--&gt;4)</span>
<span class="sd">            0.000E+00   5.759E-24   1.779E-26   2.289E-23</span>
<span class="sd">   </span>
<span class="sd">           H-beta emissivity: 1.237E-25 N(H+) Ne  [erg/s]</span>
<span class="sd">   </span>
<span class="sd">    :Categories:</span>
<span class="sd">      Plasma Diagnostics, Abundance Analysis, Collisionally Excited Lines</span>
<span class="sd">   </span>
<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>
<span class="sd">   </span>
<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>
<span class="sd">   </span>
<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>
<span class="sd">   </span>
<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>
<span class="sd">   </span>
<span class="sd">    :History:</span>
<span class="sd">        04/03/2019, A. Danehkar, create the print_ionic() routine.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature = </span><span class="si">{0:9.1f}</span><span class="s1"> K&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density = </span><span class="si">{0:9.1f}</span><span class="s1"> cm-3&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">density</span><span class="p">))</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;elj_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">omij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;omij_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">aij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;aij_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">printemissivity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">printemissivity</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># default</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">printpopulations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">printpopulations</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># default</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">printcritdensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">printcritdensity</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># default</span>
   <span class="n">level_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elj_data</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">printpopulations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
      <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
         <span class="n">nlj</span> <span class="o">=</span> <span class="n">calc_populations</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">elj_data</span><span class="o">=</span><span class="n">elj_data</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="n">aij_data</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="n">level_num</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;calc_populations needs temperature and density.&#39;</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">printcritdensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
      <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="n">n_crit</span> <span class="o">=</span> <span class="n">calc_crit_density</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">elj_data</span><span class="o">=</span><span class="n">elj_data</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="n">omij_data</span><span class="p">,</span> <span class="n">aij_data</span><span class="o">=</span><span class="n">aij_data</span><span class="p">,</span> <span class="n">level_num</span><span class="o">=</span><span class="n">level_num</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;calc_crit_density needs temperature.&#39;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((((</span><span class="n">printcritdensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">printpopulations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))):</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Level    Populations   Critical Densities&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Level    Critical Densities&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">level_num</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
         <span class="n">level_str</span> <span class="o">=</span> <span class="s1">&#39;Level  </span><span class="si">{0:1d}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
         <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">level_str</span> <span class="o">+</span> <span class="s1">&#39;   &#39;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
            <span class="n">nlj_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:9.3E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">nlj_str</span> <span class="o">+</span> <span class="s1">&#39;   &#39;</span>
         <span class="n">n_crit_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:9.3E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_crit</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
         <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">n_crit_str</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">printemissivity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">aij</span> <span class="o">=</span> <span class="n">aij_data</span><span class="p">[</span><span class="s1">&#39;aij&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">aij</span> <span class="o">=</span> <span class="n">aij</span><span class="o">.</span><span class="n">T</span>
      <span class="n">elj</span> <span class="o">=</span> <span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;ej&#39;</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">level_num</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
         <span class="n">aij_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
         <span class="n">transition_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
         <span class="n">wavelength_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
         <span class="n">emissivity_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">eji</span> <span class="o">=</span> <span class="n">elj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">elj</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">wav</span> <span class="o">=</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="n">eji</span>
            <span class="n">aij_str</span> <span class="o">=</span> <span class="n">aij_str</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:10.3E}</span><span class="s1">  &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">wav</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>   
               <span class="n">wavelength_str</span> <span class="o">=</span> <span class="n">wavelength_str</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:10.2f}</span><span class="s1">A &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="n">wavelength_str</span> <span class="o">=</span> <span class="n">wavelength_str</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:10.2f}</span><span class="s1">um &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wav</span> <span class="o">*</span> <span class="mf">1.e-4</span><span class="p">)</span>
            <span class="n">transition_str</span> <span class="o">=</span> <span class="n">transition_str</span> <span class="o">+</span> <span class="s1">&#39;    (</span><span class="si">{0:1d}</span><span class="s1">--&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:1d}</span><span class="s1">) &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
               <span class="n">emissivity_line</span> <span class="o">=</span> <span class="n">nlj</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">aij</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span> <span class="o">/</span> <span class="p">(</span><span class="n">wav</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span>
               <span class="n">emissivity_str</span> <span class="o">=</span> <span class="n">emissivity_str</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{0:10.3E}</span><span class="s1">  &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">emissivity_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="n">emissivity_str</span> <span class="o">=</span> <span class="n">emissivity_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">aij_str</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">wavelength_str</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">transition_str</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">emissivity_str</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
            <span class="n">emissivity_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:10.3E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">emissivity_hbeta</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;H-beta emissivity:&quot;</span><span class="p">,</span> <span class="n">emissivity_str</span><span class="p">,</span> <span class="s2">&quot; N(H+) Ne  [erg/s]&quot;</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gamma_hb_4861 needs temperature and density.&#39;</span><span class="p">)</span>
   
   <span class="k">return</span></div>

<div class="viewcode-block" id="get_omij_temp"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.get_omij_temp">[docs]</a><span class="k">def</span> <span class="nf">get_omij_temp</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omij_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elj_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">level_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">irats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function derives the effective collision strengths (Omij_T) from</span>
<span class="sd">        the collision strengths (omega_ij) data for the given temperature.</span>
<span class="sd">   </span>
<span class="sd">    :Returns:</span>
<span class="sd">       type=array/object. This function returns the effective collision strengths (Omij_T).</span>
<span class="sd">   </span>
<span class="sd">    :Keywords:</span>
<span class="sd">        temperature :   in, required, type=float</span>
<span class="sd">                        electron temperature</span>
<span class="sd">        omij_data   :   in, required, type=array/object</span>
<span class="sd">                        collision strengths (omega_ij) data</span>
<span class="sd">        level_num   :   in, type=int</span>
<span class="sd">                        Number of levels</span>
<span class="sd">        irats       :   in, type=int</span>
<span class="sd">                        Else Coll. rates = tabulated values * 10 ** irats</span>
<span class="sd">   </span>
<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>
<span class="sd">   </span>
<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_dir = os.path.join(&#39;atomic-data&#39;, &#39;chianti70&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_elj_file = os.path.join(base_dir,data_dir, &#39;AtomElj.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_omij_file = os.path.join(base_dir,data_dir, &#39;AtomOmij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_aij_file = os.path.join(base_dir,data_dir, &#39;AtomAij.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;s&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39;</span>
<span class="sd">        &gt;&gt;&gt; s_ii_elj=atomneb.read_elj(atom_elj_file, atom, ion, level_num=5) # read Energy Levels (Ej)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_omij=atomneb.read_omij(atom_omij_file, atom, ion) # read Collision Strengths (Omegaij)</span>
<span class="sd">        &gt;&gt;&gt; s_ii_aij=atomneb.read_aij(atom_aij_file, atom, ion) # read Transition Probabilities (Aij)\</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)#</span>
<span class="sd">        &gt;&gt;&gt; omij_t=pyequib.get_omij_temp(temperature=temperature, omij_data=s_ii_omij)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Effective Collision Strengths: &#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(omij_t)</span>
<span class="sd">           Effective Collision Strengths:</span>
<span class="sd">           0.0000000       0.0000000       0.0000000       0.0000000       0.0000000</span>
<span class="sd">           2.7800000       0.0000000       0.0000000       0.0000000       0.0000000</span>
<span class="sd">           4.1600000       7.4600000       0.0000000       0.0000000       0.0000000</span>
<span class="sd">           1.1700000       1.8000000       2.2000000       0.0000000       0.0000000</span>
<span class="sd">           2.3500000       3.0000000       4.9900000       2.7100000       0.0000000</span>
<span class="sd">   </span>
<span class="sd">    :Categories:</span>
<span class="sd">      Plasma Diagnostics, Abundance Analysis, Collisionally Excited Lines</span>
<span class="sd">   </span>
<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Subroutines</span>
<span class="sd">   </span>
<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>
<span class="sd">   </span>
<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>
<span class="sd">   </span>
<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>
<span class="sd">   </span>
<span class="sd">    :History:</span>
<span class="sd">        04/03/2019, A. Danehkar, create the get_omij_temp() routine.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">4.13566766225e-15</span> <span class="c1"># eV.s #6.62606957e-27 # erg.s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s</span>
   <span class="n">k_b</span> <span class="o">=</span> <span class="mf">8.617330350e-5</span> <span class="c1"># eV/K # 1.3806485279e-16 # erg/K</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">omij_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;omij_data is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">level_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
         <span class="n">level_num</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;level1&#39;</span><span class="p">][:]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;level2&#39;</span><span class="p">][:])])</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="n">level_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elj_data</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">irats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="n">irats</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="k">if</span> <span class="p">(</span><span class="n">irats</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">elj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;elj_data is not set. It is required for irats&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
         <span class="n">ej</span> <span class="o">=</span> <span class="n">elj_data</span><span class="p">[</span><span class="s1">&#39;ej&#39;</span><span class="p">]</span> <span class="c1"># Energy Levels (E_j) in cm-1</span>
   <span class="n">t_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temperature</span><span class="p">))</span>
   <span class="n">t_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># Number of temperature intervals</span>
   <span class="n">t_lin_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">t_log_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t_lin_list</span><span class="p">)</span> <span class="c1"># temperature intervals (array)</span>
   <span class="n">omij_num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omij_data</span><span class="p">)</span>
   <span class="n">omij_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">level_num</span><span class="p">,</span> <span class="n">level_num</span><span class="p">))</span>
   <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">omij_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;level1&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
      <span class="n">j</span> <span class="o">=</span> <span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;level2&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="n">level_num</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;=</span> <span class="n">level_num</span><span class="p">):</span>
         <span class="n">qj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">omij_data</span><span class="p">[</span><span class="s1">&#39;strength&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">irats</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>   
            <span class="n">d_e</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ej</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ej</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="c1"># delta Energy in eV; convert from cm-1 to eV</span>
            <span class="c1"># Calculate the Boltzmann factor</span>
            <span class="n">exp_de_kt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d_e</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_b</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">))</span> <span class="c1"># Maxwell-Boltzmann distribution</span>
            <span class="n">qj</span> <span class="o">=</span> <span class="n">qj</span> <span class="o">/</span> <span class="n">exp_de_kt</span> <span class="c1">#Take out the exp. before interpolation</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">t_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>   
            <span class="n">omij_t</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">qj</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">(</span><span class="n">t_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>   
               <span class="n">omij_t</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">qj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">qj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">qj</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">t_log_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_log_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_log</span> <span class="o">-</span> <span class="n">t_log_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="c1">#Qj_T=interpol(Qj, T_log_list, T_log, /SPLINE)</span>
               <span class="c1"># Calculate interpolating cubic spline</span>
               <span class="c1">#qj_2 = spl_init(t_log_list, qj)</span>
               <span class="c1"># Calculate the interpolated Omij_T values corresponding to T_log</span>
               <span class="c1"># Obtain the effective collision strengths Omij_T</span>
               <span class="c1">#qj_t = spl_interp(t_log_list, qj, qj_2, t_log, double=True)</span>
               <span class="c1"># qj_t=np.interp(t_log, t_log_list, qj)</span>
               <span class="n">interpfunc</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">t_log_list</span><span class="p">,</span> <span class="n">qj</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
               <span class="n">qj_t</span> <span class="o">=</span> <span class="n">interpfunc</span><span class="p">(</span><span class="n">t_log</span><span class="p">)</span>
               <span class="n">omij_t</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">qj_t</span>
   <span class="k">return</span> <span class="n">omij_t</span></div>

<div class="viewcode-block" id="calc_emiss_h_beta"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_h_beta">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function calculates the emissivity for H_beta 4861A</span>
<span class="sd">         Emis(Hbeta)= 4pi j(HBeta 4861 A)/Np Ne) for the given temperature and density</span>
<span class="sd">         by using the helium emissivities from</span>
<span class="sd">         Storey &amp; Hummer, 1995MNRAS.272...41S.</span>

<span class="sd">     :Private:</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the H beta emissivity 4pi j(HBeta 4861)/Np Ne).</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature     :   in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density         :   in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         h_i_aeff_data   :   in, required, type=array/object</span>
<span class="sd">                             H I recombination coefficients</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines, Emissivity</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on H I emissivities</span>
<span class="sd">         from Storey &amp; Hummer, 1995MNRAS.272...41S.</span>

<span class="sd">         25/08/2012, A. Danehkar, IDL code written.</span>

<span class="sd">         11/03/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Change from logarithmic to linear</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># h_a_col= find_aeff_sh95_column(3, 2)</span>
    <span class="n">linenum</span> <span class="o">=</span> <span class="n">find_aeff_sh95_column</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

    <span class="n">teh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
    <span class="n">neh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
    <span class="n">line1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">linenum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">emissivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">h_i_ems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
    <span class="n">temp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">302</span><span class="p">)</span>
    <span class="n">temp_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">500.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">3000.</span><span class="p">,</span> <span class="mf">5000.</span><span class="p">,</span> <span class="mf">7500.</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">,</span> <span class="mf">12500.</span><span class="p">,</span> <span class="mf">15000.</span><span class="p">,</span> <span class="mf">20000.</span><span class="p">,</span> <span class="mf">30000.</span><span class="p">])</span>

    <span class="n">nlines</span> <span class="o">=</span> <span class="mi">130</span>
    <span class="n">h_i_aeff</span><span class="o">=</span><span class="n">h_i_aeff_data</span>
    <span class="n">h_i_aeff</span><span class="o">=</span><span class="n">h_i_aeff</span><span class="o">.</span><span class="n">T</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlines</span><span class="p">):</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="n">h_i_aeff</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">loc1</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp_grid</span> <span class="o">==</span> <span class="n">temp1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">tpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
        <span class="n">npos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temp1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">h_i_ems</span><span class="p">[</span><span class="n">tpos</span><span class="p">,</span> <span class="n">npos</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp1</span><span class="p">[</span><span class="n">line1</span><span class="p">]</span>  <span class="c1"># temp[2:45]</span>

    <span class="c1"># restrict to the density &amp; temperature ranges to 1995MNRAS.272...41S</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">neh2</span> <span class="o">&lt;</span> <span class="mf">1.1e2</span><span class="p">):</span>
        <span class="n">neh2</span> <span class="o">=</span> <span class="mf">1.1e2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">neh2</span> <span class="o">&gt;</span> <span class="mf">1.e14</span><span class="p">):</span>
        <span class="n">neh2</span> <span class="o">=</span> <span class="mf">1.e14</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">teh2</span> <span class="o">&lt;</span> <span class="mf">550.</span><span class="p">):</span>
        <span class="n">teh2</span> <span class="o">=</span> <span class="mf">550.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">teh2</span> <span class="o">&gt;</span> <span class="mf">30000.</span><span class="p">):</span>
        <span class="n">teh2</span> <span class="o">=</span> <span class="mf">30000.</span>

    <span class="c1"># get logarithmic density</span>
    <span class="n">dens_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">neh2</span><span class="p">)</span>

    <span class="n">dens_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">hb_emissivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="c1"># Bilinearly interpolate density &amp; temperature</span>
    <span class="c1"># emiss_log =_interp2d(hi_ems1, temp_grid, dens_grid, TEh2, dens_log, [101,101], /cubic, /quintic)#, /trigrid) not work on GDL</span>
    <span class="n">hb_emissivity</span> <span class="o">=</span> <span class="n">interp_2d</span><span class="p">(</span><span class="n">h_i_ems</span><span class="p">[:,</span> <span class="p">:],</span> <span class="n">teh2</span><span class="p">,</span> <span class="n">dens_log</span><span class="p">,</span> <span class="n">temp_grid</span><span class="p">,</span> <span class="n">dens_grid</span><span class="p">)</span>

    <span class="c1"># ems_log = np.log10(hr_tmp/np.float64(4861.33/1.98648E-08))</span>
    <span class="c1"># h_beta_emissivity = 10.0^ems_log</span>
    <span class="c1"># h_beta_emissivity_log=np.log10(h_beta_emissivity(temp, density))</span>

    <span class="k">return</span> <span class="n">hb_emissivity</span></div>

<span class="k">def</span> <span class="nf">find_aeff_sh95_column</span><span class="p">(</span><span class="n">lo_lev</span><span class="p">,</span> <span class="n">hi_lev</span><span class="p">,</span> <span class="n">lev_num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function locates and returns the data location</span>
<span class="sd">        of the given low energy level, high energy level,</span>
<span class="sd">        and the level number</span>
<span class="sd">        within the database of H I emissivities given by</span>
<span class="sd">        from Storey &amp; Hummer, 1995MNRAS.272...41S.</span>

<span class="sd">    :Private:</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the data location .</span>

<span class="sd">    :Params:</span>
<span class="sd">        lo_lev  :  in, required, type=float</span>
<span class="sd">                      low energy level</span>

<span class="sd">        hi_lev  :  in, required, type=float</span>
<span class="sd">                      high energy level</span>

<span class="sd">        lev_num :  in, required, type=float</span>
<span class="sd">                      level number</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on H I emissivities</span>
<span class="sd">        from Storey &amp; Hummer, 1995MNRAS.272...41S.</span>

<span class="sd">        25/08/2012, A. Danehkar, IDL code written.</span>

<span class="sd">        11/03/2017, A. Danehkar, Integration with AtomNeb.</span>
<span class="sd"> </span>
<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># lev_num=25</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c1"># lo_lev=3</span>
    <span class="c1"># hi_lev=2</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lev_num</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">k</span> <span class="o">==</span> <span class="n">lo_lev</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">hi_lev</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">count</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">interp_2d</span><span class="p">(</span><span class="n">tab_in</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x_tab</span><span class="p">,</span> <span class="n">y_tab</span><span class="p">,</span> <span class="n">xlog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       function interp_2d,tab_in,x,y,x_tab,y_tab,[xlog=xlog],[ylog=ylog]</span>
<span class="sd">       return an interpolated 2 Dim less than tab_in (no extrapolation)</span>
<span class="sd">       tab_in: fltarr([*,*,...],n_x,n_y)</span>
<span class="sd">       x,y: values where we want to interpolate</span>
<span class="sd">       x_tab,y_tab: fltarr(n_x),fltarr(n_y) : x and y vectors, must be</span>
<span class="sd">          sorted, no necessarily in increasing order.</span>
<span class="sd">       x_log and y_log: allows log interpolation</span>
<span class="sd">       C. Morisset (LAS, Marseille, 2000)</span>

<span class="sd">       03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ON_ERROR, 2</span>

    <span class="n">size_tab_in</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tab_in</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab_in</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="n">n_dim_tab</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#size_tab_in[0]</span>
    <span class="n">n_x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_tab</span><span class="p">)</span>
    <span class="n">n_y</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_tab</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_x</span> <span class="o">!=</span> <span class="n">size_tab_in</span><span class="p">[</span><span class="n">n_dim_tab</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">n_y</span> <span class="o">!=</span> <span class="n">size_tab_in</span><span class="p">[</span><span class="n">n_dim_tab</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dimension of x_tab or y_tab incompatible with tab_in&#39;</span><span class="p">)</span>
    <span class="n">tab_tmp</span> <span class="o">=</span> <span class="n">tab_in</span> <span class="c1">#reform(tab_in, size_tab_in[n_dim_tab + 2] / n_x / n_y, n_x, n_y)</span>

    <span class="c1"># No extrapolation:</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_tab</span><span class="p">))</span><span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_tab</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_tab</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_tab</span><span class="p">))):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No extrapollation&#39;</span><span class="p">)</span>

    <span class="n">i_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_tab</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">))</span>
    <span class="n">i_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_tab</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">x_tab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x_tab</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">x_incr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_incr</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">y_tab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y_tab</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">y_incr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_incr</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">x_incr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">i_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_tab</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">i_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x_tab</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">y_incr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">i_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_tab</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">i_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_tab</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">xlog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">f_x</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_tab</span><span class="p">[</span><span class="n">i_x</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_tab</span><span class="p">[</span><span class="n">i_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_tab</span><span class="p">[</span><span class="n">i_x</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f_x</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_tab</span><span class="p">[</span><span class="n">i_x</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_tab</span><span class="p">[</span><span class="n">i_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_tab</span><span class="p">[</span><span class="n">i_x</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ylog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">f_y</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y_tab</span><span class="p">[</span><span class="n">i_y</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y_tab</span><span class="p">[</span><span class="n">i_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                                                           <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y_tab</span><span class="p">[</span><span class="n">i_y</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f_y</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_tab</span><span class="p">[</span><span class="n">i_y</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_tab</span><span class="p">[</span><span class="n">i_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_tab</span><span class="p">[</span><span class="n">i_y</span><span class="p">])</span>

    <span class="n">tab_out</span> <span class="o">=</span> <span class="n">tab_tmp</span><span class="p">[</span><span class="n">i_x</span><span class="p">,</span> <span class="n">i_y</span><span class="p">]</span> <span class="o">*</span> <span class="n">f_x</span> <span class="o">*</span> <span class="n">f_y</span> <span class="o">+</span> <span class="n">tab_tmp</span><span class="p">[</span><span class="n">i_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_y</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">f_x</span><span class="p">)</span> <span class="o">*</span> <span class="n">f_y</span> \
              <span class="o">+</span> <span class="n">tab_tmp</span><span class="p">[</span><span class="n">i_x</span><span class="p">,</span> <span class="n">i_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">f_x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">f_y</span><span class="p">)</span> \
              <span class="o">+</span> <span class="n">tab_tmp</span><span class="p">[</span><span class="n">i_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">f_x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">f_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_dim_tab</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">tab_out</span> <span class="o">=</span> <span class="n">tab_out</span> <span class="c1">#reform(tab_out, size_tab_in[1:(n_dim_tab - 2) + 1], overwrite=True)</span>
    <span class="k">return</span> <span class="n">tab_out</span>

<div class="viewcode-block" id="calc_emiss_he_i_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_he_i_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_he_i_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">linenum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">he_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the emissivity</span>
<span class="sd">        for the given wavelength of He I recombination line</span>
<span class="sd">        by using the recombination coefficients from Porter et al.</span>
<span class="sd">        2012MNRAS.425L..28P.</span>
<span class="sd">   </span>
<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the line emissivity.</span>
<span class="sd">   </span>
<span class="sd">    :Keywords:</span>
<span class="sd">        temperature    :    in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density        :    in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        linenum        :    in, required, type=int</span>
<span class="sd">                            Line Number for Wavelength</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=4120.84:linenum=7,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=4387.93: linenum=8,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=4437.55: linenum=9,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=4471.50: linenum=10,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=4921.93: linenum=12,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=5015.68: linenum=13,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=5047.74: linenum=14,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=5875.66: linenum=15,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=6678.16: linenum=16,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=7065.25: linenum=17,</span>
<span class="sd">   </span>
<span class="sd">                            Wavelength=7281.35: linenum=18.</span>
<span class="sd">   </span>
<span class="sd">        line_flux      :    in, required, type=float</span>
<span class="sd">                            line flux intensity</span>
<span class="sd">        he_i_aeff_data :    in, required, type=array/object</span>
<span class="sd">                            He I recombination coefficients</span>
<span class="sd">   </span>
<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>
<span class="sd">   </span>
<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_he_i_file= filepath(&#39;rc_he_ii_PFSD12.fits&#39;, root_dir=base_dir, subdir=data_rc_dir )</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;he&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39; # He I</span>
<span class="sd">        &gt;&gt;&gt; he_i_rc_data=atomneb.read_aeff_he_i_pfsd12(atom_rc_he_i_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; he_i_aeff_data=he_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; linenum=10# 4471.50</span>
<span class="sd">        &gt;&gt;&gt; emiss_he_i=pyequib.calc_emiss_he_i_rl(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                                linenum=linenum,</span>
<span class="sd">        &gt;&gt;&gt;                                he_i_aeff_data=he_i_aeff_data)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Emissivity:&#39;, emiss_he_i)</span>
<span class="sd">           Emissivity:   6.3822830e-26</span>
<span class="sd">   </span>
<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Recombination Lines, Emissivity</span>
<span class="sd">   </span>
<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>
<span class="sd">   </span>
<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>
<span class="sd">   </span>
<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>
<span class="sd">   </span>
<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>
<span class="sd">   </span>
<span class="sd">    :History:</span>
<span class="sd">        Based on improved He I emissivities in the case B</span>
<span class="sd">        from Porter et al. 2012MNRAS.425L..28P</span>
<span class="sd">   </span>
<span class="sd">        15/12/2013, A. Danehkar, IDL code written.</span>
<span class="sd">   </span>
<span class="sd">        20/03/2017, A. Danehkar, Integration with AtomNeb.</span>
<span class="sd">   </span>
<span class="sd">        10/07/2019, A. Danehkar, Made a new function calc_emiss_he_i_rl()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abund_he_i_rl().</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">he_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;He I recombination coefficients (he_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">linenum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line Number for Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">teh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
   <span class="n">neh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
   <span class="n">line1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">linenum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">emissivity</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   
   <span class="c1"># hei_ems=read_porter()</span>
   <span class="n">hei_ems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">21</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span> <span class="c1">#(21,14,44)</span>
   <span class="n">temp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">46</span><span class="p">)</span>
   
   <span class="n">nlines</span> <span class="o">=</span> <span class="mi">294</span>
   <span class="n">he_i_aeff</span> <span class="o">=</span> <span class="n">he_i_aeff_data</span>
   <span class="n">he_i_aeff</span> <span class="o">=</span> <span class="n">he_i_aeff</span><span class="o">.</span><span class="n">T</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlines</span><span class="p">):</span>
      <span class="n">temp1</span> <span class="o">=</span> <span class="n">he_i_aeff</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
      <span class="n">tpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">temp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">))</span>
      <span class="n">npos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temp1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
      <span class="n">hei_ems</span><span class="p">[</span><span class="n">tpos</span><span class="p">,</span><span class="n">npos</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp1</span><span class="p">[</span><span class="n">line1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="c1">#temp[2:45]</span>
   
   <span class="c1"># restrict to the density &amp; temperature ranges to 2012MNRAS.425L..28P</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">neh2</span> <span class="o">&lt;</span> <span class="mf">1.e1</span><span class="p">):</span>   
      <span class="n">neh2</span> <span class="o">=</span> <span class="mf">1.e1</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">neh2</span> <span class="o">&gt;</span> <span class="mf">1.e14</span><span class="p">):</span>   
      <span class="n">neh2</span> <span class="o">=</span> <span class="mf">1.e14</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">teh2</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">):</span>   
      <span class="n">teh2</span> <span class="o">=</span> <span class="mf">5000.</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">teh2</span> <span class="o">&gt;</span> <span class="mi">25000</span><span class="p">):</span>   
      <span class="n">teh2</span> <span class="o">=</span> <span class="mf">25000.</span>
   
   <span class="c1"># get logarithmic density</span>
   <span class="n">dens_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">neh2</span><span class="p">)</span>
   
   <span class="n">dens_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">temp_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
   
   <span class="n">hei_ems1</span> <span class="o">=</span> <span class="n">hei_ems</span><span class="p">[:,:]</span>
   <span class="c1"># Bilinearly interpolate density &amp; temperature</span>
   <span class="c1"># emiss_log =_interp2d(hei_ems1, temp_grid, dens_grid, TEh2, dens_log, [101,101], /cubic, /quintic)#, /trigrid) not work on GDL</span>
   <span class="n">emiss_log</span> <span class="o">=</span> <span class="n">interp_2d</span><span class="p">(</span><span class="n">hei_ems1</span><span class="p">,</span> <span class="n">teh2</span><span class="p">,</span> <span class="n">dens_log</span><span class="p">,</span> <span class="n">temp_grid</span><span class="p">,</span> <span class="n">dens_grid</span><span class="p">)</span>
   
   <span class="c1"># wavl=he_i_aeff_data_Wavelength[line1]</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="mf">10.e0</span> <span class="o">**</span> <span class="p">(</span><span class="n">emiss_log</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">emissivity</span></div>

<div class="viewcode-block" id="calc_emiss_he_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_he_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_he_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">he_ii_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This functioncalculates the emissivity</span>
<span class="sd">        for the He II recombination line 4686 A</span>
<span class="sd">        by using the helium emissivities from</span>
<span class="sd">        Storey &amp; Hummer, 1995MNRAS.272...41S.</span>
<span class="sd">   </span>
<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the line emissivity.</span>
<span class="sd">   </span>
<span class="sd">    :Keywords:</span>
<span class="sd">        temperature     :   in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density         :   in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        he_ii_aeff_data :   in, required, type=array/object</span>
<span class="sd">                            He II recombination coefficients</span>
<span class="sd">   </span>
<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>
<span class="sd">   </span>
<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_he_i_file= os.path.join(base_dir,data_rc_dir, &#39;rc_he_ii_PFSD12.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;he&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39; # He II</span>
<span class="sd">        &gt;&gt;&gt; he_ii_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; he_ii_aeff_data=he_ii_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; he_ii_4686_flux = 135.833</span>
<span class="sd">        &gt;&gt;&gt; emiss_he_ii=pyequib.calc_emiss_he_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                                 he_ii_aeff_data=he_ii_aeff_data)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Emissivity:&#39;, emiss_he_ii)</span>
<span class="sd">           Emissivity:   1.4989134e-24</span>
<span class="sd">   </span>
<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Recombination Lines, Emissivity</span>
<span class="sd">   </span>
<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>
<span class="sd">   </span>
<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>
<span class="sd">   </span>
<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>
<span class="sd">   </span>
<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>
<span class="sd">   </span>
<span class="sd">    :History:</span>
<span class="sd">        Based on He II emissivities</span>
<span class="sd">        from Storey &amp; Hummer, 1995MNRAS.272...41S.</span>
<span class="sd">   </span>
<span class="sd">        15/12/2013, A. Danehkar, IDL code written.</span>
<span class="sd">   </span>
<span class="sd">        02/04/2017, A. Danehkar, Integration with AtomNeb.</span>
<span class="sd">   </span>
<span class="sd">        10/07/2019, A. Danehkar, Change from logarithmic to linear</span>
<span class="sd">   </span>
<span class="sd">        10/07/2019, A. Danehkar, Made a new function calc_emiss_he_ii_rl()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abund_he_ii_rl().</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">he_ii_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;He II recombination coefficients (he_ii_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="c1">#h_a_col= find_aeff_sh95_column(3, 2)</span>
   <span class="n">linenum</span> <span class="o">=</span> <span class="n">find_aeff_sh95_column</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
   
   <span class="n">teh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
   <span class="n">neh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
   <span class="n">line1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">linenum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   
   <span class="n">heii_ems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
   <span class="n">temp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">302</span><span class="p">)</span>
   <span class="n">temp_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">500.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">3000.</span><span class="p">,</span> <span class="mf">5000.</span><span class="p">,</span> <span class="mf">7500.</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">,</span> <span class="mf">12500.</span><span class="p">,</span> <span class="mf">15000.</span><span class="p">,</span> <span class="mf">20000.</span><span class="p">,</span> <span class="mf">30000.</span><span class="p">,</span> <span class="mf">50000.</span><span class="p">,</span> <span class="mf">100000.</span><span class="p">])</span>
   
   <span class="n">nlines</span> <span class="o">=</span> <span class="mi">156</span>

   <span class="n">he_ii_aeff</span> <span class="o">=</span> <span class="n">he_ii_aeff_data</span>
   <span class="n">he_ii_aeff</span> <span class="o">=</span> <span class="n">he_ii_aeff</span><span class="o">.</span><span class="n">T</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlines</span><span class="p">):</span>
       <span class="n">temp1</span> <span class="o">=</span> <span class="n">he_ii_aeff</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
       <span class="n">loc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp_grid</span> <span class="o">==</span> <span class="n">temp1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
       <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
       <span class="n">tpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
       <span class="n">npos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temp1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
       <span class="n">heii_ems</span><span class="p">[</span><span class="n">tpos</span><span class="p">,</span> <span class="n">npos</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp1</span><span class="p">[</span><span class="n">line1</span><span class="p">]</span>  <span class="c1"># temp[2:45]</span>
   
   <span class="c1"># restrict to the density &amp; temperature ranges to 2012MNRAS.425L..28P</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">neh2</span> <span class="o">&lt;</span> <span class="mf">1.e2</span><span class="p">):</span>   
      <span class="n">neh2</span> <span class="o">=</span> <span class="mf">1.e2</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">neh2</span> <span class="o">&gt;</span> <span class="mf">1.e14</span><span class="p">):</span>   
      <span class="n">neh2</span> <span class="o">=</span> <span class="mf">1.e14</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">teh2</span> <span class="o">&lt;</span> <span class="mf">500.</span><span class="p">):</span>   
      <span class="n">teh2</span> <span class="o">=</span> <span class="mf">500.</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">teh2</span> <span class="o">&gt;</span> <span class="mf">100000.</span><span class="p">):</span>   
      <span class="n">teh2</span> <span class="o">=</span> <span class="mf">100000.</span>
   
   <span class="c1"># get logarithmic density</span>
   <span class="n">dens_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">neh2</span><span class="p">)</span>
   
   <span class="n">dens_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
   
   <span class="n">heii_ems1</span> <span class="o">=</span> <span class="n">heii_ems</span><span class="p">[:,:]</span>
   <span class="c1"># Bilinearly interpolate density &amp; temperature</span>
   <span class="c1"># emissivity =_interp2d(heii_ems1, temp_grid, dens_grid, TEh2, dens_log, [101,101], /cubic, /quintic)#, /trigrid) not work on GDL</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">interp_2d</span><span class="p">(</span><span class="n">heii_ems1</span><span class="p">,</span> <span class="n">teh2</span><span class="p">,</span> <span class="n">dens_log</span><span class="p">,</span> <span class="n">temp_grid</span><span class="p">,</span> <span class="n">dens_grid</span><span class="p">)</span>
   <span class="c1"># emissivity_log = np.log10(emissivity)</span>
   
   <span class="k">return</span> <span class="n">emissivity</span></div>

<div class="viewcode-block" id="calc_emiss_c_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_c_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_c_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c_ii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the emissivity</span>
<span class="sd">        for the given wavelength of C II recombination line</span>
<span class="sd">        by using the recombination coefficients from</span>
<span class="sd">        from Davey et al. (2000) 2000A&amp;AS..142...85D.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the line emissivity.</span>

<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :     in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density       :     in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        wavelength    :     in, required, type=float</span>
<span class="sd">                            Line Wavelength in Angstrom</span>
<span class="sd">        c_ii_rc_data  :     in, required, type=array/object</span>
<span class="sd">                            C II recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_all_file= os.path.join(base_dir,data_rc_dir, &#39;rc_collection.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;c&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39; # C II</span>
<span class="sd">        &gt;&gt;&gt; c_ii_rc_data=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; wavelength=6151.43</span>
<span class="sd">        &gt;&gt;&gt; emiss_c_ii=pyequib.calc_emiss_c_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                               wavelength=wavelength,</span>
<span class="sd">        &gt;&gt;&gt;                               c_ii_rc_data=c_ii_rc_data)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Emissivity:&#39;, emiss_c_ii)</span>
<span class="sd">           Emissivity:   5.4719511e-26</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Recombination Lines, Emissivity</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on recombination coefficients for C II lines from</span>
<span class="sd">        Davey et al. 2000A&amp;AS..142...85D.</span>

<span class="sd">        Adopted from MOCASSIN, Ercolano et al. 2005MNRAS.362.1038E.</span>

<span class="sd">        02/2003, Yong Zhang, added to MOCASSIN.</span>

<span class="sd">        10/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">        15/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">        10/07/2019, A. Danehkar, Made a new function calc_emiss_c_ii_rl()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abund_c_ii_rl().        </span>
<span class="sd">        </span>
<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">    &quot;&quot;&quot;</span>
   <span class="c1"># ciiRLstructure ={Wave:np.float64(0.0), Int:np.float64(0.0), Obs:np.float64(0.0), Abundance:np.float64(0.0)}</span>
    <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg s</span>
    <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s</span>
   
    <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c_ii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;C II recombination coefficients (c_ii_rc_data) are not set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1">#c_ii_rc = np.asarray(c_ii_rc_data)</span>

    <span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">aeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">temp4</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">/</span> <span class="mf">10000.0</span>
    <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="n">loc1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">temp2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">wavelength_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
        <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wavelength_min</span><span class="p">)</span>
        <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
    <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.0e-14</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">**</span> <span class="n">f</span><span class="p">))</span>
    <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="c1">#ciiRLs_Int = 100.0*(aeff/hbeta_aeff)*br*(4861.33/lamb)*abund</span>
    <span class="c1">#abund=line_flux/ciiiRLs_Int</span>
    <span class="n">emissivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">aeff</span> <span class="o">*</span> <span class="n">br</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">lamb</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span><span class="p">)</span>
   
    <span class="k">return</span> <span class="n">emissivity</span></div>

<div class="viewcode-block" id="calc_emiss_c_iii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_c_iii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_c_iii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c_iii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function calculates the emissivity</span>
<span class="sd">         for the given wavelength of C III recombination line</span>
<span class="sd">         by using the recombination coefficients from</span>
<span class="sd">         Pequignot et al. 1991A&amp;A...251..680P.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the line emissivity.</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature   :     in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density       :     in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         wavelength    :     in, required, type=float</span>
<span class="sd">                             Line Wavelength in Angstrom</span>
<span class="sd">         c_iii_rc_data :     in, required, type=array/object</span>
<span class="sd">                             C III recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; import atomneb</span>
<span class="sd">         &gt;&gt;&gt; import os</span>
<span class="sd">         &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">         &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_ppb91_file=os.path.join(base_dir,data_rc_dir, &#39;rc_PPB91.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt;</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;c&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;iv&#39; # C III</span>
<span class="sd">         &gt;&gt;&gt; c_iii_rc_data=atomneb.read_aeff_ppb91(atom_rc_ppb91_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">         &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">         &gt;&gt;&gt; wavelength=4647.42</span>
<span class="sd">         &gt;&gt;&gt; emiss_c_iii=pyequib.calc_emiss_c_iii_rl(temperature=temperature, density=density,</span>
<span class="sd">         &gt;&gt;&gt;                                 wavelength=wavelength,</span>
<span class="sd">         &gt;&gt;&gt;                                 c_iii_rc_data=c_iii_rc_data)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;Emissivity:&#39;, emiss_c_iii)</span>
<span class="sd">            Emissivity:   7.5749632e-25</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines, Emissivity</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on effective radiative recombination coefficients for C III lines from</span>
<span class="sd">         Pequignot, Petitjean, Boisson, C. 1991A&amp;A...251..680P.</span>

<span class="sd">         18/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">         06/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Made a new function calc_emiss_c_iii_rl()</span>
<span class="sd">                          for calculating line emissivities and separated it</span>
<span class="sd">                          from calc_abund_c_iii_rl().</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># ciiiRLstructure ={Wave:np.float64(0.0), Int:np.float64(0.0), Obs:np.float64(0.0), Abundance:np.float64(0.0)}</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s </span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">c_iii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;C III recombination coefficients (c_iii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>

   <span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">ion</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
   
   <span class="n">z</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="c1"># ion level c^3+</span>
   <span class="c1"># equation (1) in 1991A&amp;A...251..680P</span>
   <span class="n">temp4</span> <span class="o">=</span> <span class="mf">1.0e-4</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">/</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span>
   <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">)</span>
   <span class="n">loc1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">temp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">temp2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">wavelength_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wavelength_min</span><span class="p">)</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">c_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;br&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="c1"># equation (1) in 1991A&amp;A...251..680P</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.0e-13</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">br</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">**</span> <span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">**</span> <span class="n">d</span><span class="p">))</span>
   <span class="c1">#ciiiRLs_Int = 100.0 * (aeff/hbeta_aeff) * (4861.33/lamb) * abund</span>
   <span class="c1">#abund=line_flux/ciiiRLs_Int</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">aeff</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">lamb</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">emissivity</span></div>

<div class="viewcode-block" id="calc_emiss_n_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_n_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_n_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">n_ii_rc_br</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_ii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the emissivity</span>
<span class="sd">        for the given wavelength of N II recombination line</span>
<span class="sd">        by using the recombination coefficients from</span>
<span class="sd">        Escalante &amp; Victor 1990ApJS...73..513E.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the line emissivity.</span>

<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :     in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density       :     in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        wavelength    :     in, required, type=float</span>
<span class="sd">                            Line Wavelength in Angstrom</span>
<span class="sd">        n_ii_rc_br    :     in, required, type=array/object</span>
<span class="sd">                            N II branching ratios (Br)</span>
<span class="sd">        n_ii_rc_data  :     in, required, type=array/object</span>
<span class="sd">                            N II recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_all_file= os.path.join(base_dir,data_rc_dir, &#39;rc_collection.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">        &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;n&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39; # N II</span>
<span class="sd">        &gt;&gt;&gt; n_ii_rc_data=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; n_ii_rc_data_br=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion, br=True)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; wavelength=4442.02</span>
<span class="sd">        &gt;&gt;&gt; emiss_n_ii=pyequib.calc_emiss_n_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                               wavelength=wavelength,</span>
<span class="sd">        &gt;&gt;&gt;                               n_ii_rc_br=n_ii_rc_data_br, n_ii_rc_data=n_ii_rc_data,</span>
<span class="sd">        &gt;&gt;&gt;                               h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Emissivity:&#39;, emiss_n_ii)</span>
<span class="sd">           Emissivity:   3.0397397e-26</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Recombination Lines, Emissivity</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on Effective recombination coefficients for N II lines from</span>
<span class="sd">        Escalante &amp; Victor 1990ApJS...73..513E.</span>

<span class="sd">        Adopted from MIDAS Rnii script written by X.W.Liu.</span>

<span class="sd">        Revised based on scripts by Yong Zhang added to MOCASSIN, 02/2003</span>
<span class="sd">                          Ercolano et al. 2005MNRAS.362.1038E.</span>

<span class="sd">        10/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">        25/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">        10/07/2019, A. Danehkar, Made a new function calc_emiss_n_ii_rl()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abund_n_ii_rl().</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>

<span class="c1">#  niiRLstructure ={Wave:np.float64(0.0), #REAL*8</span>
<span class="c1">#              Int:np.float64(0.0),</span>
<span class="c1">#              Obs:np.float64(0.0),</span>
<span class="c1">#              abundance:np.float64(0.0),</span>
<span class="c1">#              g1:long(0), #INTEGER</span>
<span class="c1">#              g2:long(0), #INTEGER</span>
<span class="c1">#              Mult1:&#39;&#39;, #CHARACTER*7</span>
<span class="c1">#              Term1:&#39;&#39;, #CHARACTER*9</span>
<span class="c1">#              Term2:&#39;&#39; #CHARACTER*9</span>
<span class="c1">#              }</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">6.62606957e-27</span><span class="p">)</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">2.99792458e10</span><span class="p">)</span> <span class="c1"># cm/s</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">n_ii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N II recombination coefficients (n_ii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">n_ii_rc_br</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N II branching ratios (n_ii_rc_br) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">rl_br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">temp4</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">/</span> <span class="mf">10000.0</span>
   <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">)</span>
   <span class="n">loc1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">temp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">temp2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">wavelength_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">n_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wavelength_min</span><span class="p">)</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">rl_br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;br&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>

   <span class="n">loc1</span><span class="o">=</span><span class="n">loc1</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
   <span class="c1">#---------------------------------------</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3s - 2s2.2p.(2P*).3p E1 3P* - 3D  : 03  row</span>
      <span class="c1">#i = 2    #case A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span>     <span class="c1">#case B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3s - 2s2.2p.(2P*).3p 3P* - 3S     : 04 row</span>
      <span class="c1">#i = 4    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">5</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">14</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3s - 2s2.2p.(2P*).3p 3P* - 3P     : 05 row</span>
      <span class="c1">#i = 6    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">7</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">15</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3s - 2s2.2p.(2P*).3p 1P* - 1P     : 08 row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">8</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 9    #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">16</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3s - 2s2.2p.(2P*).3p 1P* - 1D     : 12 row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 11    #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">17</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3s - 2s2.2p.(2P*).3p 1P* - 1S     : 13 row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">12</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 13    #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">18</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 1P - 1D*     : 15 row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">14</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 15    #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">19</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 1P - 1P*     : 17 row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">16</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 17    #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 3D - 3F*     : 19 row</span>
      <span class="c1">#i = 18    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">19</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">26</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 3D - 3D*     : 20 row</span>
      <span class="c1">#i = 20    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">21</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">33</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">38</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 3D - 3P*     : 21 row</span>
      <span class="c1">#i = 22    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">23</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">39</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">44</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).4s 3D - 3P*     : 22 row</span>
      <span class="c1">#i = 24    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">25</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">45</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">47</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 3S - 3P*     : 24 row</span>
      <span class="c1">#i = 26    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">27</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">48</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).4s 3S - 3P*     : 26 row</span>
      <span class="c1">#i = 28    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">29</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">51</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">56</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 3P - 3D*     : 28 row</span>
      <span class="c1">#i = 30    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">31</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">57</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">62</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 3P - 3P*     : 29 row</span>
      <span class="c1">#i = 32    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">33</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">63</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">68</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).4s 3P - 3P*     : 30 row</span>
      <span class="c1">#i = 34    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">35</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">69</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3p - 2s2.2p.(2P*).3d 1D - 1F*     : 31 row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">36</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 37    #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">75</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3d - 2s2.2p.(2P*).4p 3F* - 3D     : 36 row</span>
      <span class="c1">#i = 38     #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">39</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">76</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">81</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3d - 2s2.2p.(2P*&lt;3/2&gt;).4f 3F* - 3G     : 39 row</span>
      <span class="c1">#i = 40    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">41</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">82</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 2s2.2p.(2P*).3d - 2s2.2p.(2P*&lt;3/2&gt;).4f 1F* - 1G     : 58 row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">42</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 43    #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">83</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">88</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 3d 3D* - 4f 3F 4242     : 48 row</span>
      <span class="c1">#i = 44    #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">45</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">89</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">94</span><span class="p">)):</span>
      <span class="c1"># atomic transitions: 3d 3P* - 4f 3D 4435     : 55 row</span>
      <span class="c1">#i = 46   #Case: A</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">47</span>     <span class="c1">#Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">95</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 3d 1D* - 4f 1F 4176     : 43 (RMT 42) row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">48</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 49     #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">96</span><span class="p">):</span>
      <span class="c1"># atomic transitions: 3d 1P* - 4f 1D 4677     : 61 (rmt 62) row</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">49</span>     <span class="c1">#Case: A</span>
      <span class="c1">#i = 51    #Case: B</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">97</span><span class="p">):</span>
      <span class="c1"># Adopted from MOCASSIN, Ercolano et al. 2005MNRAS.362.1038E</span>
      <span class="c1"># atomic transitions: 3d 3F* - 4f 1G 4026     : 39b row</span>
      <span class="c1"># Case: A</span>
      <span class="n">a0</span> <span class="o">=</span> <span class="mf">0.108</span>
      <span class="n">b0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.754</span>
      <span class="n">c0</span> <span class="o">=</span> <span class="mf">2.587</span>
      <span class="n">d0</span> <span class="o">=</span> <span class="mf">0.719</span>
      <span class="n">z0</span> <span class="o">=</span> <span class="mf">2.</span>
      <span class="n">br0</span> <span class="o">=</span> <span class="mf">0.350</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-13</span> <span class="o">*</span> <span class="n">z0</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">/</span> <span class="n">z0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">b0</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c0</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">/</span> <span class="n">z0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">d0</span><span class="p">))</span> <span class="o">*</span> <span class="n">br0</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">==</span> <span class="mi">98</span><span class="p">):</span>
      <span class="c1"># Adopted from MOCASSIN, Ercolano et al. 2005MNRAS.362.1038E</span>
      <span class="c1"># atomic transitions: 3d 1F* - 4f 3G 4552     : 58a row</span>
      <span class="c1"># Case: A</span>
      <span class="n">a0</span> <span class="o">=</span> <span class="mf">0.326</span>
      <span class="n">b0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.754</span>
      <span class="n">c0</span> <span class="o">=</span> <span class="mf">2.587</span>
      <span class="n">d0</span> <span class="o">=</span> <span class="mf">0.719</span>
      <span class="n">z0</span> <span class="o">=</span> <span class="mf">2.</span>
      <span class="n">br0</span> <span class="o">=</span> <span class="mf">0.074</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-13</span> <span class="o">*</span> <span class="n">z0</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">/</span> <span class="n">z0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">b0</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c0</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">/</span> <span class="n">z0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">d0</span><span class="p">))</span> <span class="o">*</span> <span class="n">br0</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wavelength has an illegal value.&#39;</span><span class="p">)</span>
   
   <span class="k">if</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">96</span><span class="p">)):</span>
      <span class="n">a0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
      <span class="n">b0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
      <span class="n">c0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">**</span> <span class="p">(</span><span class="n">a0</span> <span class="o">+</span> <span class="n">b0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
   
   <span class="c1">#niiRLs_Int = 100.0 * emissivity / hbeta_ems * abund</span>
   <span class="c1">#abund=line_flux/niiRLs_Int</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">aeff</span> <span class="o">*</span> <span class="n">rl_br</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">emissivity</span></div>

<div class="viewcode-block" id="calc_emiss_n_iii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_n_iii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_n_iii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_iii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function calculates the emissivity</span>
<span class="sd">         for the given wavelength of N III recombination line</span>
<span class="sd">         by using the recombination coefficients from</span>
<span class="sd">         Pequignot et al. 1991A&amp;A...251..680P.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the line emissivity.</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature   :     in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density       :     in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         wavelength    :     in, required, type=float</span>
<span class="sd">                             Line Wavelength in Angstrom</span>
<span class="sd">         n_iii_rc_data  :     in, required, type=array/object</span>
<span class="sd">                             N III recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; import atomneb</span>
<span class="sd">         &gt;&gt;&gt; import os</span>
<span class="sd">         &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">         &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_ppb91_file=os.path.join(base_dir,data_rc_dir, &#39;rc_PPB91.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt;</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;n&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;iv&#39; # N III</span>
<span class="sd">         &gt;&gt;&gt; n_iii_rc_data=atomneb.read_aeff_ppb91(atom_rc_ppb91_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">         &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">         &gt;&gt;&gt; wavelength=4640.64</span>
<span class="sd">         &gt;&gt;&gt; emiss_n_iii=pyequib.calc_abund_n_iii_rl(temperature=temperature, density=density,</span>
<span class="sd">         &gt;&gt;&gt;                                 wavelength=wavelength,</span>
<span class="sd">         &gt;&gt;&gt;                                 n_iii_rc_data=n_iii_rc_data)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;Emissivity:&#39;, emiss_n_iii)</span>
<span class="sd">            Emissivity:   4.7908644e-24</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines, Emissivity</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on  effective radiative recombination coefficients for N III lines from</span>
<span class="sd">         Pequignot, Petitjean, Boisson, C. 1991A&amp;A...251..680P.</span>

<span class="sd">         10/05/2013, A. Danehkar, IDL code written.</span>

<span class="sd">         20/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Made a new function calc_emiss_n_iii_rl()</span>
<span class="sd">                          for calculating line emissivities and separated it</span>
<span class="sd">                          from calc_abund_n_iii_rl().</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># niiiRLstructure ={Wave:np.float64(0.0), Int:np.float64(0.0), Obs:np.float64(0.0), Abundance:np.float64(0.0)}</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s </span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">n_iii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N III recombination coefficients (n_iii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">ion</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
   
   <span class="n">z</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="c1"># ion level c^3+</span>
   <span class="c1"># equation (1) in 1991A&amp;A...251..680P</span>
   <span class="n">temp4</span> <span class="o">=</span> <span class="mf">1.0e-4</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">/</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span>
   <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">)</span>
   <span class="n">loc1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">temp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">temp2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">wavelength_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wavelength_min</span><span class="p">)</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">temp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">temp2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wavelength_min</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;case1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">))</span>
         <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">n_iii_rc_data</span><span class="p">[</span><span class="s1">&#39;br&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="c1"># equation (1) in 1991A&amp;A...251..680P</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.0e-13</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">br</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">**</span> <span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">**</span> <span class="n">d</span><span class="p">))</span>
   <span class="c1">#niiiRLs_Int = 100.0 * (aeff/hbeta_aeff) * (4861.33/lamb) * abund</span>
   <span class="c1">#abund=line_flux/niiiRLs_Int</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">aeff</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">lamb</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">emissivity</span></div>

<div class="viewcode-block" id="calc_emiss_o_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_o_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_o_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">o_ii_rc_br</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">o_ii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the emissivity</span>
<span class="sd">        for the given wavelength of O II recombination line</span>
<span class="sd">        by using the recombination coefficients from</span>
<span class="sd">        Storey 1994A&amp;A...282..999S and Liu et al. 1995MNRAS.272..369L.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the line emissivity.</span>

<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :     in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density       :     in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        wavelength    :     in, required, type=float</span>
<span class="sd">                            Line Wavelength in Angstrom</span>
<span class="sd">        o_ii_rc_br    :     in, required, type=array/object</span>
<span class="sd">                            O II branching ratios (Br)</span>
<span class="sd">        o_ii_rc_data  :     in, required, type=array/object</span>
<span class="sd">                            O II recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_all_file= os.path.join(base_dir,data_rc_dir, &#39;rc_collection.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;o&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39; # O II</span>
<span class="sd">        &gt;&gt;&gt; o_ii_rc_data=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; o_ii_rc_data_br=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion, br=True)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; wavelength=4613.68</span>
<span class="sd">        &gt;&gt;&gt; emiss_o_ii=pyequib.calc_emiss_o_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                               wavelength=wavelength,</span>
<span class="sd">        &gt;&gt;&gt;                               o_ii_rc_br=o_ii_rc_data_br, o_ii_rc_data=o_ii_rc_data,</span>
<span class="sd">        &gt;&gt;&gt;                               h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;Emissivity:&#39;, emiss_o_ii)</span>
<span class="sd">           Emissivity:   5.9047319e-27</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Recombination Lines, Emissivity</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on recombination coefficients for O II lines from</span>
<span class="sd">        Storey 1994A&amp;A...282..999S and Liu et al. 1995MNRAS.272..369L.</span>

<span class="sd">        Adopted from MIDAS script Roii.prg written by X.W.Liu.</span>

<span class="sd">        Revised based on scripts by Yong Zhang added to MOCASSIN, 02/2003</span>
<span class="sd">                          Ercolano et al. 2005MNRAS.362.1038E.</span>

<span class="sd">        10/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">        25/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">        10/07/2019, A. Danehkar, Made a new function calc_emiss_o_ii_rl()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abund_o_ii_rl().</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>

<span class="c1">#  oiiRLstructure ={Wave:np.float64(0.0), #REAL*8</span>
<span class="c1">#              Int:np.float64(0.0),</span>
<span class="c1">#              Obs:np.float64(0.0),</span>
<span class="c1">#              abundance:np.float64(0.0),</span>
<span class="c1">#              g1:long(0), #INTEGER</span>
<span class="c1">#              g2:long(0), #INTEGER</span>
<span class="c1">#              Mult1:&#39;&#39;, #CHARACTER*7</span>
<span class="c1">#              Term1:&#39;&#39;, #CHARACTER*9</span>
<span class="c1">#              Term2:&#39;&#39; #CHARACTER*9</span>
<span class="c1">#              }</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">6.62606957e-27</span><span class="p">)</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">2.99792458e10</span><span class="p">)</span> <span class="c1"># cm/s</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">o_ii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;O II recombination coefficients (o_ii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">o_ii_rc_br</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;O II branching ratios (o_ii_rc_br) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">br_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">br_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">br_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">temp4</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">/</span> <span class="mf">10000.0</span>
   <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">)</span>
   <span class="n">loc1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">temp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">temp2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">wavelength_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wavelength_min</span><span class="p">)</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">temp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">temp2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
   
   <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">br_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;br_a&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">br_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;br_b&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">br_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;br_c&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;g1&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_br</span><span class="p">[</span><span class="s1">&#39;g2&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">densi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
   <span class="n">log10ne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">densi</span><span class="p">)</span>

   <span class="c1">#---------------------------------------</span>
   <span class="k">if</span> <span class="p">(((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">182</span><span class="p">))):</span>
      <span class="c1"># 4f-3d transitions</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 0.232</span>
      <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#-0.92009</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 0.15526</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 0.03442</span>
      <span class="c1"># an = [0.236, 0.232, 0.228, 0.222]</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a2&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a5&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a6&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])])</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      
      <span class="n">temp4</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">/</span> <span class="mf">10000.0</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.0e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      
      <span class="c1"># data for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">0.236</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.07552</span>
         <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.04843</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.0e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">))</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_b</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">183</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">218</span><span class="p">)):</span>
      <span class="c1"># 3d-3p ^4F transitions (Case A=B=C for a,b,c,d# Br diff. slightly, adopt Case B)</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># 0.876</span>
      <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># -0.73465</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># 0.13689</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># 0.06220</span>
      <span class="c1"># an = [0.876, 0.876, 0.877, 0.880] #a for logNe = 2,4,5,6 (LSBC95, Tab.5a)</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a2&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a5&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a6&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])])</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">0.878</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.86175</span>
         <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.02470</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">))</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_b</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">219</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">309</span><span class="p">)):</span>
      <span class="c1"># 3d-3p ^4D, ^4P transitions</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># 0.745</span>
      <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># -0.74621</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># 0.15710</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># 0.07059</span>
      <span class="c1">#an = [0.727,0.726,0.725,0.726] # Case: A</span>
      <span class="c1"># an = [0.747, 0.745, 0.744, 0.745] # Case: B</span>
      <span class="c1">#an = [0.769,0.767,0.766,0.766] # Case: C</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a2&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a5&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a6&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])])</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">0.747</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.89382</span>
         <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.02906</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">))</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_b</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">310</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">327</span><span class="p">)):</span>
      <span class="c1"># 3d-3p ^2F transitions</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># 0.745</span>
      <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># -0.74621</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># 0.15710</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span> <span class="c1"># 0.07059</span>
      <span class="c1">#an = [0.727, 0.726, 0.725, 0.726] # Case: A</span>
      <span class="c1">#an = [0.747,0.745,0.744,0.745] # Case: B</span>
      <span class="c1">#an = [0.769,0.767,0.766,0.766] # Case: C</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a2&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a5&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a6&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]])</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">0.747</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.89382</span>
         <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.02906</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">))</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_a</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">328</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">357</span><span class="p">)):</span>
      <span class="c1"># 3d-3p ^2D transitions</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">])</span> <span class="c1"># 0.601</span>
      <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">])</span> <span class="c1"># -0.79533</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">])</span> <span class="c1"># 0.15314</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">])</span> <span class="c1"># 0.05322</span>
      <span class="c1">#an = [0.603, 0.601, 0.600, 0.599] # Case: A</span>
      <span class="c1">#an = [0.620,0.618,0.616,0.615] # Case: C</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a2&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a5&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a6&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">])])</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">0.603</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.94025</span>
         <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.03467</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">))</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_a</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">358</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">387</span><span class="p">)):</span>
      <span class="c1"># 3d-3p ^2P transitions</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">])</span> <span class="c1"># 0.524</span>
      <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">])</span> <span class="c1"># -0.78448</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">])</span> <span class="c1"># 0.13681</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">])</span> <span class="c1"># 0.05608</span>
      <span class="c1">#an = [0.526, 0.524, 0.523, 0.524] # Case: A</span>
      <span class="c1">#an = [0.538,0.536,0.535,0.536] # Case: C</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a2&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a4&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a5&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]),</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">o_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a6&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">])])</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">0.526</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.91758</span>
         <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.03120</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">))</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_a</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">388</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">395</span><span class="p">)):</span>
      <span class="c1"># 3p-3s ^4D - ^4P transitions</span>
      <span class="c1">#an = [34.7,34.9,35.1,35.0] #a  Case: A</span>
      <span class="c1">#a =  36.2</span>
      <span class="c1">#b =  -0.749</span>
      <span class="c1">#c =  0.023</span>
      <span class="c1">#d =  0.074</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">36.0</span><span class="p">,</span> <span class="mf">36.2</span><span class="p">,</span> <span class="mf">36.4</span><span class="p">,</span> <span class="mf">36.3</span><span class="p">])</span> <span class="c1">#a  Case: B</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mf">36.2</span>
      <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.736</span>
      <span class="n">c</span> <span class="o">=</span> <span class="mf">0.033</span>
      <span class="n">d</span> <span class="o">=</span> <span class="mf">0.077</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">36.288</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.75421</span>
         <span class="n">c</span> <span class="o">=</span> <span class="mf">0.02883</span>
         <span class="n">d</span> <span class="o">=</span> <span class="mf">0.01213</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_b</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">396</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">402</span><span class="p">)):</span>
      <span class="c1"># 3p-3s ^4P - ^4P transitions</span>
      <span class="c1">#an = [10.4,10.4,10.5,10.4] # Case: A</span>
      <span class="c1">#a =  10.4</span>
      <span class="c1">#b =  -0.721</span>
      <span class="c1">#c =  0.073</span>
      <span class="c1">#d =  0.072</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">14.6</span><span class="p">,</span> <span class="mf">14.6</span><span class="p">,</span> <span class="mf">14.7</span><span class="p">,</span> <span class="mf">14.6</span><span class="p">])</span> <span class="c1"># Case: B</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mf">14.6</span>
      <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.732</span>
      <span class="n">c</span> <span class="o">=</span> <span class="mf">0.081</span>
      <span class="n">d</span> <span class="o">=</span> <span class="mf">0.066</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">14.656</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.80449</span>
         <span class="n">c</span> <span class="o">=</span> <span class="mf">0.00018</span>
         <span class="n">d</span> <span class="o">=</span> <span class="mf">0.00517</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_b</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">403</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">405</span><span class="p">)):</span>
      <span class="c1"># 3p-3s ^4S - ^4P transitions</span>
      <span class="c1">#an = [0.90,0.90,0.90,1.00] # Case: A</span>
      <span class="c1">#a =  0.90</span>
      <span class="c1">#b =  -0.485</span>
      <span class="c1">#c =  -0.047</span>
      <span class="c1">#d =  0.140</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.80</span><span class="p">,</span> <span class="mf">4.90</span><span class="p">,</span> <span class="mf">4.90</span><span class="p">,</span> <span class="mf">4.90</span><span class="p">])</span> <span class="c1"># Case: B</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mf">4.90</span>
      <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.730</span>
      <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.003</span>
      <span class="n">d</span> <span class="o">=</span> <span class="mf">0.057</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">4.8340</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.71947</span>
         <span class="n">c</span> <span class="o">=</span> <span class="mf">0.02544</span>
         <span class="n">d</span> <span class="o">=</span> <span class="mf">0.00936</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_b</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">406</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">408</span><span class="p">)):</span>
      <span class="c1"># 3p-3s ^2D - ^2P transitions</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.40</span><span class="p">,</span> <span class="mf">2.40</span><span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">2.60</span><span class="p">])</span> <span class="c1"># Case: A</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mf">2.40</span>
      <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.550</span>
      <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.051</span>
      <span class="n">d</span> <span class="o">=</span> <span class="mf">0.178</span>
      <span class="c1">#an = [14.5,14.6,14.5,14.3] # Case: C</span>
      <span class="c1">#a =  14.6</span>
      <span class="c1">#b =  -0.736</span>
      <span class="c1">#c =  0.068</span>
      <span class="c1">#d =  0.066</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">2.3616</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.46263</span>
         <span class="n">c</span> <span class="o">=</span> <span class="mf">0.14697</span>
         <span class="n">d</span> <span class="o">=</span> <span class="mf">0.03856</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_a</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">409</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">412</span><span class="p">)):</span>
      <span class="c1"># 3p-3s ^2P - ^2P transitions</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.10</span><span class="p">,</span> <span class="mf">1.20</span><span class="p">,</span> <span class="mf">1.20</span><span class="p">,</span> <span class="mf">1.20</span><span class="p">])</span> <span class="c1"># Case: A</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mf">1.20</span>
      <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.523</span>
      <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.044</span>
      <span class="n">d</span> <span class="o">=</span> <span class="mf">0.173</span>
      <span class="c1">#an = [1.30,1.40,1.40,1.40] # Case: C</span>
      <span class="c1">#a =  1.40</span>
      <span class="c1">#b =  -0.565</span>
      <span class="c1">#c =  -0.042</span>
      <span class="c1">#d =  0.158</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">1.1198</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.44147</span>
         <span class="n">c</span> <span class="o">=</span> <span class="mf">0.13837</span>
         <span class="n">d</span> <span class="o">=</span> <span class="mf">0.03191</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_a</span>
      <span class="c1">#---------------------------------------</span>
   <span class="k">elif</span> <span class="p">((</span><span class="n">loc1</span> <span class="o">&gt;=</span> <span class="mi">413</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">loc1</span> <span class="o">&lt;=</span> <span class="mi">414</span><span class="p">)):</span>
      <span class="c1"># 3p-3s ^2S - ^2P transitions</span>
      <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">])</span> <span class="c1"># Case: A</span>
      <span class="n">a</span> <span class="o">=</span> <span class="mf">0.40</span>
      <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.461</span>
      <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.083</span>
      <span class="n">d</span> <span class="o">=</span> <span class="mf">0.287</span>
      <span class="c1">#an = [0.50,0.50,0.50,0.60] # Case: C</span>
      <span class="c1">#a =  0.50</span>
      <span class="c1">#b =  -0.547</span>
      <span class="c1">#c =  -0.074</span>
      <span class="c1">#d =  0.244</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)):</span>
               <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">((</span><span class="n">log10ne</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)):</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">an</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">log10ne</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="n">a</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="c1"># for 1000 &lt; T &lt; 5000 K, Ne = 100/cm3</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">0.3922</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.35043</span>
         <span class="n">c</span> <span class="o">=</span> <span class="mf">0.26366</span>
         <span class="n">d</span> <span class="o">=</span> <span class="mf">0.06666</span>
         <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.e-14</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">temp4</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">br</span> <span class="o">=</span> <span class="n">br_a</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wavelength has an illegal value.&#39;</span><span class="p">)</span>
   
   <span class="c1"># Ems1 = aeff * (h_Planck*c_Speed*1.e8) /Wave * g2 * Br_A#[loc1]</span>
   <span class="c1"># oiiRLs_Int = 100. * Ems1 / hbeta_ems * abund</span>
   <span class="c1">#abund=line_flux/oiiRLs_Int</span>
   
   <span class="n">emissivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">aeff</span> <span class="o">*</span> <span class="n">g2</span> <span class="o">*</span> <span class="n">br</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">emissivity</span></div>

<div class="viewcode-block" id="calc_emiss_ne_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_emiss_ne_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_emiss_ne_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ne_ii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function calculates the emissivity</span>
<span class="sd">         for the given wavelength of Ne II recombination line</span>
<span class="sd">         by using the recombination coefficients from</span>
<span class="sd">         Kisielius et al. (1998) &amp; Storey (unpublished).</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the line emissivity.</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature   :     in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density       :     in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         wavelength    :     in, required, type=float</span>
<span class="sd">                             Line Wavelength in Angstrom</span>
<span class="sd">         ne_ii_rc_data  :    in, required, type=array/object</span>
<span class="sd">                             Ne II recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; import atomneb</span>
<span class="sd">         &gt;&gt;&gt; import os</span>
<span class="sd">         &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">         &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_all_file= os.path.join(base_dir,data_rc_dir, &#39;rc_collection.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt;</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;ne&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;iii&#39; # Ne II</span>
<span class="sd">         &gt;&gt;&gt; ne_ii_rc_data=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">         &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">         &gt;&gt;&gt; wavelength=3777.14</span>
<span class="sd">         &gt;&gt;&gt; emiss_ne_ii=pyequib.calc_emiss_ne_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">         &gt;&gt;&gt;                                 wavelength=wavelength,</span>
<span class="sd">         &gt;&gt;&gt;                                 ne_ii_rc_data=ne_ii_rc_data, h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;Emissivity:&#39;, emiss_ne_ii)</span>
<span class="sd">            Emissivity:   1.5996881e-25</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines, Emissivity</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on effective radiative recombination coefficients for Ne II lines</span>
<span class="sd">         from Kisielius et al. 1998A&amp;AS..133..257K &amp; Storey (unpublished).</span>

<span class="sd">         Adopted from MOCASSIN, Ercolano et al. 2005MNRAS.362.1038E.</span>

<span class="sd">         02/2003, Yong Zhang, scripts added to MOCASSIN.</span>

<span class="sd">         14/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">         10/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Made a new function calc_emiss_ne_ii_rl()</span>
<span class="sd">                          for calculating line emissivities and separated it</span>
<span class="sd">                          from calc_abund_ne_ii_rl().</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># neiiRLstructure ={Wave:np.float64(0.0), Int:np.float64(0.0), Obs:np.float64(0.0), Abundance:np.float64(0.0)}</span>
   <span class="n">h_planck</span> <span class="o">=</span> <span class="mf">6.62606957e-27</span> <span class="c1"># erg s</span>
   <span class="n">c_speed</span> <span class="o">=</span> <span class="mf">2.99792458e10</span> <span class="c1"># cm/s </span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ne_ii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ne II recombination coefficients (ne_ii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">ion</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
   
   <span class="n">z</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="c1"># ion level c^3+</span>
   <span class="c1"># equation (1) in 1991A&amp;A...251..680P</span>
   <span class="n">temp4</span> <span class="o">=</span> <span class="n">temperature</span> <span class="o">/</span> <span class="mf">10000.0</span>
   <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wavelength</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">)</span>
   <span class="n">loc1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">temp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">loc1</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">temp2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">wavelength_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">wavelength_min</span><span class="p">)</span>
      <span class="n">loc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loc1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">lamb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="n">br</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ne_ii_rc_data</span><span class="p">[</span><span class="s1">&#39;br&#39;</span><span class="p">][</span><span class="n">loc1</span><span class="p">])</span>
   <span class="c1"># equation (1) in 1991A&amp;A...251..680P</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="mf">1.0e-14</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp4</span> <span class="o">**</span> <span class="n">f</span><span class="p">))</span> <span class="o">*</span> <span class="n">br</span>
   <span class="n">aeff</span> <span class="o">=</span> <span class="n">aeff</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">temp4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
   <span class="c1">#neiiRLs_Int = 100.0 * (aeff/hbeta_aeff) * (4861.33/lamb) * abund</span>
   <span class="c1">#abund=line_flux/neiiRLs_Int</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">aeff</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">lamb</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">h_planck</span> <span class="o">*</span> <span class="n">c_speed</span> <span class="o">*</span> <span class="mf">1.e8</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">emissivity</span></div>

<div class="viewcode-block" id="calc_abund_he_i_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abund_he_i_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_abund_he_i_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">linenum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">he_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function determines the ionic abundance from the observed</span>
<span class="sd">         flux intensity for the given wavelength of He I recombination line</span>
<span class="sd">         by using the recombination coefficients from Porter et al.</span>
<span class="sd">         2012MNRAS.425L..28P.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the ionic abundanc.</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature    :    in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density        :    in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         linenum        :    in, required, type=int</span>
<span class="sd">                             Line Number for Wavelength</span>

<span class="sd">                             Wavelength=4120.84:linenum=7,</span>

<span class="sd">                             Wavelength=4387.93: linenum=8,</span>

<span class="sd">                             Wavelength=4437.55: linenum=9,</span>

<span class="sd">                             Wavelength=4471.50: linenum=10,</span>

<span class="sd">                             Wavelength=4921.93: linenum=12,</span>

<span class="sd">                             Wavelength=5015.68: linenum=13,</span>

<span class="sd">                             Wavelength=5047.74: linenum=14,</span>

<span class="sd">                             Wavelength=5875.66: linenum=15,</span>

<span class="sd">                             Wavelength=6678.16: linenum=16,</span>

<span class="sd">                             Wavelength=7065.25: linenum=17,</span>

<span class="sd">                             Wavelength=7281.35: linenum=18.</span>

<span class="sd">         line_flux      :    in, required, type=float</span>
<span class="sd">                             line flux intensity</span>
<span class="sd">         he_i_aeff_data :    in, required, type=array/object</span>
<span class="sd">                             He I recombination coefficients</span>
<span class="sd">         h_i_aeff_data  :    in, required, type=array/object</span>
<span class="sd">                             H I recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; import atomneb</span>
<span class="sd">         &gt;&gt;&gt; import os</span>
<span class="sd">         &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">         &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_he_i_file= os.path.join(base_dir,data_rc_dir, &#39;rc_he_ii_PFSD12.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">         &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;he&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;ii&#39; # He I</span>
<span class="sd">         &gt;&gt;&gt; he_i_rc_data=atomneb.read_aeff_he_i_pfsd12(atom_rc_he_i_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; he_i_aeff_data=he_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">         &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">         &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">         &gt;&gt;&gt; he_i_4471_flux= 2.104</span>
<span class="sd">         &gt;&gt;&gt; linenum=10# 4471.50</span>
<span class="sd">         &gt;&gt;&gt; abund_he_i=pyequib.calc_abund_he_i_rl(temperature=temperature, density=density,</span>
<span class="sd">         &gt;&gt;&gt;                                  linenum=linenum, line_flux=he_i_4471_flux,</span>
<span class="sd">         &gt;&gt;&gt;                                  he_i_aeff_data=he_i_aeff_data, h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;N(He^+)/N(H^+):&#39;, abund_he_i)</span>
<span class="sd">            N(He^+)/N(H^+):     0.040848393</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on improved He I emissivities in the case B</span>
<span class="sd">         from Porter et al. 2012MNRAS.425L..28P</span>

<span class="sd">         15/12/2013, A. Danehkar, IDL code written.</span>

<span class="sd">         20/03/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Made a new function calc_emiss_he_i_rl()</span>
<span class="sd">                          for calculating line emissivities and separated it</span>
<span class="sd">                          from calc_abund_he_i_rl().</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">he_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;He I recombination coefficients (he_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">linenum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line Number for Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">calc_emiss_he_i_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">linenum</span><span class="o">=</span><span class="n">linenum</span><span class="p">,</span> <span class="n">he_i_aeff_data</span><span class="o">=</span><span class="n">he_i_aeff_data</span><span class="p">)</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="calc_abund_he_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abund_he_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_abund_he_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">he_ii_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function determines the ionic abundance from the observed</span>
<span class="sd">         flux intensity for the He II recombination line 4686 A</span>
<span class="sd">         by using the helium emissivities from</span>
<span class="sd">         Storey &amp; Hummer, 1995MNRAS.272...41S.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the ionic abundanc.</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature     :   in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density         :   in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         line_flux       :   in, required, type=float</span>
<span class="sd">                             line flux intensity</span>
<span class="sd">         he_ii_aeff_data :   in, required, type=array/object</span>
<span class="sd">                             He II recombination coefficients</span>
<span class="sd">         h_i_aeff_data   :   in, required, type=array/object</span>
<span class="sd">                             H I recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; import atomneb</span>
<span class="sd">         &gt;&gt;&gt; import os</span>
<span class="sd">         &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">         &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_he_i_file= os.path.join(base_dir,data_rc_dir, &#39;rc_he_ii_PFSD12.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">         &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;he&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;iii&#39; # He II</span>
<span class="sd">         &gt;&gt;&gt; he_ii_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; he_ii_aeff_data=he_ii_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">         &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">         &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">         &gt;&gt;&gt; he_ii_4686_flux = 135.833</span>
<span class="sd">         &gt;&gt;&gt; abund_he_ii=pyequib.calc_abund_he_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">         &gt;&gt;&gt;                                 line_flux=he_ii_4686_flux,</span>
<span class="sd">         &gt;&gt;&gt;                                 he_ii_aeff_data=he_ii_aeff_data, h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;N(He^2+)/N(H^+):&#39;, abund_he_ii)</span>
<span class="sd">            N(He^2+)/N(H^+):      0.11228817</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on He II emissivities</span>
<span class="sd">         from Storey &amp; Hummer, 1995MNRAS.272...41S.</span>

<span class="sd">         15/12/2013, A. Danehkar, IDL code written.</span>

<span class="sd">         02/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Made a new function calc_emiss_he_ii_rl()</span>
<span class="sd">                          for calculating line emissivities and separated it</span>
<span class="sd">                          from calc_abund_he_ii_rl().</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">he_ii_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;He II recombination coefficients (he_ii_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">calc_emiss_he_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">he_ii_aeff_data</span><span class="o">=</span><span class="n">he_ii_aeff_data</span><span class="p">)</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="calc_abund_c_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abund_c_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_abund_c_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">c_ii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines the ionic abundance from the observed</span>
<span class="sd">        flux intensity for the given wavelength of C II recombination line</span>
<span class="sd">        by using the recombination coefficients from</span>
<span class="sd">        from Davey et al. (2000) 2000A&amp;AS..142...85D.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the ionic abundanc.</span>

<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :     in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density       :     in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        wavelength    :     in, required, type=float</span>
<span class="sd">                            Line Wavelength in Angstrom</span>
<span class="sd">        line_flux     :     in, required, type=float</span>
<span class="sd">                            line flux intensity</span>
<span class="sd">        c_ii_rc_data  :     in, required, type=array/object</span>
<span class="sd">                            C II recombination coefficients</span>
<span class="sd">        h_i_aeff_data :     in, required, type=array/object</span>
<span class="sd">                            H I recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_all_file= os.path.join(base_dir,data_rc_dir, &#39;rc_collection.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">        &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;c&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39; # C II</span>
<span class="sd">        &gt;&gt;&gt; c_ii_rc_data=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; c_ii_6151_flux = 0.028</span>
<span class="sd">        &gt;&gt;&gt; wavelength=6151.43</span>
<span class="sd">        &gt;&gt;&gt; abund_c_ii=pyequib.calc_abund_c_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                               wavelength=wavelength, line_flux=c_ii_6151_flux,</span>
<span class="sd">        &gt;&gt;&gt;                               c_ii_rc_data=c_ii_rc_data, h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;N(C^2+)/N(H+):&#39;, abund_c_ii)</span>
<span class="sd">           N(C^2+)/N(H+):    0.00063404650</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Recombination Lines</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on recombination coefficients for C II lines from</span>
<span class="sd">        Davey et al. 2000A&amp;AS..142...85D.</span>

<span class="sd">        Adopted from MOCASSIN, Ercolano et al. 2005MNRAS.362.1038E.</span>

<span class="sd">        02/2003, Yong Zhang, added to MOCASSIN.</span>

<span class="sd">        10/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">        15/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">        10/07/2019, A. Danehkar, Made a new function calc_emiss_c_ii_rl()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abund_c_ii_rl().</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python. </span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># ciiRLstructure ={Wave:np.float64(0.0), Int:np.float64(0.0), Obs:np.float64(0.0), Abundance:np.float64(0.0)}</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">c_ii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;C II recombination coefficients (c_ii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">calc_emiss_c_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">c_ii_rc_data</span><span class="o">=</span><span class="n">c_ii_rc_data</span><span class="p">)</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="calc_abund_c_iii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abund_c_iii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_abund_c_iii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">c_iii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function determines the ionic abundance from the observed</span>
<span class="sd">         flux intensity for the given wavelength of C III recombination line</span>
<span class="sd">         by using the recombination coefficients from</span>
<span class="sd">         Pequignot et al. 1991A&amp;A...251..680P.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the ionic abundanc.</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature   :     in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density       :     in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         wavelength    :     in, required, type=float</span>
<span class="sd">                             Line Wavelength in Angstrom</span>
<span class="sd">         line_flux     :     in, required, type=float</span>
<span class="sd">                             line flux intensity</span>
<span class="sd">         c_iii_rc_data :     in, required, type=array/object</span>
<span class="sd">                             C III recombination coefficients</span>
<span class="sd">         h_i_aeff_data :     in, required, type=array/object</span>
<span class="sd">                             H I recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; import atomneb</span>
<span class="sd">         &gt;&gt;&gt; import os</span>
<span class="sd">         &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">         &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_ppb91_file=os.path.join(base_dir,data_rc_dir, &#39;rc_PPB91.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">         &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;c&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;iv&#39; # C III</span>
<span class="sd">         &gt;&gt;&gt; c_iii_rc_data=atomneb.read_aeff_ppb91(atom_rc_ppb91_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">         &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">         &gt;&gt;&gt; c_iii_4647_flux = 0.107</span>
<span class="sd">         &gt;&gt;&gt; wavelength=4647.42</span>
<span class="sd">         &gt;&gt;&gt; abund_c_iii=pyequib.calc_abund_c_iii_rl(temperature=temperature, density=density,</span>
<span class="sd">         &gt;&gt;&gt;                                 wavelength=wavelength, line_flux=c_iii_4647_flux,</span>
<span class="sd">         &gt;&gt;&gt;                                 c_iii_rc_data=c_iii_rc_data, h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;N(C^3+)/N(H+):&#39;, abund_c_iii)</span>
<span class="sd">            N(C^3+)/N(H+):    0.00017502840</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on effective radiative recombination coefficients for C III lines from</span>
<span class="sd">         Pequignot, Petitjean, Boisson, C. 1991A&amp;A...251..680P.</span>

<span class="sd">         18/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">         06/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Made a new function calc_emiss_c_iii_rl()</span>
<span class="sd">                          for calculating line emissivities and separated it</span>
<span class="sd">                          from calc_abund_c_iii_rl().</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># ciiiRLstructure ={Wave:np.float64(0.0), Int:np.float64(0.0), Obs:np.float64(0.0), Abundance:np.float64(0.0)}</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">c_iii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;C III recombination coefficients (c_iii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">calc_emiss_c_iii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">c_iii_rc_data</span><span class="o">=</span><span class="n">c_iii_rc_data</span><span class="p">)</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="calc_abund_n_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abund_n_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_abund_n_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">n_ii_rc_br</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_ii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines the ionic abundance from the observed</span>
<span class="sd">        flux intensity for the given wavelength of N II recombination line</span>
<span class="sd">        by using the recombination coefficients from</span>
<span class="sd">        Escalante &amp; Victor 1990ApJS...73..513E.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the ionic abundanc.</span>

<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :     in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density       :     in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        wavelength    :     in, required, type=float</span>
<span class="sd">                            Line Wavelength in Angstrom</span>
<span class="sd">        line_flux     :     in, required, type=float</span>
<span class="sd">                            line flux intensity</span>
<span class="sd">        n_ii_rc_br    :     in, required, type=array/object</span>
<span class="sd">                            N II branching ratios (Br)</span>
<span class="sd">        n_ii_rc_data  :     in, required, type=array/object</span>
<span class="sd">                            N II recombination coefficients</span>
<span class="sd">        h_i_aeff_data :     in, required, type=array/object</span>
<span class="sd">                            H I recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_all_file= os.path.join(base_dir,data_rc_dir, &#39;rc_collection.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">        &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;n&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39; # N II</span>
<span class="sd">        &gt;&gt;&gt; n_ii_rc_data=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; n_ii_rc_data_br=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion, br=True)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; n_ii_4442_flux = 0.017</span>
<span class="sd">        &gt;&gt;&gt; wavelength=4442.02</span>
<span class="sd">        &gt;&gt;&gt; abund_n_ii=pyequib.calc_abund_n_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                               wavelength=wavelength, line_flux=n_ii_4442_flux,</span>
<span class="sd">        &gt;&gt;&gt;                               n_ii_rc_br=n_ii_rc_data_br, n_ii_rc_data=n_ii_rc_data,</span>
<span class="sd">        &gt;&gt;&gt;                               h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;N(N^2+)/N(H+):&#39;, abund_n_ii)</span>
<span class="sd">           N(N^2+)/N(H+):   0.00069297541</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Recombination Lines</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on Effective recombination coefficients for N II lines from</span>
<span class="sd">        Escalante &amp; Victor 1990ApJS...73..513E.</span>

<span class="sd">        Adopted from MIDAS Rnii script written by X.W.Liu.</span>

<span class="sd">        Revised based on scripts by Yong Zhang added to MOCASSIN, 02/2003</span>
<span class="sd">                          Ercolano et al. 2005MNRAS.362.1038E.</span>

<span class="sd">        10/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">        25/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">        10/07/2019, A. Danehkar, Made a new function calc_emiss_n_ii_rl()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abund_n_ii_rl().</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>

<span class="c1">#  niiRLstructure ={Wave:np.float64(0.0), #REAL*8</span>
<span class="c1">#              Int:np.float64(0.0),</span>
<span class="c1">#              Obs:np.float64(0.0),</span>
<span class="c1">#              abundance:np.float64(0.0),</span>
<span class="c1">#              g1:long(0), #INTEGER</span>
<span class="c1">#              g2:long(0), #INTEGER</span>
<span class="c1">#              Mult1:&#39;&#39;, #CHARACTER*7</span>
<span class="c1">#              Term1:&#39;&#39;, #CHARACTER*9</span>
<span class="c1">#              Term2:&#39;&#39; #CHARACTER*9</span>
<span class="c1">#              }</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">n_ii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N II recombination coefficients (n_ii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">n_ii_rc_br</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N II branching ratios (n_ii_rc_br) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">calc_emiss_n_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">n_ii_rc_br</span><span class="o">=</span><span class="n">n_ii_rc_br</span><span class="p">,</span> <span class="n">n_ii_rc_data</span><span class="o">=</span><span class="n">n_ii_rc_data</span><span class="p">)</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="calc_abund_n_iii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abund_n_iii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_abund_n_iii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">n_iii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function determines the ionic abundance from the observed</span>
<span class="sd">         flux intensity for the given wavelength of N III recombination line</span>
<span class="sd">         by using the recombination coefficients from</span>
<span class="sd">         Pequignot et al. 1991A&amp;A...251..680P.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the ionic abundanc.</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature   :     in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density       :     in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         wavelength    :     in, required, type=float</span>
<span class="sd">                             Line Wavelength in Angstrom</span>
<span class="sd">         line_flux     :     in, required, type=float</span>
<span class="sd">                             line flux intensity</span>
<span class="sd">         n_iii_rc_data  :     in, required, type=array/object</span>
<span class="sd">                             N III recombination coefficients</span>
<span class="sd">         h_i_aeff_data :     in, required, type=array/object</span>
<span class="sd">                             H I recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; import atomneb</span>
<span class="sd">         &gt;&gt;&gt; import os</span>
<span class="sd">         &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">         &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_ppb91_file=os.path.join(base_dir,data_rc_dir, &#39;rc_PPB91.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">         &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;n&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;iv&#39; # N III</span>
<span class="sd">         &gt;&gt;&gt; n_iii_rc_data=atomneb.read_aeff_ppb91(atom_rc_ppb91_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">         &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">         &gt;&gt;&gt; n_iii_4641_flux = 0.245</span>
<span class="sd">         &gt;&gt;&gt; wavelength=4640.64</span>
<span class="sd">         &gt;&gt;&gt; abund_n_iii=pyequib.calc_abund_n_iii_rl(temperature=temperature, density=density,</span>
<span class="sd">         &gt;&gt;&gt;                                 wavelength=wavelength, line_flux=n_iii_4641_flux,</span>
<span class="sd">         &gt;&gt;&gt;                                 n_iii_rc_data=n_iii_rc_data, h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;N(N^3+)/N(H+):&#39;, abund_n_iii)</span>
<span class="sd">            N(N^3+)/N(H+):    6.3366175e-05</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on  effective radiative recombination coefficients for N III lines from</span>
<span class="sd">         Pequignot, Petitjean, Boisson, C. 1991A&amp;A...251..680P.</span>

<span class="sd">         10/05/2013, A. Danehkar, IDL code written.</span>

<span class="sd">         20/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Made a new function calc_emiss_n_iii_rl()</span>
<span class="sd">                          for calculating line emissivities and separated it</span>
<span class="sd">                          from calc_abund_n_iii_rl().</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># niiiRLstructure ={Wave:np.float64(0.0), Int:np.float64(0.0), Obs:np.float64(0.0), Abundance:np.float64(0.0)}</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">n_iii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N III recombination coefficients (n_iii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">calc_emiss_n_iii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">n_iii_rc_data</span><span class="o">=</span><span class="n">n_iii_rc_data</span><span class="p">)</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="calc_abund_o_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abund_o_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_abund_o_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">o_ii_rc_br</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">o_ii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines the ionic abundance from the observed</span>
<span class="sd">        flux intensity for the given wavelength of O II recombination line</span>
<span class="sd">        by using the recombination coefficients from</span>
<span class="sd">        Storey 1994A&amp;A...282..999S and Liu et al. 1995MNRAS.272..369L.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double. This function returns the ionic abundanc.</span>

<span class="sd">    :Keywords:</span>
<span class="sd">        temperature   :     in, required, type=float</span>
<span class="sd">                            electron temperature</span>
<span class="sd">        density       :     in, required, type=float</span>
<span class="sd">                            electron density</span>
<span class="sd">        wavelength    :     in, required, type=float</span>
<span class="sd">                            Line Wavelength in Angstrom</span>
<span class="sd">        line_flux     :     in, required, type=float</span>
<span class="sd">                            line flux intensity</span>
<span class="sd">        o_ii_rc_br    :     in, required, type=array/object</span>
<span class="sd">                            O II branching ratios (Br)</span>
<span class="sd">        o_ii_rc_data  :     in, required, type=array/object</span>
<span class="sd">                            O II recombination coefficients</span>
<span class="sd">        h_i_aeff_data :     in, required, type=array/object</span>
<span class="sd">                            H I recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; import atomneb</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_all_file= os.path.join(base_dir,data_rc_dir, &#39;rc_collection.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">        &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">        &gt;&gt;&gt; atom=&#39;o&#39;</span>
<span class="sd">        &gt;&gt;&gt; ion=&#39;iii&#39; # O II</span>
<span class="sd">        &gt;&gt;&gt; o_ii_rc_data=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion)</span>
<span class="sd">        &gt;&gt;&gt; o_ii_rc_data_br=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion, br=True)</span>
<span class="sd">        &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">        &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">        &gt;&gt;&gt; o_ii_4614_flux = 0.009</span>
<span class="sd">        &gt;&gt;&gt; wavelength=4613.68</span>
<span class="sd">        &gt;&gt;&gt; abund_o_ii=pyequib.calc_abund_o_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">        &gt;&gt;&gt;                               wavelength=wavelength, line_flux=o_ii_4614_flux,</span>
<span class="sd">        &gt;&gt;&gt;                               o_ii_rc_br=o_ii_rc_data_br, o_ii_rc_data=o_ii_rc_data,</span>
<span class="sd">        &gt;&gt;&gt;                               h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;N(O^2+)/N(H+):&#39;, abund_o_ii)</span>
<span class="sd">           N(O^2+)/N(H+):    0.0018886330</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Abundance Analysis, Recombination Lines</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Main routines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on recombination coefficients for O II lines from</span>
<span class="sd">        Storey 1994A&amp;A...282..999S and Liu et al. 1995MNRAS.272..369L.</span>

<span class="sd">        Adopted from MIDAS script Roii.prg written by X.W.Liu.</span>

<span class="sd">        Revised based on scripts by Yong Zhang added to MOCASSIN, 02/2003</span>
<span class="sd">                          Ercolano et al. 2005MNRAS.362.1038E.</span>

<span class="sd">        10/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">        25/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">        10/07/2019, A. Danehkar, Made a new function calc_emiss_o_ii_rl()</span>
<span class="sd">                         for calculating line emissivities and separated it</span>
<span class="sd">                         from calc_abund_o_ii_rl().</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>

<span class="c1">#  oiiRLstructure ={Wave:np.float64(0.0), #REAL*8</span>
<span class="c1">#              Int:np.float64(0.0),</span>
<span class="c1">#              Obs:np.float64(0.0),</span>
<span class="c1">#              abundance:np.float64(0.0),</span>
<span class="c1">#              g1:long(0), #INTEGER</span>
<span class="c1">#              g2:long(0), #INTEGER</span>
<span class="c1">#              Mult1:&#39;&#39;, #CHARACTER*7</span>
<span class="c1">#              Term1:&#39;&#39;, #CHARACTER*9</span>
<span class="c1">#              Term2:&#39;&#39; #CHARACTER*9</span>
<span class="c1">#              }</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">o_ii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;O II recombination coefficients (o_ii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">o_ii_rc_br</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;O II branching ratios (o_ii_rc_br) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">calc_emiss_o_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">o_ii_rc_br</span><span class="o">=</span><span class="n">o_ii_rc_br</span><span class="p">,</span> <span class="n">o_ii_rc_data</span><span class="o">=</span><span class="n">o_ii_rc_data</span><span class="p">)</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="calc_abund_ne_ii_rl"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.calc_abund_ne_ii_rl">[docs]</a><span class="k">def</span> <span class="nf">calc_abund_ne_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">wavelength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">line_flux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">ne_ii_rc_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function determines the ionic abundance from the observed</span>
<span class="sd">         flux intensity for the given wavelength of Ne II recombination line</span>
<span class="sd">         by using the recombination coefficients from</span>
<span class="sd">         Kisielius et al. (1998) &amp; Storey (unpublished).</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the ionic abundanc.</span>

<span class="sd">     :Keywords:</span>
<span class="sd">         temperature   :     in, required, type=float</span>
<span class="sd">                             electron temperature</span>
<span class="sd">         density       :     in, required, type=float</span>
<span class="sd">                             electron density</span>
<span class="sd">         wavelength    :     in, required, type=float</span>
<span class="sd">                             Line Wavelength in Angstrom</span>
<span class="sd">         line_flux     :     in, required, type=float</span>
<span class="sd">                             line flux intensity</span>
<span class="sd">         ne_ii_rc_data  :    in, required, type=array/object</span>
<span class="sd">                             Ne II recombination coefficients</span>
<span class="sd">         h_i_aeff_data :     in, required, type=array/object</span>
<span class="sd">                             H I recombination coefficients</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; import atomneb</span>
<span class="sd">         &gt;&gt;&gt; import os</span>
<span class="sd">         &gt;&gt;&gt; base_dir = &#39;../externals/atomneb/&#39;</span>
<span class="sd">         &gt;&gt;&gt; data_rc_dir = os.path.join(&#39;atomic-data-rc&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_all_file= os.path.join(base_dir,data_rc_dir, &#39;rc_collection.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom_rc_sh95_file= os.path.join(base_dir,data_rc_dir, &#39;rc_SH95.fits&#39;)</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;h&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;ii&#39; # H I</span>
<span class="sd">         &gt;&gt;&gt; h_i_rc_data=atomneb.read_aeff_sh95(atom_rc_sh95_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; h_i_aeff_data=h_i_rc_data[&#39;aeff&#39;][0]</span>
<span class="sd">         &gt;&gt;&gt; atom=&#39;ne&#39;</span>
<span class="sd">         &gt;&gt;&gt; ion=&#39;iii&#39; # Ne II</span>
<span class="sd">         &gt;&gt;&gt; ne_ii_rc_data=atomneb.read_aeff_collection(atom_rc_all_file, atom, ion)</span>
<span class="sd">         &gt;&gt;&gt; temperature=np.float64(10000.0)</span>
<span class="sd">         &gt;&gt;&gt; density=np.float64(5000.0)</span>
<span class="sd">         &gt;&gt;&gt; ne_ii_3777_flux = 0.056</span>
<span class="sd">         &gt;&gt;&gt; wavelength=3777.14</span>
<span class="sd">         &gt;&gt;&gt; abund_ne_ii=pyequib.calc_abund_ne_ii_rl(temperature=temperature, density=density,</span>
<span class="sd">         &gt;&gt;&gt;                                 wavelength=wavelength, line_flux=ne_ii_3777_flux,</span>
<span class="sd">         &gt;&gt;&gt;                                 ne_ii_rc_data=ne_ii_rc_data, h_i_aeff_data=h_i_aeff_data)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;N(Ne^2+)/N(H+):&#39;, abund_ne_ii)</span>
<span class="sd">            N(Ne^2+)/N(H+):    0.00043376850</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Abundance Analysis, Recombination Lines</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on effective radiative recombination coefficients for Ne II lines</span>
<span class="sd">         from Kisielius et al. 1998A&amp;AS..133..257K &amp; Storey (unpublished).</span>

<span class="sd">         Adopted from MOCASSIN, Ercolano et al. 2005MNRAS.362.1038E.</span>

<span class="sd">         02/2003, Yong Zhang, scripts added to MOCASSIN.</span>

<span class="sd">         14/05/2013, A. Danehkar, Translated to IDL code.</span>

<span class="sd">         10/04/2017, A. Danehkar, Integration with AtomNeb.</span>

<span class="sd">         10/07/2019, A. Danehkar, Made a new function calc_emiss_ne_ii_rl()</span>
<span class="sd">                          for calculating line emissivities and separated it</span>
<span class="sd">                          from calc_abund_ne_ii_rl().</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># neiiRLstructure ={Wave:np.float64(0.0), Int:np.float64(0.0), Obs:np.float64(0.0), Abundance:np.float64(0.0)}</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temperature is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Density is not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ne_ii_rc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ne II recombination coefficients (ne_ii_rc_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">h_i_aeff_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;H I recombination coefficients (h_i_aeff_data) are not set&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wavelength is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">line_flux</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Line flux intensity (line_flux) is not given&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">density</span> <span class="o">&lt;=</span> <span class="mf">0.e0</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;temperature = &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="s1">&#39;, density = &#39;</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
      <span class="k">return</span> <span class="mi">0</span>
   
   <span class="n">emissivity_hbeta</span> <span class="o">=</span> <span class="n">calc_emiss_h_beta</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">h_i_aeff_data</span><span class="o">=</span><span class="n">h_i_aeff_data</span><span class="p">)</span>
   <span class="n">emissivity</span> <span class="o">=</span> <span class="n">calc_emiss_ne_ii_rl</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">wavelength</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ne_ii_rc_data</span><span class="o">=</span><span class="n">ne_ii_rc_data</span><span class="p">)</span>
   <span class="n">abund</span> <span class="o">=</span> <span class="p">(</span><span class="n">emissivity_hbeta</span> <span class="o">/</span> <span class="n">emissivity</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">line_flux</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">abund</span></div>

<div class="viewcode-block" id="redlaw"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.redlaw">[docs]</a><span class="k">def</span> <span class="nf">redlaw</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ext_law</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmlaw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function determines the reddening law function of the line at the given wavelength</span>
<span class="sd">         for the used extinction law.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double/array. This function returns the reddening law function value for the given wavelength.</span>

<span class="sd">     :Params:</span>
<span class="sd">         wavelength :  in, required, type=float/array</span>
<span class="sd">                       Wavelength in Angstrom</span>

<span class="sd">     :Keywords:</span>
<span class="sd">        ext_law  :  in, optional, type=string, default=&#39;GAL&#39;</span>
<span class="sd">                    the extinction law:</span>

<span class="sd">                    &#39;GAL&#39; for Howarth Galactic.</span>

<span class="sd">                    &#39;GAL2&#39; for Savage and Mathis.</span>

<span class="sd">                    &#39;CCM&#39; for CCM galactic.</span>

<span class="sd">                    &#39;JBK&#39; for Whitford, Seaton, Kaler.</span>

<span class="sd">                    &#39;FM&#39; for Fitxpatrick.</span>

<span class="sd">                    &#39;SMC&#39; for Prevot SMC.</span>

<span class="sd">                    &#39;LMC&#39; for Howarth LMC.</span>

<span class="sd">        rv       :  in, optional, type=float, default=3.1</span>
<span class="sd">                    the optical total-to-selective extinction ratio, RV = A(V)/E(B-V).</span>

<span class="sd">        fmlaw    :  in, optional, type=string, default=&#39;GAL&#39;</span>
<span class="sd">                    the fmlaw keyword is used only in the redlaw_fm function:</span>

<span class="sd">                    &#39;GAL&#39; for  the default fit parameters for the R-dependent</span>
<span class="sd">                               Galactic extinction curve from Fitzpatrick &amp; Massa</span>
<span class="sd">                               (Fitzpatrick, 1999, PASP, 111, 63).</span>

<span class="sd">                    &#39;LMC2&#39; for the fit parameters are those determined for</span>
<span class="sd">                                  reddening the LMC2 field (inc. 30 Dor)</span>
<span class="sd">                                  from Misselt et al.  (1999, ApJ, 515, 128).</span>

<span class="sd">                    &#39;AVGLMC&#39; for  the fit parameters are those determined for</span>
<span class="sd">                                  reddening in the general Large Magellanic Cloud (LMC)</span>
<span class="sd">                                  field by Misselt et al.  (1999, ApJ, 515, 128).</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">         &gt;&gt;&gt; r_v=3.1</span>
<span class="sd">         &gt;&gt;&gt; fl=pyequib.redlaw(wavelength, rv=r_v)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;fl(6563)&#39;, fl)</span>
<span class="sd">            fl(6563)     -0.32013816</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Interstellar Extinction</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Originally from IRAF STSDAS SYNPHOT redlaw.x, ebmvxfunc.x</span>

<span class="sd">         31/08/2012, A. Danehkar, Converted to IDL code.</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ext_law</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">extlaw</span> <span class="o">=</span> <span class="n">ext_law</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">extlaw</span> <span class="o">=</span> <span class="s1">&#39;GAL&#39;</span>
   <span class="n">_expr</span> <span class="o">=</span> <span class="n">extlaw</span>
   <span class="k">if</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;GAL&#39;</span><span class="p">:</span>
      <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw_gal</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="n">rv</span><span class="p">)</span>
   <span class="k">elif</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;GAL2&#39;</span><span class="p">:</span>
      <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw_gal2</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
   <span class="k">elif</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;CCM&#39;</span><span class="p">:</span>
      <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw_ccm</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="n">rv</span><span class="p">)</span>
   <span class="k">elif</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;JBK&#39;</span><span class="p">:</span>
      <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw_jbk</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
   <span class="k">elif</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;FM&#39;</span><span class="p">:</span>
      <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw_fm</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="n">rv</span><span class="p">,</span> <span class="n">fmlaw</span><span class="o">=</span><span class="n">fmlaw</span><span class="p">)</span>
   <span class="k">elif</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;SMC&#39;</span><span class="p">:</span>
      <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw_smc</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
   <span class="k">elif</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;LMC&#39;</span><span class="p">:</span>
      <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw_lmc</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ext_law cannnot find&quot;</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">fl</span></div>

<div class="viewcode-block" id="redlaw_gal"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.redlaw_gal">[docs]</a><span class="k">def</span> <span class="nf">redlaw_gal</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       This function determines the reddening law function of the line at the given wavelength</span>
<span class="sd">       for Galactic Seaton1979+Howarth1983+CCM1983.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double/array. This function returns the reddening law function value(s) for the given wavelength(s).</span>

<span class="sd">    :Params:</span>
<span class="sd">       wavelength :  in, required, type=float</span>
<span class="sd">                      Wavelength in Angstrom</span>

<span class="sd">    :Keywords:</span>
<span class="sd">       rv       :  in, optional, type=float, default=3.1</span>
<span class="sd">                   the optical total-to-selective extinction ratio, RV = A(V)/E(B-V).</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">        &gt;&gt;&gt; r_v=3.1</span>
<span class="sd">        &gt;&gt;&gt; fl=pyequib.redlaw_gal(wavelength, rv=r_v)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;fl(6563)&#39;, fl)</span>
<span class="sd">           fl(6563)     -0.32013816</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Interstellar Extinction</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Subroutines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on the UV Formulae from Seaton 1979, MNRAS, 187, 73</span>
<span class="sd">        1979MNRAS.187P..73S, the opt/NIR from Howarth 1983, MNRAS, 203, 301</span>
<span class="sd">        the FIR from Cardelli, Clayton and Mathis 1989, ApJ, 345, 245</span>
<span class="sd">        1989ApJ...345..245C</span>

<span class="sd">        Originally from IRAF STSDAS SYNPHOT ebmvxfunc.x, pyneb.extinction</span>

<span class="sd">        31/08/2012, A. Danehkar, Converted to IDL code.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Tabulated inverse wavelengths in microns:</span>
   <span class="n">xtable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span>
                      <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">])</span>
   <span class="n">etable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.36</span><span class="p">,</span> <span class="mf">1.64</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">2.04</span><span class="p">,</span> <span class="mf">2.24</span><span class="p">,</span> <span class="mf">2.44</span><span class="p">,</span> <span class="mf">2.66</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span>
                      <span class="mf">3.36</span><span class="p">,</span> <span class="mf">3.56</span><span class="p">,</span> <span class="mf">3.77</span><span class="p">,</span> <span class="mf">3.96</span><span class="p">,</span> <span class="mf">4.15</span><span class="p">,</span> <span class="mf">4.26</span><span class="p">,</span> <span class="mf">4.40</span><span class="p">,</span> <span class="mf">4.52</span><span class="p">,</span> <span class="mf">4.64</span><span class="p">])</span>

   <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
      <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
      <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">npts</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="n">rv</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="mf">3.1</span>
   <span class="k">for</span> <span class="n">pix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">):</span>
   <span class="c1"># Convert wavelength in angstroms to 1/microns</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
          <span class="n">wavel</span> <span class="o">=</span> <span class="n">wavelength</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">wavel</span> <span class="o">=</span> <span class="n">wavelength</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mf">10000.e+0</span> <span class="o">/</span> <span class="n">wavel</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">1.1</span><span class="p">):</span>   
         <span class="c1"># Infrared: extend optical results linearly to 0 at 1/lam = 0</span>
         <span class="c1"># extl[pix] = etable[2] * x^2</span>
         <span class="c1"># Cardelli, Clayton and Mathis 1989, ApJ, 345, 245</span>
         <span class="n">val</span> <span class="o">=</span> <span class="n">r_v</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.574</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mf">1.61</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.527</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mf">1.61</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.83</span><span class="p">):</span>   
            <span class="c1"># Howarth 1983, Galactic</span>
            <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_v</span> <span class="o">-</span> <span class="mf">3.1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(((</span><span class="mf">1.86</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.48</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)))</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">2.75</span><span class="p">):</span>   
               <span class="c1"># Optical region interpolates in Seaton&#39;s table 3</span>
               <span class="c1">#extl[pix] = lin_interp(etable, xtable,  x)</span>
               <span class="c1"># Howarth 1983, MNRAS, 203, 301</span>
               <span class="n">val</span> <span class="o">=</span> <span class="n">r_v</span> <span class="o">+</span> <span class="mf">2.56</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.83</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.993</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.83</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="c1">#</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">3.65</span><span class="p">):</span>   
                  <span class="c1"># Ultraviolet uses analytic formulae from Seaton&#39;s table 2</span>
                  <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_v</span> <span class="o">-</span> <span class="mf">3.2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.56</span> <span class="o">+</span> <span class="mf">1.048</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.01</span> <span class="o">/</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mf">4.6</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.280</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">7.14</span><span class="p">):</span>   
                     <span class="c1"># More ultraviolet</span>
                     <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_v</span> <span class="o">-</span> <span class="mf">3.2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.29</span> <span class="o">+</span> <span class="mf">0.848</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.01</span> <span class="o">/</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mf">4.6</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.280</span><span class="p">)</span>
                     <span class="c1"># And more ultraviolet still</span>
                  <span class="k">else</span><span class="p">:</span>   
                     <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">])</span>
                     <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_v</span> <span class="o">-</span> <span class="mf">3.2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">16.17</span> <span class="o">-</span> <span class="mf">3.20</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.2975</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">extl</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">extl</span><span class="o">=</span><span class="n">val</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">extl</span> <span class="o">/</span> <span class="mf">3.63</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="redlaw_gal2"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.redlaw_gal2">[docs]</a><span class="k">def</span> <span class="nf">redlaw_gal2</span><span class="p">(</span><span class="n">wavelength</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       This function determines the reddening law function of the line at the given wavelength</span>
<span class="sd">       for Galactic Savage &amp; Mathis 1979.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double/array. This function returns the reddening law function value(s) for the given wavelength(s).</span>

<span class="sd">    :Params:</span>
<span class="sd">        wavelength :  in, required, type=float</span>
<span class="sd">                      Wavelength in Angstrom</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">        &gt;&gt;&gt; fl=pyequib.redlaw_gal2(wavelength)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;fl(6563)&#39;, fl)</span>
<span class="sd">           fl(6563)     -0.30925984</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Interstellar Extinction</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">        Subroutines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on Savage &amp; Mathis 1979, ARA&amp;A, vol. 17, 73-111</span>

<span class="sd">        Originally from IRAF STSDAS SYNPHOT ebmvxfunc.x</span>

<span class="sd">        20/09/1994, R. A. Shaw, Initial IRAF implementation.</span>

<span class="sd">        04/03/1995, R. A. Shaw, Return A(lambda)/A(V) instead.</span>

<span class="sd">        31/08/2012, A. Danehkar, Converted to IDL code.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Tabulated inverse wavelengths in microns:</span>
   <span class="n">xtable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">,</span> <span class="mf">1.43</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">2.27</span><span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">2.91</span><span class="p">,</span> <span class="mf">3.65</span><span class="p">,</span>
                      <span class="mf">4.00</span><span class="p">,</span> <span class="mf">4.17</span><span class="p">,</span> <span class="mf">4.35</span><span class="p">,</span> <span class="mf">4.57</span><span class="p">,</span> <span class="mf">4.76</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">,</span> <span class="mf">5.26</span><span class="p">,</span> <span class="mf">5.56</span><span class="p">,</span> <span class="mf">5.88</span><span class="p">,</span> <span class="mf">6.25</span><span class="p">,</span> <span class="mf">6.71</span><span class="p">,</span>
                      <span class="mf">7.18</span><span class="p">,</span> <span class="mf">8.00</span><span class="p">,</span> <span class="mf">8.50</span><span class="p">,</span> <span class="mf">9.00</span><span class="p">,</span> <span class="mf">9.50</span><span class="p">,</span> <span class="mf">10.00</span><span class="p">])</span>
   
   <span class="c1">#  Tabulated extinction function, A(lambda)/E(B-V):</span>
   <span class="n">etable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">,</span> <span class="mf">2.32</span><span class="p">,</span> <span class="mf">3.10</span><span class="p">,</span> <span class="mf">4.10</span><span class="p">,</span> <span class="mf">4.40</span><span class="p">,</span> <span class="mf">4.90</span><span class="p">,</span> <span class="mf">6.20</span><span class="p">,</span>
                      <span class="mf">7.29</span><span class="p">,</span> <span class="mf">8.00</span><span class="p">,</span> <span class="mf">8.87</span><span class="p">,</span> <span class="mf">9.67</span><span class="p">,</span> <span class="mf">9.33</span><span class="p">,</span> <span class="mf">8.62</span><span class="p">,</span> <span class="mf">8.00</span><span class="p">,</span> <span class="mf">7.75</span><span class="p">,</span> <span class="mf">7.87</span><span class="p">,</span> <span class="mf">8.12</span><span class="p">,</span> <span class="mf">8.15</span><span class="p">,</span>
                      <span class="mf">8.49</span><span class="p">,</span> <span class="mf">9.65</span><span class="p">,</span> <span class="mf">10.55</span><span class="p">,</span> <span class="mf">11.55</span><span class="p">,</span> <span class="mf">12.90</span><span class="p">,</span> <span class="mf">14.40</span><span class="p">])</span>

   <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="mi">1</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">pix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">wavel</span> <span class="o">&lt;</span> <span class="mf">1000.0</span><span class="p">):</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;redlaw_smc: Invalid wavelength&quot;</span><span class="p">)</span>
      <span class="c1"># Convert wavelength in angstroms to 1/microns</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mf">10000.e+0</span> <span class="o">/</span> <span class="n">wavel</span>
      <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
      
      <span class="c1"># Linearly interpolate extinction law in 1/lam</span>
      <span class="n">val</span> <span class="o">=</span> <span class="n">lin_interp</span><span class="p">(</span><span class="n">etable</span><span class="p">,</span> <span class="n">xtable</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
      <span class="c1">#deriv1 = spl_init(xtab, extab)</span>
      <span class="c1">#val=spl_interp(xtab, extab, deriv1, x)</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">extl</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">extl</span><span class="o">=</span><span class="n">val</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">extl</span> <span class="o">/</span> <span class="mf">3.63</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="redlaw_ccm"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.redlaw_ccm">[docs]</a><span class="k">def</span> <span class="nf">redlaw_ccm</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines the reddening law function of Cardelli, Clayton &amp; Mathis.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double/array. This function returns the reddening law function value for the given wavelength.</span>

<span class="sd">     :Params:</span>
<span class="sd">         wavelength :  in, required, type=float/array</span>
<span class="sd">                       Wavelength in Angstrom</span>

<span class="sd">     :Keywords:</span>
<span class="sd">        RV       :  in, optional, type=float, default=3.1</span>
<span class="sd">                    the optical total-to-selective extinction ratio, RV = A(V)/E(B-V).</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">         &gt;&gt;&gt; r_v=3.1</span>
<span class="sd">         &gt;&gt;&gt; fl=pyequib..redlaw_ccm(wavelength, rv=r_v)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;fl(6563)&#39;, fl)</span>
<span class="sd">            fl(6563)     -0.29756615</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Interstellar Extinction</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Subroutines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on Formulae by Cardelli, Clayton &amp; Mathis 1989, ApJ 345, 245-256.</span>
<span class="sd">         1989ApJ...345..245C</span>

<span class="sd">         Originally from IRAF STSDAS SYNPHOT redlaw.x</span>

<span class="sd">         18/05/1993, R. A. Shaw, Initial IRAF implementation, based upon CCM module</span>
<span class="sd">             in onedspec.deredden.</span>

<span class="sd">         31/08/2012, A. Danehkar, Converted to IDL code.</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="mi">1</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="n">rv</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="mf">3.1</span>
   <span class="k">for</span> <span class="n">pix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">wavel</span> <span class="o">&lt;</span> <span class="mf">1000.0</span><span class="p">):</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;redlaw_ccm: Invalid wavelength&#39;</span><span class="p">)</span>
      
      <span class="c1"># Convert input wavelength to inverse microns</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mf">10000.e+0</span> <span class="o">/</span> <span class="n">wavel</span>
      
      <span class="c1"># For wavelengths longward of the L passband, linearly interpolate</span>
      <span class="c1"># to 0. at 1/lambda = 0.  (a=0.08, b=-0.0734 @ x=0.29)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.29e+0</span><span class="p">):</span>   
         <span class="n">a</span> <span class="o">=</span> <span class="mf">0.2759</span> <span class="o">*</span> <span class="n">x</span>
         <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2531</span> <span class="o">*</span> <span class="n">x</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.1e+0</span><span class="p">):</span>   
            <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="mf">1.61</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mf">0.574</span> <span class="o">*</span> <span class="n">y</span>
            <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.527</span> <span class="o">*</span> <span class="n">y</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">3.3e+0</span><span class="p">):</span>   
               <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.82</span>
               <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.17699</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.50447</span> <span class="o">+</span>
                            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.02427</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.72085</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.01979</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.77530</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="mf">0.32999</span><span class="p">))))))</span>
               <span class="n">b</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.41338</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.28305</span> <span class="o">+</span>
                            <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.07233</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">5.38434</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.62251</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5.30260</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="mf">2.09002</span><span class="p">))))))</span>
            <span class="k">else</span><span class="p">:</span>   
               <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">5.9e+0</span><span class="p">):</span>   
                  <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">4.67</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                  <span class="n">a</span> <span class="o">=</span> <span class="mf">1.752</span> <span class="o">-</span> <span class="mf">0.316</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.104</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.341</span><span class="p">)</span>
                  <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.090</span> <span class="o">+</span> <span class="mf">1.825</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.206</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.263</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>   
                  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">8.0e+0</span><span class="p">):</span>   
                     <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">4.67</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                     <span class="n">a</span> <span class="o">=</span> <span class="mf">1.752</span> <span class="o">-</span> <span class="mf">0.316</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.104</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.341</span><span class="p">)</span>
                     <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.090</span> <span class="o">+</span> <span class="mf">1.825</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.206</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.263</span><span class="p">)</span>
                     
                     <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">5.9</span>
                     <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="mf">0.04473</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.009779</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">3</span>
                     <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mf">0.2130</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.1207</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">3</span>
                     <span class="c1"># Truncate range of ISEF to that for 1000 Ang.</span>
                  <span class="k">else</span><span class="p">:</span>   
                     <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">10.0e+0</span><span class="p">):</span>   
                        <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mf">10.0e+0</span><span class="p">])</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">8.e+0</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.072</span> <span class="o">-</span> <span class="mf">0.628</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="mf">0.137</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.070</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">3</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="mf">13.670</span> <span class="o">+</span> <span class="mf">4.257</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="mf">0.420</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.374</span> <span class="o">*</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">3</span>
      <span class="c1"># Compute A(lambda)/A(V)</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">r_v</span> <span class="o">+</span> <span class="n">b</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">extl</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">extl</span><span class="o">=</span> <span class="n">y</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">extl</span> <span class="o">/</span> <span class="p">((</span><span class="mf">1.015452</span> <span class="o">*</span> <span class="n">r_v</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.461000</span><span class="p">))</span> <span class="o">-</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="redlaw_jbk"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.redlaw_jbk">[docs]</a><span class="k">def</span> <span class="nf">redlaw_jbk</span><span class="p">(</span><span class="n">wavelength</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       This function determines the reddening law function for Galactic Whitford1958 + Seaton1977 + Kaler1976.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double/array. This function returns the reddening law function value(s) for the given wavelength(s).</span>

<span class="sd">    :Params:</span>
<span class="sd">        wavelength :  in, required, type=float</span>
<span class="sd">                      Wavelength in Angstrom</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">        &gt;&gt;&gt; fl=pyequib.redlaw_jbk(wavelength)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;fl(6563)&#39;, fl)</span>
<span class="sd">           fl(6563)     -0.33113684</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Interstellar Extinction</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Subroutines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on Whitford (1958), extended to the UV by Seaton (1977),</span>
<span class="sd">        adapted by Kaler (1976).</span>

<span class="sd">        Originally from IRAF STSDAS SYNPHOT redlaw.x</span>

<span class="sd">        13/05/1993, R. A. Shaw, Initial IRAF implementation.</span>

<span class="sd">        31/08/2012, A. Danehkar, Converted to IDL code.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Tabulated wavelengths, Angstroms:</span>
   <span class="n">refw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1150.</span><span class="p">,</span> <span class="mf">1200.</span><span class="p">,</span> <span class="mf">1250.</span><span class="p">,</span> <span class="mf">1300.</span><span class="p">,</span> <span class="mf">1350.</span><span class="p">,</span> <span class="mf">1400.</span><span class="p">,</span> <span class="mf">1450.</span><span class="p">,</span> <span class="mf">1500.</span><span class="p">,</span> <span class="mf">1550.</span><span class="p">,</span>
                    <span class="mf">1600.</span><span class="p">,</span> <span class="mf">1650.</span><span class="p">,</span> <span class="mf">1700.</span><span class="p">,</span> <span class="mf">1750.</span><span class="p">,</span> <span class="mf">1800.</span><span class="p">,</span> <span class="mf">1850.</span><span class="p">,</span> <span class="mf">1900.</span><span class="p">,</span> <span class="mf">1950.</span><span class="p">,</span> <span class="mf">2000.</span><span class="p">,</span>
                    <span class="mf">2050.</span><span class="p">,</span> <span class="mf">2100.</span><span class="p">,</span> <span class="mf">2150.</span><span class="p">,</span> <span class="mf">2200.</span><span class="p">,</span> <span class="mf">2250.</span><span class="p">,</span> <span class="mf">2300.</span><span class="p">,</span> <span class="mf">2350.</span><span class="p">,</span> <span class="mf">2400.</span><span class="p">,</span> <span class="mf">2450.</span><span class="p">,</span>
                    <span class="mf">2500.</span><span class="p">,</span> <span class="mf">2550.</span><span class="p">,</span> <span class="mf">2600.</span><span class="p">,</span> <span class="mf">2650.</span><span class="p">,</span> <span class="mf">2700.</span><span class="p">,</span> <span class="mf">2750.</span><span class="p">,</span> <span class="mf">2800.</span><span class="p">,</span> <span class="mf">2850.</span><span class="p">,</span> <span class="mf">2900.</span><span class="p">,</span>
                    <span class="mf">2950.</span><span class="p">,</span> <span class="mf">3000.</span><span class="p">,</span> <span class="mf">3050.</span><span class="p">,</span> <span class="mf">3100.</span><span class="p">,</span> <span class="mf">3333.</span><span class="p">,</span> <span class="mf">3500.</span><span class="p">,</span> <span class="mf">3600.</span><span class="p">,</span> <span class="mf">3700.</span><span class="p">,</span> <span class="mf">3800.</span><span class="p">,</span>
                    <span class="mf">3900.</span><span class="p">,</span> <span class="mf">4000.</span><span class="p">,</span> <span class="mf">4100.</span><span class="p">,</span> <span class="mf">4200.</span><span class="p">,</span> <span class="mf">4300.</span><span class="p">,</span> <span class="mf">4400.</span><span class="p">,</span> <span class="mf">4500.</span><span class="p">,</span> <span class="mf">4600.</span><span class="p">,</span> <span class="mf">4700.</span><span class="p">,</span>
                    <span class="mf">4800.</span><span class="p">,</span> <span class="mf">4861.3</span><span class="p">,</span> <span class="mf">5000.</span><span class="p">,</span> <span class="mf">5100.</span><span class="p">,</span> <span class="mf">5200.</span><span class="p">,</span> <span class="mf">5300.</span><span class="p">,</span> <span class="mf">5400.</span><span class="p">,</span> <span class="mf">5500.</span><span class="p">,</span> <span class="mf">5600.</span><span class="p">,</span>
                    <span class="mf">5700.</span><span class="p">,</span> <span class="mf">5800.</span><span class="p">,</span> <span class="mf">5900.</span><span class="p">,</span> <span class="mf">6000.</span><span class="p">,</span> <span class="mf">6100.</span><span class="p">,</span> <span class="mf">6200.</span><span class="p">,</span> <span class="mf">6300.</span><span class="p">,</span> <span class="mf">6400.</span><span class="p">,</span> <span class="mf">6500.</span><span class="p">,</span>
                    <span class="mf">6600.</span><span class="p">,</span> <span class="mf">6700.</span><span class="p">,</span> <span class="mf">6800.</span><span class="p">,</span> <span class="mf">6900.</span><span class="p">,</span> <span class="mf">7000.</span><span class="p">,</span> <span class="mf">7200.</span><span class="p">,</span> <span class="mf">7400.</span><span class="p">,</span> <span class="mf">7600.</span><span class="p">,</span> <span class="mf">7800.</span><span class="p">,</span>
                    <span class="mf">8000.</span><span class="p">,</span> <span class="mf">8200.</span><span class="p">,</span> <span class="mf">8400.</span><span class="p">,</span> <span class="mf">8600.</span><span class="p">,</span> <span class="mf">8800.</span><span class="p">,</span> <span class="mf">9000.</span><span class="p">,</span> <span class="mf">9500.</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">,</span> <span class="mf">11000.</span><span class="p">,</span>
                    <span class="mf">12000.</span><span class="p">,</span> <span class="mf">14000.</span><span class="p">,</span> <span class="mf">16000.</span><span class="p">,</span> <span class="mf">20000.</span><span class="p">,</span> <span class="mf">1.e+6</span><span class="p">])</span>
   
   <span class="c1">#  Tabulated extinction function:</span>
   <span class="n">extab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.96</span><span class="p">,</span> <span class="mf">1.78</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">1.49</span><span class="p">,</span> <span class="mf">1.37</span><span class="p">,</span> <span class="mf">1.29</span><span class="p">,</span> <span class="mf">1.24</span><span class="p">,</span> <span class="mf">1.20</span><span class="p">,</span> <span class="mf">1.20</span><span class="p">,</span> <span class="mf">1.20</span><span class="p">,</span> <span class="mf">1.17</span><span class="p">,</span>
                     <span class="mf">1.13</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">,</span> <span class="mf">1.10</span><span class="p">,</span> <span class="mf">1.12</span><span class="p">,</span> <span class="mf">1.17</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mf">1.53</span><span class="p">,</span> <span class="mf">1.60</span><span class="p">,</span> <span class="mf">1.62</span><span class="p">,</span>
                     <span class="mf">1.52</span><span class="p">,</span> <span class="mf">1.40</span><span class="p">,</span> <span class="mf">1.28</span><span class="p">,</span> <span class="mf">1.17</span><span class="p">,</span> <span class="mf">1.06</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">,</span> <span class="mf">0.77</span><span class="p">,</span> <span class="mf">0.72</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">,</span>
                     <span class="mf">0.64</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.385</span><span class="p">,</span> <span class="mf">0.358</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span>
                     <span class="mf">0.306</span><span class="p">,</span> <span class="mf">0.278</span><span class="p">,</span> <span class="mf">0.248</span><span class="p">,</span> <span class="mf">0.220</span><span class="p">,</span> <span class="mf">0.195</span><span class="p">,</span> <span class="mf">0.168</span><span class="p">,</span> <span class="mf">0.143</span><span class="p">,</span> <span class="mf">0.118</span><span class="p">,</span> <span class="mf">0.095</span><span class="p">,</span>
                     <span class="mf">0.065</span><span class="p">,</span> <span class="mf">0.040</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.030</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.055</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.078</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.10</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.121</span><span class="p">,</span>
                     <span class="o">-</span><span class="mf">0.142</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.164</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.182</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.201</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.220</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.238</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.254</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.273</span><span class="p">,</span>
                     <span class="o">-</span><span class="mf">0.291</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.306</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.321</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.337</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.351</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.365</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.377</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.391</span><span class="p">,</span>
                     <span class="o">-</span><span class="mf">0.416</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.441</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.465</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.490</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.510</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.529</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.548</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.566</span><span class="p">,</span>
                     <span class="o">-</span><span class="mf">0.582</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.633</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.663</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.718</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.763</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.840</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.890</span><span class="p">,</span>
                     <span class="o">-</span><span class="mf">0.960</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.000</span><span class="p">])</span>
   
   <span class="n">xtable</span> <span class="o">=</span> <span class="mf">10000.e+0</span> <span class="o">/</span> <span class="n">refw</span>
   <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="mi">1</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">pix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">wavel</span> <span class="o">&lt;</span> <span class="mf">1000.0</span><span class="p">):</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;redlaw_smc: Invalid wavelength&quot;</span><span class="p">)</span>
      <span class="c1"># Convert wavelength in angstroms to 1/microns</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mf">10000.e+0</span> <span class="o">/</span> <span class="n">wavel</span>
      <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
      
      <span class="c1"># Linearly interpolate extinction law in 1/lam</span>
      <span class="n">val</span> <span class="o">=</span> <span class="n">lin_interp</span><span class="p">(</span><span class="n">extab</span><span class="p">,</span> <span class="n">xtable</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
      <span class="c1">#deriv1 = spl_init(xtab, extab)</span>
      <span class="c1">#val=spl_interp(xtab, extab, deriv1, x)</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">extl</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">extl</span><span class="o">=</span><span class="n">val</span>
   <span class="k">return</span> <span class="n">extl</span></div>

<div class="viewcode-block" id="redlaw_fm"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.redlaw_fm">[docs]</a><span class="k">def</span> <span class="nf">redlaw_fm</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmlaw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function determines the reddening law function by Fitzpatrick &amp; Massa</span>
<span class="sd">        for the line at the given wavelength.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double/array. This function returns the reddening law function value for the given wavelength.</span>

<span class="sd">     :Params:</span>
<span class="sd">         wavelength :  in, required, type=float/array</span>
<span class="sd">                       Wavelength in Angstrom</span>

<span class="sd">     :Keywords:</span>
<span class="sd">        RV       :  in, optional, type=float, default=3.1</span>
<span class="sd">                    the optical total-to-selective extinction ratio, RV = A(V)/E(B-V).</span>

<span class="sd">        fmlaw    :  in, optional, type=string, default=&#39;GAL&#39;</span>
<span class="sd">                    the fmlaw keyword is used only in the redlaw_fm function:</span>

<span class="sd">                    &#39;GAL&#39; for  the default fit parameters for the R-dependent</span>
<span class="sd">                               Galactic extinction curve from Fitzpatrick &amp; Massa</span>
<span class="sd">                               (Fitzpatrick, 1999, PASP, 111, 63).</span>

<span class="sd">                    &#39;LMC2&#39; for the fit parameters are those determined for</span>
<span class="sd">                                  reddening the LMC2 field (inc. 30 Dor)</span>
<span class="sd">                                  from Misselt et al.  (1999, ApJ, 515, 128).</span>

<span class="sd">                    &#39;AVGLMC&#39; for  the fit parameters are those determined for</span>
<span class="sd">                                  reddening in the general Large Magellanic Cloud (LMC)</span>
<span class="sd">                                  field by Misselt et al.  (1999, ApJ, 515, 128).</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">         &gt;&gt;&gt; r_v=3.1</span>
<span class="sd">         &gt;&gt;&gt; fl=pyequib.redlaw_fm(wavelength, rv=r_v)</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;fl(6563)&#39;, fl)</span>
<span class="sd">            fl(6563)     -0.35054942</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Interstellar Extinction</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Subroutines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         Based on Formulae by Fitzpatrick 1999, PASP, 11, 63</span>
<span class="sd">         1999PASP..111...63F, Fitzpatrick &amp; Massa 1990,</span>
<span class="sd">         ApJS, 72, 163, 1990ApJS...72..163F</span>

<span class="sd">         Adopted from NASA IDL Library &amp; PyAstronomy.</span>

<span class="sd">         30/12/2016, A. Danehkar, Revised in IDL code.</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Tabulated inverse wavelengths in microns:</span>
   <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="mi">1</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="n">rv</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="mf">3.1</span>
   <span class="n">x0</span> <span class="o">=</span> <span class="mf">4.596</span>
   <span class="n">gamma1</span> <span class="o">=</span> <span class="mf">0.99</span>
   <span class="n">c3</span> <span class="o">=</span> <span class="mf">3.23</span>
   <span class="n">c4</span> <span class="o">=</span> <span class="mf">0.41</span>
   <span class="n">c2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.824</span> <span class="o">+</span> <span class="mf">4.717</span> <span class="o">/</span> <span class="n">r_v</span>
   <span class="n">c1</span> <span class="o">=</span> <span class="mf">2.030</span> <span class="o">-</span> <span class="mf">3.007</span> <span class="o">*</span> <span class="n">c2</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">fmlaw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="k">if</span> <span class="n">fmlaw</span> <span class="o">==</span> <span class="s1">&#39;LMC2&#39;</span><span class="p">:</span>   
         <span class="n">x0</span> <span class="o">=</span> <span class="mf">4.626</span>
         <span class="n">gamma1</span> <span class="o">=</span> <span class="mf">1.05</span>
         <span class="n">c4</span> <span class="o">=</span> <span class="mf">0.42</span>
         <span class="n">c3</span> <span class="o">=</span> <span class="mf">1.92</span>
         <span class="n">c2</span> <span class="o">=</span> <span class="mf">1.31</span>
         <span class="n">c1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.16</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="k">if</span> <span class="n">fmlaw</span> <span class="o">==</span> <span class="s1">&#39;AVGLMC&#39;</span><span class="p">:</span>   
            <span class="n">x0</span> <span class="o">=</span> <span class="mf">4.596</span>
            <span class="n">gamma1</span> <span class="o">=</span> <span class="mf">0.91</span>
            <span class="n">c4</span> <span class="o">=</span> <span class="mf">0.64</span>
            <span class="n">c3</span> <span class="o">=</span> <span class="mf">2.73</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="mf">1.11</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.28</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="n">x0</span> <span class="o">=</span> <span class="mf">4.596</span>
            <span class="n">gamma1</span> <span class="o">=</span> <span class="mf">0.99</span>
            <span class="n">c3</span> <span class="o">=</span> <span class="mf">3.23</span>
            <span class="n">c4</span> <span class="o">=</span> <span class="mf">0.41</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.824</span> <span class="o">+</span> <span class="mf">4.717</span> <span class="o">/</span> <span class="n">r_v</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="mf">2.030</span> <span class="o">-</span> <span class="mf">3.007</span> <span class="o">*</span> <span class="n">c2</span>
   <span class="k">for</span> <span class="n">pix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">):</span>
   <span class="c1"># Convert input wavelength to inverse microns</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mf">10000.e+0</span> <span class="o">/</span> <span class="n">wavel</span>
      <span class="n">curve</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">0.</span>
      
      <span class="c1"># Compute UV portion of A(lambda)/E(B-V) curve using FM fitting function and</span>
      <span class="c1"># R-dependent coefficients</span>
      <span class="n">xcutuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10000.0</span><span class="o">/</span><span class="mf">2700.0</span><span class="p">])</span>
      <span class="n">xspluv</span> <span class="o">=</span> <span class="mf">10000.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2700.0</span><span class="p">,</span><span class="mf">2600.0</span><span class="p">])</span>
      
      <span class="n">iuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xcutuv</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">n_uv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iuv</span><span class="p">)</span>
      <span class="n">iopir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xcutuv</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">nopir</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iopir</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">n_uv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>   
         <span class="n">xuv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xspluv</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">iuv</span><span class="p">]))</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="n">xuv</span> <span class="o">=</span> <span class="n">xspluv</span>
      
      <span class="n">yuv</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">xuv</span>
      <span class="n">yuv</span> <span class="o">=</span> <span class="n">yuv</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span> <span class="n">xuv</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">((</span><span class="n">xuv</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">x0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                                   <span class="o">+</span> <span class="p">(</span><span class="n">xuv</span> <span class="o">*</span> <span class="n">gamma1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
      <span class="n">yuv</span> <span class="o">=</span> <span class="n">yuv</span> <span class="o">+</span> <span class="n">c4</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5392</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">xuv</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">))</span> <span class="o">-</span> <span class="mf">5.9</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                        <span class="o">+</span> <span class="mf">0.05644</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">xuv</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">))</span> <span class="o">-</span> <span class="mf">5.9</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
      <span class="n">yuv</span> <span class="o">=</span> <span class="n">yuv</span> <span class="o">+</span> <span class="n">r_v</span>
      <span class="n">yspluv</span> <span class="o">=</span> <span class="n">yuv</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>                  <span class="c1"># save spline points</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">n_uv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>   
         <span class="n">curve</span><span class="p">[</span><span class="n">iuv</span><span class="p">]</span> <span class="o">=</span> <span class="n">yuv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>      <span class="c1"># remove spline points</span>
      
      <span class="c1"># Compute optical portion of A(lambda)/E(B-V) curve</span>
      <span class="c1"># using cubic spline anchored in UV, optical, and IR</span>
      <span class="n">xsplopir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span><span class="mf">10000.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">26500.0</span><span class="p">,</span><span class="mf">12200.0</span><span class="p">,</span><span class="mf">6000.0</span><span class="p">,</span><span class="mf">5470.0</span><span class="p">,</span><span class="mf">4670.0</span><span class="p">,</span><span class="mf">4110.0</span><span class="p">])))</span>
      <span class="n">ysplir</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.26469</span><span class="p">,</span><span class="mf">0.82925</span><span class="p">])</span><span class="o">*</span><span class="n">r_v</span><span class="o">/</span><span class="mf">3.1</span> 
      <span class="n">ysplop</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="o">-</span><span class="mf">4.22809e-01</span><span class="p">,</span> <span class="mf">1.00270</span><span class="p">,</span> <span class="mf">2.13572e-04</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">r_v</span><span class="p">),</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="o">-</span><span class="mf">5.13540e-02</span><span class="p">,</span> <span class="mf">1.00216</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.35778e-05</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">r_v</span><span class="p">),</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span> <span class="mf">7.00127e-01</span><span class="p">,</span> <span class="mf">1.00184</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.32598e-05</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">r_v</span><span class="p">),</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span> <span class="mf">1.19456</span><span class="p">,</span> <span class="mf">1.01707</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.46959e-03</span><span class="p">,</span> <span class="mf">7.97809e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.45636e-05</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">r_v</span><span class="p">)</span> <span class="p">))</span>
      
      <span class="n">ysplopir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ysplir</span><span class="p">,</span> <span class="n">ysplop</span><span class="p">))</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">nopir</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>   
         <span class="n">tck</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xsplopir</span><span class="p">,</span><span class="n">xspluv</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ysplopir</span><span class="p">,</span><span class="n">yspluv</span><span class="p">)),</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
            <span class="n">curve</span><span class="p">[</span><span class="n">iopir</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iopir</span><span class="p">],</span> <span class="n">tck</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tck</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">extl</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">extl</span><span class="o">=</span><span class="n">curve</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">extl</span> <span class="o">/</span> <span class="mf">3.63</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="redlaw_smc"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.redlaw_smc">[docs]</a><span class="k">def</span> <span class="nf">redlaw_smc</span><span class="p">(</span><span class="n">wavelength</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       This function determines the reddening law function of the line at the given wavelength</span>
<span class="sd">       for Small Magellanic Cloud.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double/array. This function returns the reddening law function value(s) for the given wavelength(s).</span>

<span class="sd">    :Params:</span>
<span class="sd">        wavelength :  in, required, type=float</span>
<span class="sd">                      Wavelength in Angstrom</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">        &gt;&gt;&gt; fl=pyequib.redlaw_smc(wavelength)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;fl(6563)&#39;, fl)</span>
<span class="sd">           fl(6563)     -0.22659261</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Interstellar Extinction</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Subroutines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on Prevot et al. (1984), A&amp;A, 132, 389-392</span>
<span class="sd">        1984A%26A...132..389P</span>

<span class="sd">        Originally from IRAF STSDAS SYNPHOT redlaw.x, ebmvxfunc.x</span>

<span class="sd">        20/09/1994, R. A. Shaw, Initial IRAF implementation.</span>

<span class="sd">        04/03/1995, R. A. Shaw, Return A(lambda)/A(V) instead.</span>

<span class="sd">        31/08/2012, A. Danehkar, Converted to IDL code.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Tabulated inverse wavelengths in microns:</span>
   <span class="n">xtab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">,</span> <span class="mf">1.43</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">2.35</span><span class="p">,</span> <span class="mf">2.70</span><span class="p">,</span> <span class="mf">3.22</span><span class="p">,</span> <span class="mf">3.34</span><span class="p">,</span>
                    <span class="mf">3.46</span><span class="p">,</span> <span class="mf">3.60</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">,</span> <span class="mf">3.92</span><span class="p">,</span> <span class="mf">4.09</span><span class="p">,</span> <span class="mf">4.28</span><span class="p">,</span> <span class="mf">4.50</span><span class="p">,</span> <span class="mf">4.73</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">,</span> <span class="mf">5.24</span><span class="p">,</span> <span class="mf">5.38</span><span class="p">,</span>
                    <span class="mf">5.52</span><span class="p">,</span> <span class="mf">5.70</span><span class="p">,</span> <span class="mf">5.88</span><span class="p">,</span> <span class="mf">6.07</span><span class="p">,</span> <span class="mf">6.27</span><span class="p">,</span> <span class="mf">6.48</span><span class="p">,</span> <span class="mf">6.72</span><span class="p">,</span> <span class="mf">6.98</span><span class="p">,</span> <span class="mf">7.23</span><span class="p">,</span> <span class="mf">7.52</span><span class="p">,</span> <span class="mf">7.84</span><span class="p">])</span>
   
   <span class="c1"># Tabulated extinction function, E(lambda-V)/E(B-V):</span>
   <span class="n">extab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">3.10</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.94</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.72</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.23</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.60</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">1.67</span><span class="p">,</span> <span class="mf">2.29</span><span class="p">,</span>
                     <span class="mf">2.65</span><span class="p">,</span> <span class="mf">3.00</span><span class="p">,</span> <span class="mf">3.15</span><span class="p">,</span> <span class="mf">3.49</span><span class="p">,</span> <span class="mf">3.91</span><span class="p">,</span> <span class="mf">4.24</span><span class="p">,</span> <span class="mf">4.53</span><span class="p">,</span> <span class="mf">5.30</span><span class="p">,</span> <span class="mf">5.85</span><span class="p">,</span> <span class="mf">6.38</span><span class="p">,</span> <span class="mf">6.76</span><span class="p">,</span>
                     <span class="mf">6.90</span><span class="p">,</span> <span class="mf">7.17</span><span class="p">,</span> <span class="mf">7.71</span><span class="p">,</span> <span class="mf">8.01</span><span class="p">,</span> <span class="mf">8.49</span><span class="p">,</span> <span class="mf">9.06</span><span class="p">,</span> <span class="mf">9.28</span><span class="p">,</span> <span class="mf">9.84</span><span class="p">,</span> <span class="mf">10.80</span><span class="p">,</span> <span class="mf">11.51</span><span class="p">,</span> <span class="mf">12.52</span><span class="p">,</span> <span class="mf">13.54</span><span class="p">])</span>
   
   <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="mi">1</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">pix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">wavel</span> <span class="o">&lt;</span> <span class="mf">1000.0</span><span class="p">):</span>
         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;redlaw_smc: Invalid wavelength&quot;</span><span class="p">)</span>
      <span class="c1"># Convert wavelength in angstroms to 1/microns</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mf">10000.e+0</span> <span class="o">/</span> <span class="n">wavel</span>
      <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
      
      <span class="c1"># Linearly interpolate extinction law in 1/lam</span>
      <span class="n">val</span> <span class="o">=</span> <span class="n">lin_interp</span><span class="p">(</span><span class="n">extab</span><span class="p">,</span> <span class="n">xtab</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
      <span class="c1">#deriv1 = spl_init(xtab, extab)</span>
      <span class="c1">#val=spl_interp(xtab, extab, deriv1, x)</span>
      
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">extl</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="mf">3.1</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">extl</span><span class="o">=</span><span class="n">val</span> <span class="o">+</span> <span class="mf">3.1</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">extl</span> <span class="o">/</span> <span class="mf">3.242</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="redlaw_lmc"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.redlaw_lmc">[docs]</a><span class="k">def</span> <span class="nf">redlaw_lmc</span><span class="p">(</span><span class="n">wavelength</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       This function determines the reddening law function of the line at the given wavelength</span>
<span class="sd">       for the Large Magellanic Cloud.</span>

<span class="sd">    :Returns:</span>
<span class="sd">       type=double/array. This function returns the reddening law function value(s) for the given wavelength(s).</span>

<span class="sd">    :Params:</span>
<span class="sd">        wavelength :  in, required, type=float</span>
<span class="sd">                      Wavelength in Angstrom</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">        &gt;&gt;&gt; import pyequib</span>
<span class="sd">        &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">        &gt;&gt;&gt; fl=pyequib.redlaw_lmc(wavelength)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;fl(6563)&#39;, fl)</span>
<span class="sd">           fl(6563)     -0.30871187</span>

<span class="sd">    :Categories:</span>
<span class="sd">      Interstellar Extinction</span>

<span class="sd">    :Dirs:</span>
<span class="sd">     ./</span>
<span class="sd">         Subroutines</span>

<span class="sd">    :Author:</span>
<span class="sd">      Ashkbiz Danehkar</span>

<span class="sd">    :Copyright:</span>
<span class="sd">      This library is released under a GNU General Public License.</span>

<span class="sd">    :Version:</span>
<span class="sd">      0.3.0</span>

<span class="sd">    :History:</span>
<span class="sd">        Based on Formulae by Howarth 1983, MNRAS, 203, 301</span>
<span class="sd">        1983MNRAS.203..301H</span>

<span class="sd">        Originally from IRAF STSDAS SYNPHOT ebmvlfunc.x, redlaw.x</span>

<span class="sd">        18/10/1994, R. A. Shaw, Initial IRAF implementation.</span>

<span class="sd">        14/03/1995, R. A. Shaw, Return A(lambda)/A(V) instead.</span>

<span class="sd">        31/08/2012, A. Danehkar, Converted to IDL code.</span>

<span class="sd">        03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Tabulated inverse wavelengths in microns:</span>
   <span class="n">xtab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">,</span> <span class="mf">1.43</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">])</span>
   
   <span class="c1"># Tabulated extinction function, A(lambda)/E(B-V), from Savage &amp; Mathis:</span>
   <span class="n">extab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="mf">1.50</span><span class="p">,</span> <span class="mf">2.32</span><span class="p">,</span> <span class="mf">3.10</span><span class="p">])</span>
   
   <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npts</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="n">npts</span> <span class="o">=</span> <span class="mi">1</span>
     <span class="n">extl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">pix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">wavel</span><span class="o">=</span><span class="n">wavelength</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">wavel</span> <span class="o">&lt;</span> <span class="mf">1000.0</span><span class="p">):</span>   
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;redlaw_lmc: Invalid wavelength&#39;</span><span class="p">)</span>
      
      <span class="c1"># Convert input wavelength to inverse microns</span>
      <span class="n">x</span> <span class="o">=</span> <span class="mf">10000.e+0</span> <span class="o">/</span> <span class="n">wavel</span>
      
      <span class="c1"># Infrared - optical</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">1.82</span><span class="p">):</span>   
         <span class="c1"># linear interpolation of Savage &amp; Mathis 1979</span>
         <span class="c1">#  val = lin_interp(extab, xtab,  x)</span>
         <span class="c1">#  extl[pix] = val #+ 3.1</span>
         <span class="c1"># Infrared - extend optical results linearly to 0 at 1/lam = 0</span>
         <span class="n">val</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.86</span> <span class="o">-</span> <span class="mf">0.48</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span>
      <span class="k">else</span><span class="p">:</span>   
         <span class="c1"># The following polynomial evaluations assume R = 3.1</span>
         <span class="c1"># Renormalize extinction function to A(lambda)/A(V)</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">2.75</span><span class="p">):</span>   
            <span class="c1">#  Violet</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mf">3.1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.04</span> <span class="o">+</span> <span class="mf">0.094</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.82</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.82</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>   
            <span class="c1">#  Ultraviolet out to lambda = 1000 A</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mf">3.1</span> <span class="o">-</span> <span class="mf">0.236</span> <span class="o">+</span> <span class="mf">0.462</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.105</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.454</span> <span class="o">/</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mf">4.557</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.293</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">extl</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">):</span>
         <span class="n">extl</span><span class="p">[</span><span class="n">pix</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">extl</span><span class="o">=</span><span class="n">val</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">extl</span> <span class="o">/</span> <span class="mf">3.57</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="deredden_flux"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.deredden_flux">[docs]</a><span class="k">def</span> <span class="nf">deredden_flux</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">m_ext</span><span class="p">,</span> <span class="n">ext_law</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmlaw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function dereddens absolute flux intensity based on the reddening law.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the deredden flux intensity.</span>

<span class="sd">     :Params:</span>
<span class="sd">         wavelength :  in, required, type=float/array</span>
<span class="sd">                       Wavelength in Angstrom</span>
<span class="sd">         flux       :  in, required, type=float,</span>
<span class="sd">                       absolute flux intensity</span>
<span class="sd">         m_ext      :  in, required, type=float,</span>
<span class="sd">                       logarithmic extinction</span>

<span class="sd">     :Keywords:</span>
<span class="sd">        ext_law  :  in, optional, type=string, default=&#39;GAL&#39;</span>
<span class="sd">                    the extinction law:</span>

<span class="sd">                    &#39;GAL&#39; for Howarth Galactic.</span>

<span class="sd">                    &#39;GAL2&#39; for Savage and Mathis.</span>

<span class="sd">                    &#39;CCM&#39; for CCM galactic.</span>

<span class="sd">                    &#39;JBK&#39; for Whitford, Seaton, Kaler.</span>

<span class="sd">                    &#39;FM&#39; for Fitxpatrick.</span>

<span class="sd">                    &#39;SMC&#39; for Prevot SMC.</span>

<span class="sd">                    &#39;LMC&#39; for Howarth LMC.</span>

<span class="sd">        rv       :  in, optional, type=float, default=3.1</span>
<span class="sd">                    the optical total-to-selective extinction ratio, RV = A(V)/E(B-V).</span>

<span class="sd">        fmlaw    :  in, optional, type=string, default=&#39;GAL&#39;</span>
<span class="sd">                    the fmlaw keyword is used only in the redlaw_fm function:</span>

<span class="sd">                    &#39;GAL&#39; for  the default fit parameters for the R-dependent</span>
<span class="sd">                               Galactic extinction curve from Fitzpatrick &amp; Massa</span>
<span class="sd">                               (Fitzpatrick, 1999, PASP, 111, 63).</span>

<span class="sd">                    &#39;LMC2&#39; for the fit parameters are those determined for</span>
<span class="sd">                                  reddening the LMC2 field (inc. 30 Dor)</span>
<span class="sd">                                  from Misselt et al.  (1999, ApJ, 515, 128).</span>

<span class="sd">                    &#39;AVGLMC&#39; for  the fit parameters are those determined for</span>
<span class="sd">                                  reddening in the general Large Magellanic Cloud (LMC)</span>
<span class="sd">                                  field by Misselt et al.  (1999, ApJ, 515, 128).</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">         &gt;&gt;&gt; ext_law=&#39;GAL&#39;</span>
<span class="sd">         &gt;&gt;&gt; r_v=3.1</span>
<span class="sd">         &gt;&gt;&gt; m_ext=1.0</span>
<span class="sd">         &gt;&gt;&gt; flux=1.0</span>
<span class="sd">         &gt;&gt;&gt; flux_deredden=pyequib.deredden_flux(wavelength, flux, m_ext, ext_law=ext_law, rv=r_v) # deredden absolute flux intensity</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;dereddened flux(6563):&#39;, flux_deredden)</span>
<span class="sd">            dereddened flux(6563):       4.7847785</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Interstellar Extinction</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         31/08/2012, A. Danehkar, IDL code.</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ext_law</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">extlaw</span> <span class="o">=</span> <span class="n">ext_law</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">extlaw</span> <span class="o">=</span> <span class="s1">&#39;GAL&#39;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="n">rv</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="mf">3.1</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">fmlaw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">fm_law</span> <span class="o">=</span> <span class="n">fmlaw</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">fm_law</span> <span class="o">=</span> <span class="s1">&#39;STANDARD&#39;</span>
   <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ext_law</span><span class="o">=</span><span class="n">extlaw</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="n">r_v</span><span class="p">,</span> <span class="n">fmlaw</span><span class="o">=</span><span class="n">fm_law</span><span class="p">)</span>
   <span class="n">int_dered</span> <span class="o">=</span> <span class="n">flux</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">m_ext</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">fl</span><span class="p">))</span>
   <span class="k">return</span> <span class="n">int_dered</span></div>

<div class="viewcode-block" id="deredden_relflux"><a class="viewcode-back" href="../api/pyequib.main.html#pyequib.deredden_relflux">[docs]</a><span class="k">def</span> <span class="nf">deredden_relflux</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">relflux</span><span class="p">,</span> <span class="n">m_ext</span><span class="p">,</span> <span class="n">ext_law</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmlaw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function dereddens flux intensity relative to Hb=100,  based on the reddening law.</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the deredden flux intensity relative to Hb=100.</span>

<span class="sd">     :Params:</span>
<span class="sd">         wavelength :  in, required, type=float/array</span>
<span class="sd">                       Wavelength in Angstrom</span>
<span class="sd">         relflux       :  in, required, type=float,</span>
<span class="sd">                       flux intensity relative to Hb=100</span>
<span class="sd">         m_ext      :  in, required, type=float,</span>
<span class="sd">                       logarithmic extinction</span>

<span class="sd">     :Keywords:</span>
<span class="sd">        ext_law  :  in, optional, type=string, default=&#39;GAL&#39;</span>
<span class="sd">                    the extinction law:</span>

<span class="sd">                    &#39;GAL&#39; for Howarth Galactic.</span>

<span class="sd">                    &#39;GAL2&#39; for Savage and Mathis.</span>

<span class="sd">                    &#39;CCM&#39; for CCM galactic.</span>

<span class="sd">                    &#39;JBK&#39; for Whitford, Seaton, Kaler.</span>

<span class="sd">                    &#39;FM&#39; for Fitxpatrick.</span>

<span class="sd">                    &#39;SMC&#39; for Prevot SMC.</span>

<span class="sd">                    &#39;LMC&#39; for Howarth LMC.</span>

<span class="sd">        rv       :  in, optional, type=float, default=3.1</span>
<span class="sd">                    the optical total-to-selective extinction ratio, RV = A(V)/E(B-V).</span>

<span class="sd">        fmlaw    :  in, optional, type=string, default=&#39;GAL&#39;</span>
<span class="sd">                    the fmlaw keyword is used only in the redlaw_fm function:</span>

<span class="sd">                    &#39;GAL&#39; for  the default fit parameters for the R-dependent</span>
<span class="sd">                               Galactic extinction curve from Fitzpatrick &amp; Massa</span>
<span class="sd">                               (Fitzpatrick, 1999, PASP, 111, 63).</span>

<span class="sd">                    &#39;LMC2&#39; for the fit parameters are those determined for</span>
<span class="sd">                                  reddening the LMC2 field (inc. 30 Dor)</span>
<span class="sd">                                  from Misselt et al.  (1999, ApJ, 515, 128).</span>

<span class="sd">                    &#39;AVGLMC&#39; for  the fit parameters are those determined for</span>
<span class="sd">                                  reddening in the general Large Magellanic Cloud (LMC)</span>
<span class="sd">                                  field by Misselt et al.  (1999, ApJ, 515, 128).</span>

<span class="sd">    :Examples:</span>
<span class="sd">       For example::</span>

<span class="sd">         &gt;&gt;&gt; import pyequib</span>
<span class="sd">         &gt;&gt;&gt; wavelength=6563.0</span>
<span class="sd">         &gt;&gt;&gt; ext_law=&#39;GAL&#39;</span>
<span class="sd">         &gt;&gt;&gt; r_v=3.1</span>
<span class="sd">         &gt;&gt;&gt; m_ext=1.0</span>
<span class="sd">         &gt;&gt;&gt; flux=1.0</span>
<span class="sd">         &gt;&gt;&gt; flux_deredden=pyequib.deredden_relflux(wavelength, flux, m_ext, ext_law=ext_law, rv=r_v) # deredden absolute flux intensity</span>
<span class="sd">         &gt;&gt;&gt; print(&#39;dereddened relative flux(6563):&#39;, flux_deredden)</span>
<span class="sd">            dereddened relative flux(6563):       0.47847785</span>

<span class="sd">     :Categories:</span>
<span class="sd">       Interstellar Extinction</span>

<span class="sd">     :Dirs:</span>
<span class="sd">      ./</span>
<span class="sd">          Main routines</span>

<span class="sd">     :Author:</span>
<span class="sd">       Ashkbiz Danehkar</span>

<span class="sd">     :Copyright:</span>
<span class="sd">       This library is released under a GNU General Public License.</span>

<span class="sd">     :Version:</span>
<span class="sd">       0.3.0</span>

<span class="sd">     :History:</span>
<span class="sd">         31/08/2012, A. Danehkar, IDL code.</span>

<span class="sd">         03/10/2020, A. Danehkar, Transferred from IDL to Python.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ext_law</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">extlaw</span> <span class="o">=</span> <span class="n">ext_law</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">extlaw</span> <span class="o">=</span> <span class="s1">&#39;GAL&#39;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">rv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="n">rv</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">r_v</span> <span class="o">=</span> <span class="mf">3.1</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">fmlaw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>   
      <span class="n">fm_law</span> <span class="o">=</span> <span class="n">fmlaw</span>
   <span class="k">else</span><span class="p">:</span>   
      <span class="n">fm_law</span> <span class="o">=</span> <span class="s1">&#39;STANDARD&#39;</span>
   <span class="n">fl</span> <span class="o">=</span> <span class="n">redlaw</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">ext_law</span><span class="o">=</span><span class="n">extlaw</span><span class="p">,</span> <span class="n">rv</span><span class="o">=</span><span class="n">r_v</span><span class="p">,</span> <span class="n">fmlaw</span><span class="o">=</span><span class="n">fm_law</span><span class="p">)</span>
   <span class="n">int_dered</span> <span class="o">=</span> <span class="n">relflux</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">m_ext</span> <span class="o">*</span> <span class="n">fl</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">int_dered</span></div>

<span class="k">def</span> <span class="nf">lin_interp</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">xout</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">          This function perfoms a linear interpolation/extrapolaton.</span>

<span class="sd">      :Private:</span>

<span class="sd">      :Returns:</span>
<span class="sd">         type=double. This function returns the interpolated/extrapolated value.</span>

<span class="sd">      :Params:</span>
<span class="sd">          vv  :  in, required, type=float</span>
<span class="sd">                        VV array to interpolate</span>

<span class="sd">          xx  :  in, required, type=float</span>
<span class="sd">                        X array that correspond to x(0), x(1), ...</span>

<span class="sd">          xout :  in, required, type=float</span>
<span class="sd">                        X values at which vv should be interpolated</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Make a copy so we don&#39;t overwrite the input arguments.</span>
   <span class="n">v</span> <span class="o">=</span> <span class="n">vv</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">xx</span>
   <span class="c1"># vout=np.interp(xout, xx, vv)</span>
   <span class="n">interpfunc</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">vv</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
   <span class="n">vout</span><span class="o">=</span><span class="n">interpfunc</span><span class="p">(</span><span class="n">xout</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">vout</span>

<span class="k">def</span> <span class="nf">lin_interp_v2</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">xout</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This function perfoms a linear interpolation/extrapolaton.</span>

<span class="sd">     :Private:</span>

<span class="sd">     :Returns:</span>
<span class="sd">        type=double. This function returns the interpolated/extrapolated value.</span>

<span class="sd">     :Params:</span>
<span class="sd">         vv  :  in, required, type=float</span>
<span class="sd">                       VV array to interpolate</span>

<span class="sd">         xx  :  in, required, type=float</span>
<span class="sd">                       X array that correspond to x(0), x(1), ...</span>

<span class="sd">         xout :  in, required, type=float</span>
<span class="sd">                       X values at which vv should be interpolated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">vv</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">xx</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="c1">## of input pnts</span>

    <span class="n">type1</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="c1">#s = min(max(value_locate(x, xout), 0), (m - 2))  # Subscript intervals.</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xout</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="c1"># Linear, not regular</span>
    <span class="n">_expr</span> <span class="o">=</span> <span class="p">(</span><span class="n">type1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">_expr</span> <span class="o">==</span> <span class="s1">&#39;long&#39;</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">xout</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">*</span> <span class="n">diff</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p</span>

<span class="k">def</span> <span class="nf">check_sign</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>
<span class="sd">        equib_sign</span>
<span class="sd">    PURPOSE:</span>

<span class="sd">    EXPLANATION:</span>

<span class="sd">    CALLING SEQUENCE:</span>
<span class="sd">        ret= equib_sign(A, B)</span>

<span class="sd">    INPUTS:</span>
<span class="sd">        A -     A parameter</span>
<span class="sd">        B -     B parameter</span>
<span class="sd">    RETURN:  value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">do_str2int</span><span class="p">(</span><span class="n">str1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts the list of string of miles into a list of integers of miles&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">integer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">str1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">integer</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;here&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please try again and enter a list of integers.&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_strsplit</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">escapech</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">itr</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">itr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">escapech</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># skip the next character# it has been escaped!</span>
                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">itr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">delim</span><span class="p">:</span>
            <span class="c1"># split! (add current to the list and reset it)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
            <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ret</span>


<span class="k">def</span> <span class="nf">do_strtrim</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Ashkbiz Danehkar

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>